var Bo=Object.defineProperty;var ec=j=>Bo(j,"__esModule",{value:!0});var tc=(j,r)=>()=>(r||(r={exports:{}},j(r.exports,r)),r.exports),rc=(j,r)=>{for(var h in r)Bo(j,h,{get:r[h],enumerable:!0})};var ko=tc(ic=>{ec(ic);rc(ic,{default:()=>oc});var ac=Ke(function(j,r){(function(h,o){j.exports=o()})(Rt,function(){var h=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},o=function(e,a){for(var m=Object.keys(a),L=0;L<m.length;++L)e[m[L]]=a[m[L]];return e},t=`
`;function n(e){return typeof atob!="undefined"?atob(e):"base64:"+e}function f(e){var a=new Error("(regl) "+e);throw console.error(a),a}function S(e,a){e||f(a)}function V(e){return e?": "+e:""}function ne(e,a,m){e in a||f("unknown parameter ("+e+")"+V(m)+". possible values: "+Object.keys(a).join())}function re(e,a){h(e)||f("invalid parameter type"+V(a)+". must be a typed array")}function Le(e,a){switch(a){case"number":return typeof e=="number";case"object":return typeof e=="object";case"string":return typeof e=="string";case"boolean":return typeof e=="boolean";case"function":return typeof e=="function";case"undefined":return typeof e=="undefined";case"symbol":return typeof e=="symbol"}}function le(e,a,m){Le(e,a)||f("invalid parameter type"+V(m)+". expected "+a+", got "+typeof e)}function _e(e,a){e>=0&&(e|0)===e||f("invalid parameter type, ("+e+")"+V(a)+". must be a nonnegative integer")}function Ce(e,a,m){a.indexOf(e)<0&&f("invalid value"+V(m)+". must be one of: "+a)}var Be=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Je(e){Object.keys(e).forEach(function(a){Be.indexOf(a)<0&&f('invalid regl constructor argument "'+a+'". must be one of '+Be)})}function Fe(e,a){for(e=e+"";e.length<a;)e=" "+e;return e}function Et(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function nr(e,a){this.number=e,this.line=a,this.errors=[]}function xr(e,a,m){this.file=e,this.line=a,this.message=m}function Vt(){var e=new Error,a=(e.stack||e).toString(),m=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);if(m)return m[1];var L=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a);return L?L[1]:"unknown"}function Li(){var e=new Error,a=(e.stack||e).toString(),m=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);if(m)return m[1];var L=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a);return L?L[1]:"unknown"}function Ln(e,a){var m=e.split(`
`),L=1,N=0,w={unknown:new Et,0:new Et};w.unknown.name=w[0].name=a||Vt(),w.unknown.lines.push(new nr(0,""));for(var O=0;O<m.length;++O){var U=m[O],W=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(U);if(W)switch(W[1]){case"line":var q=/(\d+)(\s+\d+)?/.exec(W[2]);q&&(L=q[1]|0,q[2]&&(N=q[2]|0,N in w||(w[N]=new Et)));break;case"define":var Q=/SHADER_NAME(_B64)?\s+(.*)$/.exec(W[2]);Q&&(w[N].name=Q[1]?n(Q[2]):Q[2]);break}w[N].lines.push(new nr(L++,U))}return Object.keys(w).forEach(function(Y){var Z=w[Y];Z.lines.forEach(function(H){Z.index[H.number]=H})}),w}function ys(e){var a=[];return e.split(`
`).forEach(function(m){if(!(m.length<5)){var L=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(m);L?a.push(new xr(L[1]|0,L[2]|0,L[3].trim())):m.length>0&&a.push(new xr("unknown",0,m))}}),a}function _s(e,a){a.forEach(function(m){var L=e[m.file];if(L){var N=L.index[m.line];if(N){N.errors.push(m),L.hasErrors=!0;return}}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(m)})}function bs(e,a,m,L,N){if(!e.getShaderParameter(a,e.COMPILE_STATUS)){var w=e.getShaderInfoLog(a),O=L===e.FRAGMENT_SHADER?"fragment":"vertex";Di(m,"string",O+" shader source must be a string",N);var U=Ln(m,N),W=ys(w);_s(U,W),Object.keys(U).forEach(function(q){var Q=U[q];if(!Q.hasErrors)return;var Y=[""],Z=[""];function H(X,x){Y.push(X),Z.push(x||"")}H("file number "+q+": "+Q.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Q.lines.forEach(function(X){if(X.errors.length>0){H(Fe(X.number,4)+"|  ","background-color:yellow; font-weight:bold"),H(X.line+t,"color:red; background-color:yellow; font-weight:bold");var x=0;X.errors.forEach(function(D){var $=D.message,fe=/^\s*'(.*)'\s*:\s*(.*)$/.exec($);if(fe){var M=fe[1];switch($=fe[2],M){case"assign":M="=";break}x=Math.max(X.line.indexOf(M,x),0)}else x=0;H(Fe("| ",6)),H(Fe("^^^",x+3)+t,"font-weight:bold"),H(Fe("| ",6)),H($+t,"font-weight:bold")}),H(Fe("| ",6)+t)}else H(Fe(X.number,4)+"|  "),H(X.line+t,"color:red")}),typeof document!="undefined"&&!window.chrome?(Z[0]=Y.join("%c"),console.log.apply(console,Z)):console.log(Y.join(""))}),S.raise("Error compiling "+O+" shader, "+U[0].name)}}function Es(e,a,m,L,N){if(!e.getProgramParameter(a,e.LINK_STATUS)){var w=e.getProgramInfoLog(a),O=Ln(m,N),U=Ln(L,N),W='Error linking program with vertex shader, "'+U[0].name+'", and fragment shader "'+O[0].name+'"';typeof document!="undefined"?console.log("%c"+W+t+"%c"+w,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(W+t+w),S.raise(W)}}function Ri(e){e._commandRef=Vt()}function xs(e,a,m,L){Ri(e);function N(W){return W?L.id(W):0}e._fragId=N(e.static.frag),e._vertId=N(e.static.vert);function w(W,q){Object.keys(q).forEach(function(Q){W[L.id(Q)]=!0})}var O=e._uniformSet={};w(O,a.static),w(O,a.dynamic);var U=e._attributeSet={};w(U,m.static),w(U,m.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function jr(e,a){var m=Li();f(e+" in command "+(a||Vt())+(m==="unknown"?"":" called from "+m))}function gs(e,a,m){e||jr(a,m||Vt())}function Ts(e,a,m,L){e in a||jr("unknown parameter ("+e+")"+V(m)+". possible values: "+Object.keys(a).join(),L||Vt())}function Di(e,a,m,L){Le(e,a)||jr("invalid parameter type"+V(m)+". expected "+a+", got "+typeof e,L||Vt())}function As(e){e()}function Ss(e,a,m){e.texture?Ce(e.texture._texture.internalformat,a,"unsupported texture format for attachment"):Ce(e.renderbuffer._renderbuffer.format,m,"unsupported renderbuffer format for attachment")}var Hr=33071,Oi=9728,Cs=9984,ws=9985,Ls=9986,Rs=9987,Ds=5120,Os=5121,Gs=5122,Ps=5123,Is=5124,Ns=5125,Gi=5126,Pi=32819,Ii=32820,Ni=33635,Fi=34042,Fs=36193,lt={};lt[Ds]=lt[Os]=1,lt[Gs]=lt[Ps]=lt[Fs]=lt[Ni]=lt[Pi]=lt[Ii]=2,lt[Is]=lt[Ns]=lt[Gi]=lt[Fi]=4;function Bi(e,a){return e===Ii||e===Pi||e===Ni?2:e===Fi?4:lt[e]*a}function zr(e){return!(e&e-1)&&!!e}function Bs(e,a,m){var L,N=a.width,w=a.height,O=a.channels;S(N>0&&N<=m.maxTextureSize&&w>0&&w<=m.maxTextureSize,"invalid texture shape"),(e.wrapS!==Hr||e.wrapT!==Hr)&&S(zr(N)&&zr(w),"incompatible wrap mode for texture, both width and height must be power of 2"),a.mipmask===1?N!==1&&w!==1&&S(e.minFilter!==Cs&&e.minFilter!==Ls&&e.minFilter!==ws&&e.minFilter!==Rs,"min filter requires mipmap"):(S(zr(N)&&zr(w),"texture must be a square power of 2 to support mipmapping"),S(a.mipmask===(N<<1)-1,"missing or incomplete mipmap data")),a.type===Gi&&(m.extensions.indexOf("oes_texture_float_linear")<0&&S(e.minFilter===Oi&&e.magFilter===Oi,"filter not supported, must enable oes_texture_float_linear"),S(!e.genMipmaps,"mipmap generation not supported with float textures"));var U=a.images;for(L=0;L<16;++L)if(U[L]){var W=N>>L,q=w>>L;S(a.mipmask&1<<L,"missing mipmap data");var Q=U[L];if(S(Q.width===W&&Q.height===q,"invalid shape for mip images"),S(Q.format===a.format&&Q.internalformat===a.internalformat&&Q.type===a.type,"incompatible type for mip image"),!Q.compressed)if(Q.data){var Y=Math.ceil(Bi(Q.type,O)*W/Q.unpackAlignment)*Q.unpackAlignment;S(Q.data.byteLength===Y*q,"invalid data for image, buffer size is inconsistent with image format")}else Q.element||Q.copy}else e.genMipmaps||S((a.mipmask&1<<L)==0,"extra mipmap data");a.compressed&&S(!e.genMipmaps,"mipmap generation for compressed images not supported")}function ks(e,a,m,L){var N=e.width,w=e.height,O=e.channels;S(N>0&&N<=L.maxTextureSize&&w>0&&w<=L.maxTextureSize,"invalid texture shape"),S(N===w,"cube map must be square"),S(a.wrapS===Hr&&a.wrapT===Hr,"wrap mode not supported by cube map");for(var U=0;U<m.length;++U){var W=m[U];S(W.width===N&&W.height===w,"inconsistent cube map face shape"),a.genMipmaps&&(S(!W.compressed,"can not generate mipmap for compressed textures"),S(W.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var q=W.images,Q=0;Q<16;++Q){var Y=q[Q];if(Y){var Z=N>>Q,H=w>>Q;S(W.mipmask&1<<Q,"missing mipmap data"),S(Y.width===Z&&Y.height===H,"invalid shape for mip images"),S(Y.format===e.format&&Y.internalformat===e.internalformat&&Y.type===e.type,"incompatible type for mip image"),Y.compressed||(Y.data?S(Y.data.byteLength===Z*H*Math.max(Bi(Y.type,O),Y.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Y.element||Y.copy)}}}}var s=o(S,{optional:As,raise:f,commandRaise:jr,command:gs,parameter:ne,commandParameter:Ts,constructor:Je,type:le,commandType:Di,isTypedArray:re,nni:_e,oneOf:Ce,shaderError:bs,linkError:Es,callSite:Li,saveCommandRef:Ri,saveDrawInfo:xs,framebufferFormat:Ss,guessCommand:Vt,texture2D:Bs,textureCube:ks}),Ms=0,Vs=0,Ws=5,Us=6;function Wt(e,a){this.id=Ms++,this.type=e,this.data=a}function ki(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function gr(e){if(e.length===0)return[];var a=e.charAt(0),m=e.charAt(e.length-1);if(e.length>1&&a===m&&(a==='"'||a==="'"))return['"'+ki(e.substr(1,e.length-2))+'"'];var L=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(L)return gr(e.substr(0,L.index)).concat(gr(L[1])).concat(gr(e.substr(L.index+L[0].length)));var N=e.split(".");if(N.length===1)return['"'+ki(e)+'"'];for(var w=[],O=0;O<N.length;++O)w=w.concat(gr(N[O]));return w}function Mi(e){return"["+gr(e).join("][")+"]"}function js(e,a){return new Wt(e,Mi(a+""))}function Hs(e){return typeof e=="function"&&!e._reglType||e instanceof Wt}function Vi(e,a){if(typeof e=="function")return new Wt(Vs,e);if(typeof e=="number"||typeof e=="boolean")return new Wt(Ws,e);if(Array.isArray(e))return new Wt(Us,e.map(function(m,L){return Vi(m,a+"["+L+"]")}));if(e instanceof Wt)return e;s(!1,"invalid option type in uniform "+a)}var ct={DynamicVariable:Wt,define:js,isDynamic:Hs,unbox:Vi,accessor:Mi},Rn={next:typeof requestAnimationFrame=="function"?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:typeof cancelAnimationFrame=="function"?function(e){return cancelAnimationFrame(e)}:clearTimeout},Wi=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function zs(){var e={"":0},a=[""];return{id:function(m){var L=e[m];return L||(L=e[m]=a.length,a.push(m),L)},str:function(m){return a[m]}}}function $s(e,a,m){var L=document.createElement("canvas");o(L.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(L),e===document.body&&(L.style.position="absolute",o(e.style,{margin:0,padding:0}));function N(){var U=window.innerWidth,W=window.innerHeight;if(e!==document.body){var q=L.getBoundingClientRect();U=q.right-q.left,W=q.bottom-q.top}L.width=m*U,L.height=m*W}var w;e!==document.body&&typeof ResizeObserver=="function"?(w=new ResizeObserver(function(){setTimeout(N)}),w.observe(e)):window.addEventListener("resize",N,!1);function O(){w?w.disconnect():window.removeEventListener("resize",N),e.removeChild(L)}return N(),{canvas:L,onDestroy:O}}function Xs(e,a){function m(L){try{return e.getContext(L,a)}catch(N){return null}}return m("webgl")||m("experimental-webgl")||m("webgl-experimental")}function qs(e){return typeof e.nodeName=="string"&&typeof e.appendChild=="function"&&typeof e.getBoundingClientRect=="function"}function Ys(e){return typeof e.drawArrays=="function"||typeof e.drawElements=="function"}function Ui(e){return typeof e=="string"?e.split():(s(Array.isArray(e),"invalid extension array"),e)}function ji(e){return typeof e=="string"?(s(typeof document!="undefined","not supported outside of DOM"),document.querySelector(e)):e}function Qs(e){var a=e||{},m,L,N,w,O={},U=[],W=[],q=typeof window=="undefined"?1:window.devicePixelRatio,Q=!1,Y=function(X){X&&s.raise(X)},Z=function(){};if(typeof a=="string"?(s(typeof document!="undefined","selector queries only supported in DOM enviroments"),m=document.querySelector(a),s(m,"invalid query string for element")):typeof a=="object"?qs(a)?m=a:Ys(a)?(w=a,N=w.canvas):(s.constructor(a),"gl"in a?w=a.gl:"canvas"in a?N=ji(a.canvas):"container"in a&&(L=ji(a.container)),"attributes"in a&&(O=a.attributes,s.type(O,"object","invalid context attributes")),"extensions"in a&&(U=Ui(a.extensions)),"optionalExtensions"in a&&(W=Ui(a.optionalExtensions)),"onDone"in a&&(s.type(a.onDone,"function","invalid or missing onDone callback"),Y=a.onDone),"profile"in a&&(Q=!!a.profile),"pixelRatio"in a&&(q=+a.pixelRatio,s(q>0,"invalid pixel ratio"))):s.raise("invalid arguments to regl"),m&&(m.nodeName.toLowerCase()==="canvas"?N=m:L=m),!w){if(!N){s(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var H=$s(L||document.body,Y,q);if(!H)return null;N=H.canvas,Z=H.onDestroy}O.premultipliedAlpha===void 0&&(O.premultipliedAlpha=!0),w=Xs(N,O)}return w?{gl:w,canvas:N,container:L,extensions:U,optionalExtensions:W,pixelRatio:q,profile:Q,onDone:Y,onDestroy:Z}:(Z(),Y("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ks(e,a){var m={};function L(O){s.type(O,"string","extension name must be string");var U=O.toLowerCase(),W;try{W=m[U]=e.getExtension(U)}catch(q){}return!!W}for(var N=0;N<a.extensions.length;++N){var w=a.extensions[N];if(!L(w))return a.onDestroy(),a.onDone('"'+w+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return a.optionalExtensions.forEach(L),{extensions:m,restore:function(){Object.keys(m).forEach(function(O){if(m[O]&&!L(O))throw new Error("(regl): error restoring extension "+O)})}}}function ht(e,a){for(var m=Array(e),L=0;L<e;++L)m[L]=a(L);return m}var Zs=5120,Js=5121,ef=5122,tf=5123,rf=5124,nf=5125,af=5126;function of(e){for(var a=16;a<=1<<28;a*=16)if(e<=a)return a;return 0}function Hi(e){var a,m;return a=(e>65535)<<4,e>>>=a,m=(e>255)<<3,e>>>=m,a|=m,m=(e>15)<<2,e>>>=m,a|=m,m=(e>3)<<1,e>>>=m,a|=m,a|e>>1}function zi(){var e=ht(8,function(){return[]});function a(w){var O=of(w),U=e[Hi(O)>>2];return U.length>0?U.pop():new ArrayBuffer(O)}function m(w){e[Hi(w.byteLength)>>2].push(w)}function L(w,O){var U=null;switch(w){case Zs:U=new Int8Array(a(O),0,O);break;case Js:U=new Uint8Array(a(O),0,O);break;case ef:U=new Int16Array(a(2*O),0,O);break;case tf:U=new Uint16Array(a(2*O),0,O);break;case rf:U=new Int32Array(a(4*O),0,O);break;case nf:U=new Uint32Array(a(4*O),0,O);break;case af:U=new Float32Array(a(4*O),0,O);break;default:return null}return U.length!==O?U.subarray(0,O):U}function N(w){m(w.buffer)}return{alloc:a,free:m,allocType:L,freeType:N}}var He=zi();He.zero=zi();var sf=3408,ff=3410,uf=3411,lf=3412,cf=3413,hf=3414,df=3415,pf=33901,mf=33902,vf=3379,yf=3386,_f=34921,bf=36347,Ef=36348,xf=35661,gf=35660,Tf=34930,Af=36349,Sf=34076,Cf=34024,wf=7936,Lf=7937,Rf=7938,Df=35724,Of=34047,Gf=36063,Pf=34852,$r=3553,$i=34067,If=34069,Nf=33984,Tr=6408,Dn=5126,Xi=5121,On=36160,Ff=36053,Bf=36064,kf=16384,Mf=function(e,a){var m=1;a.ext_texture_filter_anisotropic&&(m=e.getParameter(Of));var L=1,N=1;a.webgl_draw_buffers&&(L=e.getParameter(Pf),N=e.getParameter(Gf));var w=!!a.oes_texture_float;if(w){var O=e.createTexture();e.bindTexture($r,O),e.texImage2D($r,0,Tr,1,1,0,Tr,Dn,null);var U=e.createFramebuffer();if(e.bindFramebuffer(On,U),e.framebufferTexture2D(On,Bf,$r,O,0),e.bindTexture($r,null),e.checkFramebufferStatus(On)!==Ff)w=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(kf);var W=He.allocType(Dn,4);e.readPixels(0,0,1,1,Tr,Dn,W),e.getError()?w=!1:(e.deleteFramebuffer(U),e.deleteTexture(O),w=W[0]===1),He.freeType(W)}}var q=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Q=!0;if(!q){var Y=e.createTexture(),Z=He.allocType(Xi,36);e.activeTexture(Nf),e.bindTexture($i,Y),e.texImage2D(If,0,Tr,3,3,0,Tr,Xi,Z),He.freeType(Z),e.bindTexture($i,null),e.deleteTexture(Y),Q=!e.getError()}return{colorBits:[e.getParameter(ff),e.getParameter(uf),e.getParameter(lf),e.getParameter(cf)],depthBits:e.getParameter(hf),stencilBits:e.getParameter(df),subpixelBits:e.getParameter(sf),extensions:Object.keys(a).filter(function(H){return!!a[H]}),maxAnisotropic:m,maxDrawbuffers:L,maxColorAttachments:N,pointSizeDims:e.getParameter(pf),lineWidthDims:e.getParameter(mf),maxViewportDims:e.getParameter(yf),maxCombinedTextureUnits:e.getParameter(xf),maxCubeMapSize:e.getParameter(Sf),maxRenderbufferSize:e.getParameter(Cf),maxTextureUnits:e.getParameter(Tf),maxTextureSize:e.getParameter(vf),maxAttributes:e.getParameter(_f),maxVertexUniforms:e.getParameter(bf),maxVertexTextureUnits:e.getParameter(gf),maxVaryingVectors:e.getParameter(Ef),maxFragmentUniforms:e.getParameter(Af),glsl:e.getParameter(Df),renderer:e.getParameter(Lf),vendor:e.getParameter(wf),version:e.getParameter(Rf),readFloat:w,npotTextureCube:Q}};function _t(e){return!!e&&typeof e=="object"&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&typeof e.offset=="number"&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||h(e.data))}var dt=function(e){return Object.keys(e).map(function(a){return e[a]})},Xr={shape:jf,flatten:Uf};function Vf(e,a,m){for(var L=0;L<a;++L)m[L]=e[L]}function Wf(e,a,m,L){for(var N=0,w=0;w<a;++w)for(var O=e[w],U=0;U<m;++U)L[N++]=O[U]}function qi(e,a,m,L,N,w){for(var O=w,U=0;U<a;++U)for(var W=e[U],q=0;q<m;++q)for(var Q=W[q],Y=0;Y<L;++Y)N[O++]=Q[Y]}function Yi(e,a,m,L,N){for(var w=1,O=m+1;O<a.length;++O)w*=a[O];var U=a[m];if(a.length-m==4){var W=a[m+1],q=a[m+2],Q=a[m+3];for(O=0;O<U;++O)qi(e[O],W,q,Q,L,N),N+=w}else for(O=0;O<U;++O)Yi(e[O],a,m+1,L,N),N+=w}function Uf(e,a,m,L){var N=1;if(a.length)for(var w=0;w<a.length;++w)N*=a[w];else N=0;var O=L||He.allocType(m,N);switch(a.length){case 0:break;case 1:Vf(e,a[0],O);break;case 2:Wf(e,a[0],a[1],O);break;case 3:qi(e,a[0],a[1],a[2],O,0);break;default:Yi(e,a,0,O,0)}return O}function jf(e){for(var a=[],m=e;m.length;m=m[0])a.push(m.length);return a}var Gn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Hf=5120,zf=5122,$f=5124,Xf=5121,qf=5123,Yf=5125,Qf=5126,Kf=5126,Ut={int8:Hf,int16:zf,int32:$f,uint8:Xf,uint16:qf,uint32:Yf,float:Qf,float32:Kf},Zf=35048,Jf=35040,qr={dynamic:Zf,stream:Jf,static:35044},Pn=Xr.flatten,Qi=Xr.shape,Ki=35044,eu=35040,In=5121,Nn=5126,Dt=[];Dt[5120]=1,Dt[5122]=2,Dt[5124]=4,Dt[5121]=1,Dt[5123]=2,Dt[5125]=4,Dt[5126]=4;function Yr(e){return Gn[Object.prototype.toString.call(e)]|0}function Zi(e,a){for(var m=0;m<a.length;++m)e[m]=a[m]}function Ji(e,a,m,L,N,w,O){for(var U=0,W=0;W<m;++W)for(var q=0;q<L;++q)e[U++]=a[N*W+w*q+O]}function tu(e,a,m,L){var N=0,w={};function O(x){this.id=N++,this.buffer=e.createBuffer(),this.type=x,this.usage=Ki,this.byteLength=0,this.dimension=1,this.dtype=In,this.persistentData=null,m.profile&&(this.stats={size:0})}O.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},O.prototype.destroy=function(){Z(this)};var U=[];function W(x,D){var $=U.pop();return $||($=new O(x)),$.bind(),Y($,D,eu,0,1,!1),$}function q(x){U.push(x)}function Q(x,D,$){x.byteLength=D.byteLength,e.bufferData(x.type,D,$)}function Y(x,D,$,fe,M,oe){var ie;if(x.usage=$,Array.isArray(D)){if(x.dtype=fe||Nn,D.length>0){var ve;if(Array.isArray(D[0])){ie=Qi(D);for(var F=1,I=1;I<ie.length;++I)F*=ie[I];x.dimension=F,ve=Pn(D,ie,x.dtype),Q(x,ve,$),oe?x.persistentData=ve:He.freeType(ve)}else if(typeof D[0]=="number"){x.dimension=M;var he=He.allocType(x.dtype,D.length);Zi(he,D),Q(x,he,$),oe?x.persistentData=he:He.freeType(he)}else h(D[0])?(x.dimension=D[0].length,x.dtype=fe||Yr(D[0])||Nn,ve=Pn(D,[D.length,D[0].length],x.dtype),Q(x,ve,$),oe?x.persistentData=ve:He.freeType(ve)):s.raise("invalid buffer data")}}else if(h(D))x.dtype=fe||Yr(D),x.dimension=M,Q(x,D,$),oe&&(x.persistentData=new Uint8Array(new Uint8Array(D.buffer)));else if(_t(D)){ie=D.shape;var J=D.stride,z=D.offset,ee=0,te=0,Te=0,ge=0;ie.length===1?(ee=ie[0],te=1,Te=J[0],ge=0):ie.length===2?(ee=ie[0],te=ie[1],Te=J[0],ge=J[1]):s.raise("invalid shape"),x.dtype=fe||Yr(D.data)||Nn,x.dimension=te;var ae=He.allocType(x.dtype,ee*te);Ji(ae,D.data,ee,te,Te,ge,z),Q(x,ae,$),oe?x.persistentData=ae:He.freeType(ae)}else D instanceof ArrayBuffer?(x.dtype=In,x.dimension=M,Q(x,D,$),oe&&(x.persistentData=new Uint8Array(new Uint8Array(D)))):s.raise("invalid buffer data")}function Z(x){a.bufferCount--,L(x);var D=x.buffer;s(D,"buffer must not be deleted already"),e.deleteBuffer(D),x.buffer=null,delete w[x.id]}function H(x,D,$,fe){a.bufferCount++;var M=new O(D);w[M.id]=M;function oe(F){var I=Ki,he=null,J=0,z=0,ee=1;return Array.isArray(F)||h(F)||_t(F)||F instanceof ArrayBuffer?he=F:typeof F=="number"?J=F|0:F&&(s.type(F,"object","buffer arguments must be an object, a number or an array"),"data"in F&&(s(he===null||Array.isArray(he)||h(he)||_t(he),"invalid data for buffer"),he=F.data),"usage"in F&&(s.parameter(F.usage,qr,"invalid buffer usage"),I=qr[F.usage]),"type"in F&&(s.parameter(F.type,Ut,"invalid buffer type"),z=Ut[F.type]),"dimension"in F&&(s.type(F.dimension,"number","invalid dimension"),ee=F.dimension|0),"length"in F&&(s.nni(J,"buffer length must be a nonnegative integer"),J=F.length|0)),M.bind(),he?Y(M,he,I,z,ee,fe):(J&&e.bufferData(M.type,J,I),M.dtype=z||In,M.usage=I,M.dimension=ee,M.byteLength=J),m.profile&&(M.stats.size=M.byteLength*Dt[M.dtype]),oe}function ie(F,I){s(I+F.byteLength<=M.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+F.byteLength+" starting from offset "+I+" to a buffer of size "+M.byteLength),e.bufferSubData(M.type,I,F)}function ve(F,I){var he=(I||0)|0,J;if(M.bind(),h(F)||F instanceof ArrayBuffer)ie(F,he);else if(Array.isArray(F)){if(F.length>0)if(typeof F[0]=="number"){var z=He.allocType(M.dtype,F.length);Zi(z,F),ie(z,he),He.freeType(z)}else if(Array.isArray(F[0])||h(F[0])){J=Qi(F);var ee=Pn(F,J,M.dtype);ie(ee,he),He.freeType(ee)}else s.raise("invalid buffer data")}else if(_t(F)){J=F.shape;var te=F.stride,Te=0,ge=0,ae=0,se=0;J.length===1?(Te=J[0],ge=1,ae=te[0],se=0):J.length===2?(Te=J[0],ge=J[1],ae=te[0],se=te[1]):s.raise("invalid shape");var be=Array.isArray(F.data)?M.dtype:Yr(F.data),Ae=He.allocType(be,Te*ge);Ji(Ae,F.data,Te,ge,ae,se,F.offset),ie(Ae,he),He.freeType(Ae)}else s.raise("invalid data for buffer subdata");return oe}return $||oe(x),oe._reglType="buffer",oe._buffer=M,oe.subdata=ve,m.profile&&(oe.stats=M.stats),oe.destroy=function(){Z(M)},oe}function X(){dt(w).forEach(function(x){x.buffer=e.createBuffer(),e.bindBuffer(x.type,x.buffer),e.bufferData(x.type,x.persistentData||x.byteLength,x.usage)})}return m.profile&&(a.getTotalBufferSize=function(){var x=0;return Object.keys(w).forEach(function(D){x+=w[D].stats.size}),x}),{create:H,createStream:W,destroyStream:q,clear:function(){dt(w).forEach(Z),U.forEach(Z)},getBuffer:function(x){return x&&x._buffer instanceof O?x._buffer:null},restore:X,_initBuffer:Y}}var ru=0,nu=0,iu=1,au=1,ou=4,su=4,Ot={points:ru,point:nu,lines:iu,line:au,triangles:ou,triangle:su,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},fu=0,uu=1,Ar=4,lu=5120,ir=5121,ea=5122,ar=5123,ta=5124,jt=5125,Fn=34963,cu=35040,hu=35044;function du(e,a,m,L){var N={},w=0,O={uint8:ir,uint16:ar};a.oes_element_index_uint&&(O.uint32=jt);function U(X){this.id=w++,N[this.id]=this,this.buffer=X,this.primType=Ar,this.vertCount=0,this.type=0}U.prototype.bind=function(){this.buffer.bind()};var W=[];function q(X){var x=W.pop();return x||(x=new U(m.create(null,Fn,!0,!1)._buffer)),Y(x,X,cu,-1,-1,0,0),x}function Q(X){W.push(X)}function Y(X,x,D,$,fe,M,oe){X.buffer.bind();var ie;if(x){var ve=oe;!oe&&(!h(x)||_t(x)&&!h(x.data))&&(ve=a.oes_element_index_uint?jt:ar),m._initBuffer(X.buffer,x,D,ve,3)}else e.bufferData(Fn,M,D),X.buffer.dtype=ie||ir,X.buffer.usage=D,X.buffer.dimension=3,X.buffer.byteLength=M;if(ie=oe,!oe){switch(X.buffer.dtype){case ir:case lu:ie=ir;break;case ar:case ea:ie=ar;break;case jt:case ta:ie=jt;break;default:s.raise("unsupported type for element array")}X.buffer.dtype=ie}X.type=ie,s(ie!==jt||!!a.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var F=fe;F<0&&(F=X.buffer.byteLength,ie===ar?F>>=1:ie===jt&&(F>>=2)),X.vertCount=F;var I=$;if($<0){I=Ar;var he=X.buffer.dimension;he===1&&(I=fu),he===2&&(I=uu),he===3&&(I=Ar)}X.primType=I}function Z(X){L.elementsCount--,s(X.buffer!==null,"must not double destroy elements"),delete N[X.id],X.buffer.destroy(),X.buffer=null}function H(X,x){var D=m.create(null,Fn,!0),$=new U(D._buffer);L.elementsCount++;function fe(M){if(!M)D(),$.primType=Ar,$.vertCount=0,$.type=ir;else if(typeof M=="number")D(M),$.primType=Ar,$.vertCount=M|0,$.type=ir;else{var oe=null,ie=hu,ve=-1,F=-1,I=0,he=0;Array.isArray(M)||h(M)||_t(M)?oe=M:(s.type(M,"object","invalid arguments for elements"),"data"in M&&(oe=M.data,s(Array.isArray(oe)||h(oe)||_t(oe),"invalid data for element buffer")),"usage"in M&&(s.parameter(M.usage,qr,"invalid element buffer usage"),ie=qr[M.usage]),"primitive"in M&&(s.parameter(M.primitive,Ot,"invalid element buffer primitive"),ve=Ot[M.primitive]),"count"in M&&(s(typeof M.count=="number"&&M.count>=0,"invalid vertex count for elements"),F=M.count|0),"type"in M&&(s.parameter(M.type,O,"invalid buffer type"),he=O[M.type]),"length"in M?I=M.length|0:(I=F,he===ar||he===ea?I*=2:(he===jt||he===ta)&&(I*=4))),Y($,oe,ie,ve,F,I,he)}return fe}return fe(X),fe._reglType="elements",fe._elements=$,fe.subdata=function(M,oe){return D.subdata(M,oe),fe},fe.destroy=function(){Z($)},fe}return{create:H,createStream:q,destroyStream:Q,getElements:function(X){return typeof X=="function"&&X._elements instanceof U?X._elements:null},clear:function(){dt(N).forEach(Z)}}}var ra=new Float32Array(1),pu=new Uint32Array(ra.buffer),mu=5123;function na(e){for(var a=He.allocType(mu,e.length),m=0;m<e.length;++m)if(isNaN(e[m]))a[m]=65535;else if(e[m]===Infinity)a[m]=31744;else if(e[m]===-Infinity)a[m]=64512;else{ra[0]=e[m];var L=pu[0],N=L>>>31<<15,w=(L<<1>>>24)-127,O=L>>13&(1<<10)-1;if(w<-24)a[m]=N;else if(w<-14){var U=-14-w;a[m]=N+(O+(1<<10)>>U)}else w>15?a[m]=N+31744:a[m]=N+(w+15<<10)+O}return a}function Me(e){return Array.isArray(e)||h(e)}var ia=function(e){return!(e&e-1)&&!!e},vu=34467,xt=3553,Bn=34067,Qr=34069,Ht=6408,kn=6406,Kr=6407,Sr=6409,Zr=6410,aa=32854,Mn=32855,oa=36194,yu=32819,_u=32820,bu=33635,Eu=34042,Vn=6402,Jr=34041,Wn=35904,Un=35906,or=36193,jn=33776,Hn=33777,zn=33778,$n=33779,sa=35986,fa=35987,ua=34798,la=35840,ca=35841,ha=35842,da=35843,pa=36196,sr=5121,Xn=5123,qn=5125,Cr=5126,xu=10242,gu=10243,Tu=10497,Yn=33071,Au=33648,Su=10240,Cu=10241,Qn=9728,wu=9729,Kn=9984,ma=9985,va=9986,Zn=9987,Lu=33170,en=4352,Ru=4353,Du=4354,Ou=34046,Gu=3317,Pu=37440,Iu=37441,Nu=37443,ya=37444,wr=33984,Fu=[Kn,va,ma,Zn],tn=[0,Sr,Zr,Kr,Ht],vt={};vt[Sr]=vt[kn]=vt[Vn]=1,vt[Jr]=vt[Zr]=2,vt[Kr]=vt[Wn]=3,vt[Ht]=vt[Un]=4;function fr(e){return"[object "+e+"]"}var _a=fr("HTMLCanvasElement"),ba=fr("OffscreenCanvas"),Ea=fr("CanvasRenderingContext2D"),xa=fr("ImageBitmap"),ga=fr("HTMLImageElement"),Ta=fr("HTMLVideoElement"),Bu=Object.keys(Gn).concat([_a,ba,Ea,xa,ga,Ta]),ur=[];ur[sr]=1,ur[Cr]=4,ur[or]=2,ur[Xn]=2,ur[qn]=4;var rt=[];rt[aa]=2,rt[Mn]=2,rt[oa]=2,rt[Jr]=4,rt[jn]=.5,rt[Hn]=.5,rt[zn]=1,rt[$n]=1,rt[sa]=.5,rt[fa]=1,rt[ua]=1,rt[la]=.5,rt[ca]=.25,rt[ha]=.5,rt[da]=.25,rt[pa]=.5;function Aa(e){return Array.isArray(e)&&(e.length===0||typeof e[0]=="number")}function Sa(e){if(!Array.isArray(e))return!1;var a=e.length;return!(a===0||!Me(e[0]))}function zt(e){return Object.prototype.toString.call(e)}function Ca(e){return zt(e)===_a}function wa(e){return zt(e)===ba}function ku(e){return zt(e)===Ea}function Mu(e){return zt(e)===xa}function Vu(e){return zt(e)===ga}function Wu(e){return zt(e)===Ta}function Jn(e){if(!e)return!1;var a=zt(e);return Bu.indexOf(a)>=0?!0:Aa(e)||Sa(e)||_t(e)}function La(e){return Gn[Object.prototype.toString.call(e)]|0}function Uu(e,a){var m=a.length;switch(e.type){case sr:case Xn:case qn:case Cr:var L=He.allocType(e.type,m);L.set(a),e.data=L;break;case or:e.data=na(a);break;default:s.raise("unsupported texture type, must specify a typed array")}}function Ra(e,a){return He.allocType(e.type===or?Cr:e.type,a)}function Da(e,a){e.type===or?(e.data=na(a),He.freeType(a)):e.data=a}function ju(e,a,m,L,N,w){for(var O=e.width,U=e.height,W=e.channels,q=O*U*W,Q=Ra(e,q),Y=0,Z=0;Z<U;++Z)for(var H=0;H<O;++H)for(var X=0;X<W;++X)Q[Y++]=a[m*H+L*Z+N*X+w];Da(e,Q)}function rn(e,a,m,L,N,w){var O;if(typeof rt[e]!="undefined"?O=rt[e]:O=vt[e]*ur[a],w&&(O*=6),N){for(var U=0,W=m;W>=1;)U+=O*W*W,W/=2;return U}else return O*m*L}function Hu(e,a,m,L,N,w,O){var U={"don't care":en,"dont care":en,nice:Du,fast:Ru},W={repeat:Tu,clamp:Yn,mirror:Au},q={nearest:Qn,linear:wu},Q=o({mipmap:Zn,"nearest mipmap nearest":Kn,"linear mipmap nearest":ma,"nearest mipmap linear":va,"linear mipmap linear":Zn},q),Y={none:0,browser:ya},Z={uint8:sr,rgba4:yu,rgb565:bu,"rgb5 a1":_u},H={alpha:kn,luminance:Sr,"luminance alpha":Zr,rgb:Kr,rgba:Ht,rgba4:aa,"rgb5 a1":Mn,rgb565:oa},X={};a.ext_srgb&&(H.srgb=Wn,H.srgba=Un),a.oes_texture_float&&(Z.float32=Z.float=Cr),a.oes_texture_half_float&&(Z.float16=Z["half float"]=or),a.webgl_depth_texture&&(o(H,{depth:Vn,"depth stencil":Jr}),o(Z,{uint16:Xn,uint32:qn,"depth stencil":Eu})),a.webgl_compressed_texture_s3tc&&o(X,{"rgb s3tc dxt1":jn,"rgba s3tc dxt1":Hn,"rgba s3tc dxt3":zn,"rgba s3tc dxt5":$n}),a.webgl_compressed_texture_atc&&o(X,{"rgb atc":sa,"rgba atc explicit alpha":fa,"rgba atc interpolated alpha":ua}),a.webgl_compressed_texture_pvrtc&&o(X,{"rgb pvrtc 4bppv1":la,"rgb pvrtc 2bppv1":ca,"rgba pvrtc 4bppv1":ha,"rgba pvrtc 2bppv1":da}),a.webgl_compressed_texture_etc1&&(X["rgb etc1"]=pa);var x=Array.prototype.slice.call(e.getParameter(vu));Object.keys(X).forEach(function(d){var R=X[d];x.indexOf(R)>=0&&(H[d]=R)});var D=Object.keys(H);m.textureFormats=D;var $=[];Object.keys(H).forEach(function(d){var R=H[d];$[R]=d});var fe=[];Object.keys(Z).forEach(function(d){var R=Z[d];fe[R]=d});var M=[];Object.keys(q).forEach(function(d){var R=q[d];M[R]=d});var oe=[];Object.keys(Q).forEach(function(d){var R=Q[d];oe[R]=d});var ie=[];Object.keys(W).forEach(function(d){var R=W[d];ie[R]=d});var ve=D.reduce(function(d,R){var C=H[R];return C===Sr||C===kn||C===Sr||C===Zr||C===Vn||C===Jr||a.ext_srgb&&(C===Wn||C===Un)?d[C]=C:C===Mn||R.indexOf("rgba")>=0?d[C]=Ht:d[C]=Kr,d},{});function F(){this.internalformat=Ht,this.format=Ht,this.type=sr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ya,this.width=0,this.height=0,this.channels=0}function I(d,R){d.internalformat=R.internalformat,d.format=R.format,d.type=R.type,d.compressed=R.compressed,d.premultiplyAlpha=R.premultiplyAlpha,d.flipY=R.flipY,d.unpackAlignment=R.unpackAlignment,d.colorSpace=R.colorSpace,d.width=R.width,d.height=R.height,d.channels=R.channels}function he(d,R){if(!(typeof R!="object"||!R)){if("premultiplyAlpha"in R&&(s.type(R.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),d.premultiplyAlpha=R.premultiplyAlpha),"flipY"in R&&(s.type(R.flipY,"boolean","invalid texture flip"),d.flipY=R.flipY),"alignment"in R&&(s.oneOf(R.alignment,[1,2,4,8],"invalid texture unpack alignment"),d.unpackAlignment=R.alignment),"colorSpace"in R&&(s.parameter(R.colorSpace,Y,"invalid colorSpace"),d.colorSpace=Y[R.colorSpace]),"type"in R){var C=R.type;s(a.oes_texture_float||!(C==="float"||C==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),s(a.oes_texture_half_float||!(C==="half float"||C==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),s(a.webgl_depth_texture||!(C==="uint16"||C==="uint32"||C==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),s.parameter(C,Z,"invalid texture type"),d.type=Z[C]}var ce=d.width,Re=d.height,u=d.channels,i=!1;"shape"in R?(s(Array.isArray(R.shape)&&R.shape.length>=2,"shape must be an array"),ce=R.shape[0],Re=R.shape[1],R.shape.length===3&&(u=R.shape[2],s(u>0&&u<=4,"invalid number of channels"),i=!0),s(ce>=0&&ce<=m.maxTextureSize,"invalid width"),s(Re>=0&&Re<=m.maxTextureSize,"invalid height")):("radius"in R&&(ce=Re=R.radius,s(ce>=0&&ce<=m.maxTextureSize,"invalid radius")),"width"in R&&(ce=R.width,s(ce>=0&&ce<=m.maxTextureSize,"invalid width")),"height"in R&&(Re=R.height,s(Re>=0&&Re<=m.maxTextureSize,"invalid height")),"channels"in R&&(u=R.channels,s(u>0&&u<=4,"invalid number of channels"),i=!0)),d.width=ce|0,d.height=Re|0,d.channels=u|0;var v=!1;if("format"in R){var E=R.format;s(a.webgl_depth_texture||!(E==="depth"||E==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),s.parameter(E,H,"invalid texture format");var g=d.internalformat=H[E];d.format=ve[g],E in Z&&("type"in R||(d.type=Z[E])),E in X&&(d.compressed=!0),v=!0}!i&&v?d.channels=vt[d.format]:i&&!v?d.channels!==tn[d.format]&&(d.format=d.internalformat=tn[d.channels]):v&&i&&s(d.channels===vt[d.format],"number of channels inconsistent with specified format")}}function J(d){e.pixelStorei(Pu,d.flipY),e.pixelStorei(Iu,d.premultiplyAlpha),e.pixelStorei(Nu,d.colorSpace),e.pixelStorei(Gu,d.unpackAlignment)}function z(){F.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ee(d,R){var C=null;if(Jn(R)?C=R:R&&(s.type(R,"object","invalid pixel data type"),he(d,R),"x"in R&&(d.xOffset=R.x|0),"y"in R&&(d.yOffset=R.y|0),Jn(R.data)&&(C=R.data)),s(!d.compressed||C instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),R.copy){s(!C,"can not specify copy and data field for the same texture");var ce=N.viewportWidth,Re=N.viewportHeight;d.width=d.width||ce-d.xOffset,d.height=d.height||Re-d.yOffset,d.needsCopy=!0,s(d.xOffset>=0&&d.xOffset<ce&&d.yOffset>=0&&d.yOffset<Re&&d.width>0&&d.width<=ce&&d.height>0&&d.height<=Re,"copy texture read out of bounds")}else if(!C)d.width=d.width||1,d.height=d.height||1,d.channels=d.channels||4;else if(h(C))d.channels=d.channels||4,d.data=C,!("type"in R)&&d.type===sr&&(d.type=La(C));else if(Aa(C))d.channels=d.channels||4,Uu(d,C),d.alignment=1,d.needsFree=!0;else if(_t(C)){var u=C.data;!Array.isArray(u)&&d.type===sr&&(d.type=La(u));var i=C.shape,v=C.stride,E,g,_,y,b,l;i.length===3?(_=i[2],l=v[2]):(s(i.length===2,"invalid ndarray pixel data, must be 2 or 3D"),_=1,l=1),E=i[0],g=i[1],y=v[0],b=v[1],d.alignment=1,d.width=E,d.height=g,d.channels=_,d.format=d.internalformat=tn[_],d.needsFree=!0,ju(d,u,y,b,l,C.offset)}else if(Ca(C)||wa(C)||ku(C))Ca(C)||wa(C)?d.element=C:d.element=C.canvas,d.width=d.element.width,d.height=d.element.height,d.channels=4;else if(Mu(C))d.element=C,d.width=C.width,d.height=C.height,d.channels=4;else if(Vu(C))d.element=C,d.width=C.naturalWidth,d.height=C.naturalHeight,d.channels=4;else if(Wu(C))d.element=C,d.width=C.videoWidth,d.height=C.videoHeight,d.channels=4;else if(Sa(C)){var p=d.width||C[0].length,c=d.height||C.length,A=d.channels;Me(C[0][0])?A=A||C[0][0].length:A=A||1;for(var T=Xr.shape(C),P=1,B=0;B<T.length;++B)P*=T[B];var K=Ra(d,P);Xr.flatten(C,T,"",K),Da(d,K),d.alignment=1,d.width=p,d.height=c,d.channels=A,d.format=d.internalformat=tn[A],d.needsFree=!0}d.type===Cr?s(m.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):d.type===or&&s(m.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function te(d,R,C){var ce=d.element,Re=d.data,u=d.internalformat,i=d.format,v=d.type,E=d.width,g=d.height;J(d),ce?e.texImage2D(R,C,i,i,v,ce):d.compressed?e.compressedTexImage2D(R,C,u,E,g,0,Re):d.needsCopy?(L(),e.copyTexImage2D(R,C,i,d.xOffset,d.yOffset,E,g,0)):e.texImage2D(R,C,i,E,g,0,i,v,Re||null)}function Te(d,R,C,ce,Re){var u=d.element,i=d.data,v=d.internalformat,E=d.format,g=d.type,_=d.width,y=d.height;J(d),u?e.texSubImage2D(R,Re,C,ce,E,g,u):d.compressed?e.compressedTexSubImage2D(R,Re,C,ce,v,_,y,i):d.needsCopy?(L(),e.copyTexSubImage2D(R,Re,C,ce,d.xOffset,d.yOffset,_,y)):e.texSubImage2D(R,Re,C,ce,_,y,E,g,i)}var ge=[];function ae(){return ge.pop()||new z}function se(d){d.needsFree&&He.freeType(d.data),z.call(d),ge.push(d)}function be(){F.call(this),this.genMipmaps=!1,this.mipmapHint=en,this.mipmask=0,this.images=Array(16)}function Ae(d,R,C){var ce=d.images[0]=ae();d.mipmask=1,ce.width=d.width=R,ce.height=d.height=C,ce.channels=d.channels=4}function De(d,R){var C=null;if(Jn(R))C=d.images[0]=ae(),I(C,d),ee(C,R),d.mipmask=1;else if(he(d,R),Array.isArray(R.mipmap))for(var ce=R.mipmap,Re=0;Re<ce.length;++Re)C=d.images[Re]=ae(),I(C,d),C.width>>=Re,C.height>>=Re,ee(C,ce[Re]),d.mipmask|=1<<Re;else C=d.images[0]=ae(),I(C,d),ee(C,R),d.mipmask=1;I(d,d.images[0]),d.compressed&&(d.internalformat===jn||d.internalformat===Hn||d.internalformat===zn||d.internalformat===$n)&&s(d.width%4==0&&d.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ve(d,R){for(var C=d.images,ce=0;ce<C.length;++ce){if(!C[ce])return;te(C[ce],R,ce)}}var We=[];function Ge(){var d=We.pop()||new be;F.call(d),d.mipmask=0;for(var R=0;R<16;++R)d.images[R]=null;return d}function Xe(d){for(var R=d.images,C=0;C<R.length;++C)R[C]&&se(R[C]),R[C]=null;We.push(d)}function ke(){this.minFilter=Qn,this.magFilter=Qn,this.wrapS=Yn,this.wrapT=Yn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=en}function $e(d,R){if("min"in R){var C=R.min;s.parameter(C,Q),d.minFilter=Q[C],Fu.indexOf(d.minFilter)>=0&&!("faces"in R)&&(d.genMipmaps=!0)}if("mag"in R){var ce=R.mag;s.parameter(ce,q),d.magFilter=q[ce]}var Re=d.wrapS,u=d.wrapT;if("wrap"in R){var i=R.wrap;typeof i=="string"?(s.parameter(i,W),Re=u=W[i]):Array.isArray(i)&&(s.parameter(i[0],W),s.parameter(i[1],W),Re=W[i[0]],u=W[i[1]])}else{if("wrapS"in R){var v=R.wrapS;s.parameter(v,W),Re=W[v]}if("wrapT"in R){var E=R.wrapT;s.parameter(E,W),u=W[E]}}if(d.wrapS=Re,d.wrapT=u,"anisotropic"in R){var g=R.anisotropic;s(typeof g=="number"&&g>=1&&g<=m.maxAnisotropic,"aniso samples must be between 1 and "),d.anisotropic=R.anisotropic}if("mipmap"in R){var _=!1;switch(typeof R.mipmap){case"string":s.parameter(R.mipmap,U,"invalid mipmap hint"),d.mipmapHint=U[R.mipmap],d.genMipmaps=!0,_=!0;break;case"boolean":_=d.genMipmaps=R.mipmap;break;case"object":s(Array.isArray(R.mipmap),"invalid mipmap type"),d.genMipmaps=!1,_=!0;break;default:s.raise("invalid mipmap type")}_&&!("min"in R)&&(d.minFilter=Kn)}}function qe(d,R){e.texParameteri(R,Cu,d.minFilter),e.texParameteri(R,Su,d.magFilter),e.texParameteri(R,xu,d.wrapS),e.texParameteri(R,gu,d.wrapT),a.ext_texture_filter_anisotropic&&e.texParameteri(R,Ou,d.anisotropic),d.genMipmaps&&(e.hint(Lu,d.mipmapHint),e.generateMipmap(R))}var Ye=0,et={},nt=m.maxTextureUnits,Ue=Array(nt).map(function(){return null});function Se(d){F.call(this),this.mipmask=0,this.internalformat=Ht,this.id=Ye++,this.refCount=1,this.target=d,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ke,O.profile&&(this.stats={size:0})}function it(d){e.activeTexture(wr),e.bindTexture(d.target,d.texture)}function Ie(){var d=Ue[0];d?e.bindTexture(d.target,d.texture):e.bindTexture(xt,null)}function ye(d){var R=d.texture;s(R,"must not double destroy texture");var C=d.unit,ce=d.target;C>=0&&(e.activeTexture(wr+C),e.bindTexture(ce,null),Ue[C]=null),e.deleteTexture(R),d.texture=null,d.params=null,d.pixels=null,d.refCount=0,delete et[d.id],w.textureCount--}o(Se.prototype,{bind:function(){var d=this;d.bindCount+=1;var R=d.unit;if(R<0){for(var C=0;C<nt;++C){var ce=Ue[C];if(ce){if(ce.bindCount>0)continue;ce.unit=-1}Ue[C]=d,R=C;break}R>=nt&&s.raise("insufficient number of texture units"),O.profile&&w.maxTextureUnits<R+1&&(w.maxTextureUnits=R+1),d.unit=R,e.activeTexture(wr+R),e.bindTexture(d.target,d.texture)}return R},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ye(this)}});function Oe(d,R){var C=new Se(xt);et[C.id]=C,w.textureCount++;function ce(i,v){var E=C.texInfo;ke.call(E);var g=Ge();return typeof i=="number"?typeof v=="number"?Ae(g,i|0,v|0):Ae(g,i|0,i|0):i?(s.type(i,"object","invalid arguments to regl.texture"),$e(E,i),De(g,i)):Ae(g,1,1),E.genMipmaps&&(g.mipmask=(g.width<<1)-1),C.mipmask=g.mipmask,I(C,g),s.texture2D(E,g,m),C.internalformat=g.internalformat,ce.width=g.width,ce.height=g.height,it(C),Ve(g,xt),qe(E,xt),Ie(),Xe(g),O.profile&&(C.stats.size=rn(C.internalformat,C.type,g.width,g.height,E.genMipmaps,!1)),ce.format=$[C.internalformat],ce.type=fe[C.type],ce.mag=M[E.magFilter],ce.min=oe[E.minFilter],ce.wrapS=ie[E.wrapS],ce.wrapT=ie[E.wrapT],ce}function Re(i,v,E,g){s(!!i,"must specify image data");var _=v|0,y=E|0,b=g|0,l=ae();return I(l,C),l.width=0,l.height=0,ee(l,i),l.width=l.width||(C.width>>b)-_,l.height=l.height||(C.height>>b)-y,s(C.type===l.type&&C.format===l.format&&C.internalformat===l.internalformat,"incompatible format for texture.subimage"),s(_>=0&&y>=0&&_+l.width<=C.width&&y+l.height<=C.height,"texture.subimage write out of bounds"),s(C.mipmask&1<<b,"missing mipmap data"),s(l.data||l.element||l.needsCopy,"missing image data"),it(C),Te(l,xt,_,y,b),Ie(),se(l),ce}function u(i,v){var E=i|0,g=v|0||E;if(E===C.width&&g===C.height)return ce;ce.width=C.width=E,ce.height=C.height=g,it(C);for(var _=0;C.mipmask>>_;++_){var y=E>>_,b=g>>_;if(!y||!b)break;e.texImage2D(xt,_,C.format,y,b,0,C.format,C.type,null)}return Ie(),O.profile&&(C.stats.size=rn(C.internalformat,C.type,E,g,!1,!1)),ce}return ce(d,R),ce.subimage=Re,ce.resize=u,ce._reglType="texture2d",ce._texture=C,O.profile&&(ce.stats=C.stats),ce.destroy=function(){C.decRef()},ce}function Pe(d,R,C,ce,Re,u){var i=new Se(Bn);et[i.id]=i,w.cubeCount++;var v=new Array(6);function E(y,b,l,p,c,A){var T,P=i.texInfo;for(ke.call(P),T=0;T<6;++T)v[T]=Ge();if(typeof y=="number"||!y){var B=y|0||1;for(T=0;T<6;++T)Ae(v[T],B,B)}else if(typeof y=="object")if(b)De(v[0],y),De(v[1],b),De(v[2],l),De(v[3],p),De(v[4],c),De(v[5],A);else if($e(P,y),he(i,y),"faces"in y){var K=y.faces;for(s(Array.isArray(K)&&K.length===6,"cube faces must be a length 6 array"),T=0;T<6;++T)s(typeof K[T]=="object"&&!!K[T],"invalid input for cube map face"),I(v[T],i),De(v[T],K[T])}else for(T=0;T<6;++T)De(v[T],y);else s.raise("invalid arguments to cube map");for(I(i,v[0]),s.optional(function(){m.npotTextureCube||s(ia(i.width)&&ia(i.height),"your browser does not support non power or two texture dimensions")}),P.genMipmaps?i.mipmask=(v[0].width<<1)-1:i.mipmask=v[0].mipmask,s.textureCube(i,P,v,m),i.internalformat=v[0].internalformat,E.width=v[0].width,E.height=v[0].height,it(i),T=0;T<6;++T)Ve(v[T],Qr+T);for(qe(P,Bn),Ie(),O.profile&&(i.stats.size=rn(i.internalformat,i.type,E.width,E.height,P.genMipmaps,!0)),E.format=$[i.internalformat],E.type=fe[i.type],E.mag=M[P.magFilter],E.min=oe[P.minFilter],E.wrapS=ie[P.wrapS],E.wrapT=ie[P.wrapT],T=0;T<6;++T)Xe(v[T]);return E}function g(y,b,l,p,c){s(!!b,"must specify image data"),s(typeof y=="number"&&y===(y|0)&&y>=0&&y<6,"invalid face");var A=l|0,T=p|0,P=c|0,B=ae();return I(B,i),B.width=0,B.height=0,ee(B,b),B.width=B.width||(i.width>>P)-A,B.height=B.height||(i.height>>P)-T,s(i.type===B.type&&i.format===B.format&&i.internalformat===B.internalformat,"incompatible format for texture.subimage"),s(A>=0&&T>=0&&A+B.width<=i.width&&T+B.height<=i.height,"texture.subimage write out of bounds"),s(i.mipmask&1<<P,"missing mipmap data"),s(B.data||B.element||B.needsCopy,"missing image data"),it(i),Te(B,Qr+y,A,T,P),Ie(),se(B),E}function _(y){var b=y|0;if(b!==i.width){E.width=i.width=b,E.height=i.height=b,it(i);for(var l=0;l<6;++l)for(var p=0;i.mipmask>>p;++p)e.texImage2D(Qr+l,p,i.format,b>>p,b>>p,0,i.format,i.type,null);return Ie(),O.profile&&(i.stats.size=rn(i.internalformat,i.type,E.width,E.height,!1,!0)),E}}return E(d,R,C,ce,Re,u),E.subimage=g,E.resize=_,E._reglType="textureCube",E._texture=i,O.profile&&(E.stats=i.stats),E.destroy=function(){i.decRef()},E}function je(){for(var d=0;d<nt;++d)e.activeTexture(wr+d),e.bindTexture(xt,null),Ue[d]=null;dt(et).forEach(ye),w.cubeCount=0,w.textureCount=0}O.profile&&(w.getTotalTextureSize=function(){var d=0;return Object.keys(et).forEach(function(R){d+=et[R].stats.size}),d});function Tt(){for(var d=0;d<nt;++d){var R=Ue[d];R&&(R.bindCount=0,R.unit=-1,Ue[d]=null)}dt(et).forEach(function(C){C.texture=e.createTexture(),e.bindTexture(C.target,C.texture);for(var ce=0;ce<32;++ce)if((C.mipmask&1<<ce)!=0)if(C.target===xt)e.texImage2D(xt,ce,C.internalformat,C.width>>ce,C.height>>ce,0,C.internalformat,C.type,null);else for(var Re=0;Re<6;++Re)e.texImage2D(Qr+Re,ce,C.internalformat,C.width>>ce,C.height>>ce,0,C.internalformat,C.type,null);qe(C.texInfo,C.target)})}function Zt(){for(var d=0;d<nt;++d){var R=Ue[d];R&&(R.bindCount=0,R.unit=-1,Ue[d]=null),e.activeTexture(wr+d),e.bindTexture(xt,null),e.bindTexture(Bn,null)}}return{create2D:Oe,createCube:Pe,clear:je,getTexture:function(d){return null},restore:Tt,refresh:Zt}}var Gt=36161,nn=32854,Oa=32855,Ga=36194,Pa=33189,Ia=36168,Na=34041,Fa=35907,Ba=34836,ka=34842,Ma=34843,bt=[];bt[nn]=2,bt[Oa]=2,bt[Ga]=2,bt[Pa]=2,bt[Ia]=1,bt[Na]=4,bt[Fa]=4,bt[Ba]=16,bt[ka]=8,bt[Ma]=6;function Va(e,a,m){return bt[e]*a*m}var zu=function(e,a,m,L,N){var w={rgba4:nn,rgb565:Ga,"rgb5 a1":Oa,depth:Pa,stencil:Ia,"depth stencil":Na};a.ext_srgb&&(w.srgba=Fa),a.ext_color_buffer_half_float&&(w.rgba16f=ka,w.rgb16f=Ma),a.webgl_color_buffer_float&&(w.rgba32f=Ba);var O=[];Object.keys(w).forEach(function(H){var X=w[H];O[X]=H});var U=0,W={};function q(H){this.id=U++,this.refCount=1,this.renderbuffer=H,this.format=nn,this.width=0,this.height=0,N.profile&&(this.stats={size:0})}q.prototype.decRef=function(){--this.refCount<=0&&Q(this)};function Q(H){var X=H.renderbuffer;s(X,"must not double destroy renderbuffer"),e.bindRenderbuffer(Gt,null),e.deleteRenderbuffer(X),H.renderbuffer=null,H.refCount=0,delete W[H.id],L.renderbufferCount--}function Y(H,X){var x=new q(e.createRenderbuffer());W[x.id]=x,L.renderbufferCount++;function D(fe,M){var oe=0,ie=0,ve=nn;if(typeof fe=="object"&&fe){var F=fe;if("shape"in F){var I=F.shape;s(Array.isArray(I)&&I.length>=2,"invalid renderbuffer shape"),oe=I[0]|0,ie=I[1]|0}else"radius"in F&&(oe=ie=F.radius|0),"width"in F&&(oe=F.width|0),"height"in F&&(ie=F.height|0);"format"in F&&(s.parameter(F.format,w,"invalid renderbuffer format"),ve=w[F.format])}else typeof fe=="number"?(oe=fe|0,typeof M=="number"?ie=M|0:ie=oe):fe?s.raise("invalid arguments to renderbuffer constructor"):oe=ie=1;if(s(oe>0&&ie>0&&oe<=m.maxRenderbufferSize&&ie<=m.maxRenderbufferSize,"invalid renderbuffer size"),!(oe===x.width&&ie===x.height&&ve===x.format))return D.width=x.width=oe,D.height=x.height=ie,x.format=ve,e.bindRenderbuffer(Gt,x.renderbuffer),e.renderbufferStorage(Gt,ve,oe,ie),s(e.getError()===0,"invalid render buffer format"),N.profile&&(x.stats.size=Va(x.format,x.width,x.height)),D.format=O[x.format],D}function $(fe,M){var oe=fe|0,ie=M|0||oe;return oe===x.width&&ie===x.height||(s(oe>0&&ie>0&&oe<=m.maxRenderbufferSize&&ie<=m.maxRenderbufferSize,"invalid renderbuffer size"),D.width=x.width=oe,D.height=x.height=ie,e.bindRenderbuffer(Gt,x.renderbuffer),e.renderbufferStorage(Gt,x.format,oe,ie),s(e.getError()===0,"invalid render buffer format"),N.profile&&(x.stats.size=Va(x.format,x.width,x.height))),D}return D(H,X),D.resize=$,D._reglType="renderbuffer",D._renderbuffer=x,N.profile&&(D.stats=x.stats),D.destroy=function(){x.decRef()},D}N.profile&&(L.getTotalRenderbufferSize=function(){var H=0;return Object.keys(W).forEach(function(X){H+=W[X].stats.size}),H});function Z(){dt(W).forEach(function(H){H.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(Gt,H.renderbuffer),e.renderbufferStorage(Gt,H.format,H.width,H.height)}),e.bindRenderbuffer(Gt,null)}return{create:Y,clear:function(){dt(W).forEach(Q)},restore:Z}},Ct=36160,ei=36161,$t=3553,an=34069,Wa=36064,Ua=36096,ja=36128,Ha=33306,za=36053,$u=36054,Xu=36055,qu=36057,Yu=36061,Qu=36193,Ku=5121,Zu=5126,$a=6407,Xa=6408,Ju=6402,el=[$a,Xa],ti=[];ti[Xa]=4,ti[$a]=3;var on=[];on[Ku]=1,on[Zu]=4,on[Qu]=2;var tl=32854,rl=32855,nl=36194,il=33189,al=36168,qa=34041,ol=35907,sl=34836,fl=34842,ul=34843,ll=[tl,rl,nl,ol,fl,ul,sl],lr={};lr[za]="complete",lr[$u]="incomplete attachment",lr[qu]="incomplete dimensions",lr[Xu]="incomplete, missing attachment",lr[Yu]="unsupported";function cl(e,a,m,L,N,w){var O={cur:null,next:null,dirty:!1,setFBO:null},U=["rgba"],W=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&W.push("srgba"),a.ext_color_buffer_half_float&&W.push("rgba16f","rgb16f"),a.webgl_color_buffer_float&&W.push("rgba32f");var q=["uint8"];a.oes_texture_half_float&&q.push("half float","float16"),a.oes_texture_float&&q.push("float","float32");function Q(z,ee,te){this.target=z,this.texture=ee,this.renderbuffer=te;var Te=0,ge=0;ee?(Te=ee.width,ge=ee.height):te&&(Te=te.width,ge=te.height),this.width=Te,this.height=ge}function Y(z){z&&(z.texture&&z.texture._texture.decRef(),z.renderbuffer&&z.renderbuffer._renderbuffer.decRef())}function Z(z,ee,te){if(!!z)if(z.texture){var Te=z.texture._texture,ge=Math.max(1,Te.width),ae=Math.max(1,Te.height);s(ge===ee&&ae===te,"inconsistent width/height for supplied texture"),Te.refCount+=1}else{var se=z.renderbuffer._renderbuffer;s(se.width===ee&&se.height===te,"inconsistent width/height for renderbuffer"),se.refCount+=1}}function H(z,ee){ee&&(ee.texture?e.framebufferTexture2D(Ct,z,ee.target,ee.texture._texture.texture,0):e.framebufferRenderbuffer(Ct,z,ei,ee.renderbuffer._renderbuffer.renderbuffer))}function X(z){var ee=$t,te=null,Te=null,ge=z;typeof z=="object"&&(ge=z.data,"target"in z&&(ee=z.target|0)),s.type(ge,"function","invalid attachment data");var ae=ge._reglType;return ae==="texture2d"?(te=ge,s(ee===$t)):ae==="textureCube"?(te=ge,s(ee>=an&&ee<an+6,"invalid cube map target")):ae==="renderbuffer"?(Te=ge,ee=ei):s.raise("invalid regl object for attachment"),new Q(ee,te,Te)}function x(z,ee,te,Te,ge){if(te){var ae=L.create2D({width:z,height:ee,format:Te,type:ge});return ae._texture.refCount=0,new Q($t,ae,null)}else{var se=N.create({width:z,height:ee,format:Te});return se._renderbuffer.refCount=0,new Q(ei,null,se)}}function D(z){return z&&(z.texture||z.renderbuffer)}function $(z,ee,te){z&&(z.texture?z.texture.resize(ee,te):z.renderbuffer&&z.renderbuffer.resize(ee,te),z.width=ee,z.height=te)}var fe=0,M={};function oe(){this.id=fe++,M[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ie(z){z.colorAttachments.forEach(Y),Y(z.depthAttachment),Y(z.stencilAttachment),Y(z.depthStencilAttachment)}function ve(z){var ee=z.framebuffer;s(ee,"must not double destroy framebuffer"),e.deleteFramebuffer(ee),z.framebuffer=null,w.framebufferCount--,delete M[z.id]}function F(z){var ee;e.bindFramebuffer(Ct,z.framebuffer);var te=z.colorAttachments;for(ee=0;ee<te.length;++ee)H(Wa+ee,te[ee]);for(ee=te.length;ee<m.maxColorAttachments;++ee)e.framebufferTexture2D(Ct,Wa+ee,$t,null,0);e.framebufferTexture2D(Ct,Ha,$t,null,0),e.framebufferTexture2D(Ct,Ua,$t,null,0),e.framebufferTexture2D(Ct,ja,$t,null,0),H(Ua,z.depthAttachment),H(ja,z.stencilAttachment),H(Ha,z.depthStencilAttachment);var Te=e.checkFramebufferStatus(Ct);!e.isContextLost()&&Te!==za&&s.raise("framebuffer configuration not supported, status = "+lr[Te]),e.bindFramebuffer(Ct,O.next?O.next.framebuffer:null),O.cur=O.next,e.getError()}function I(z,ee){var te=new oe;w.framebufferCount++;function Te(ae,se){var be;s(O.next!==te,"can not update framebuffer which is currently in use");var Ae=0,De=0,Ve=!0,We=!0,Ge=null,Xe=!0,ke="rgba",$e="uint8",qe=1,Ye=null,et=null,nt=null,Ue=!1;if(typeof ae=="number")Ae=ae|0,De=se|0||Ae;else if(!ae)Ae=De=1;else{s.type(ae,"object","invalid arguments for framebuffer");var Se=ae;if("shape"in Se){var it=Se.shape;s(Array.isArray(it)&&it.length>=2,"invalid shape for framebuffer"),Ae=it[0],De=it[1]}else"radius"in Se&&(Ae=De=Se.radius),"width"in Se&&(Ae=Se.width),"height"in Se&&(De=Se.height);("color"in Se||"colors"in Se)&&(Ge=Se.color||Se.colors,Array.isArray(Ge)&&s(Ge.length===1||a.webgl_draw_buffers,"multiple render targets not supported")),Ge||("colorCount"in Se&&(qe=Se.colorCount|0,s(qe>0,"invalid color buffer count")),"colorTexture"in Se&&(Xe=!!Se.colorTexture,ke="rgba4"),"colorType"in Se&&($e=Se.colorType,Xe?(s(a.oes_texture_float||!($e==="float"||$e==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),s(a.oes_texture_half_float||!($e==="half float"||$e==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):$e==="half float"||$e==="float16"?(s(a.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ke="rgba16f"):($e==="float"||$e==="float32")&&(s(a.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ke="rgba32f"),s.oneOf($e,q,"invalid color type")),"colorFormat"in Se&&(ke=Se.colorFormat,U.indexOf(ke)>=0?Xe=!0:W.indexOf(ke)>=0?Xe=!1:s.optional(function(){Xe?s.oneOf(Se.colorFormat,U,"invalid color format for texture"):s.oneOf(Se.colorFormat,W,"invalid color format for renderbuffer")}))),("depthTexture"in Se||"depthStencilTexture"in Se)&&(Ue=!!(Se.depthTexture||Se.depthStencilTexture),s(!Ue||a.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Se&&(typeof Se.depth=="boolean"?Ve=Se.depth:(Ye=Se.depth,We=!1)),"stencil"in Se&&(typeof Se.stencil=="boolean"?We=Se.stencil:(et=Se.stencil,Ve=!1)),"depthStencil"in Se&&(typeof Se.depthStencil=="boolean"?Ve=We=Se.depthStencil:(nt=Se.depthStencil,Ve=!1,We=!1))}var Ie=null,ye=null,Oe=null,Pe=null;if(Array.isArray(Ge))Ie=Ge.map(X);else if(Ge)Ie=[X(Ge)];else for(Ie=new Array(qe),be=0;be<qe;++be)Ie[be]=x(Ae,De,Xe,ke,$e);s(a.webgl_draw_buffers||Ie.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),s(Ie.length<=m.maxColorAttachments,"too many color attachments, not supported"),Ae=Ae||Ie[0].width,De=De||Ie[0].height,Ye?ye=X(Ye):Ve&&!We&&(ye=x(Ae,De,Ue,"depth","uint32")),et?Oe=X(et):We&&!Ve&&(Oe=x(Ae,De,!1,"stencil","uint8")),nt?Pe=X(nt):!Ye&&!et&&We&&Ve&&(Pe=x(Ae,De,Ue,"depth stencil","depth stencil")),s(!!Ye+!!et+!!nt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var je=null;for(be=0;be<Ie.length;++be)if(Z(Ie[be],Ae,De),s(!Ie[be]||Ie[be].texture&&el.indexOf(Ie[be].texture._texture.format)>=0||Ie[be].renderbuffer&&ll.indexOf(Ie[be].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+be+" is invalid"),Ie[be]&&Ie[be].texture){var Tt=ti[Ie[be].texture._texture.format]*on[Ie[be].texture._texture.type];je===null?je=Tt:s(je===Tt,"all color attachments much have the same number of bits per pixel.")}return Z(ye,Ae,De),s(!ye||ye.texture&&ye.texture._texture.format===Ju||ye.renderbuffer&&ye.renderbuffer._renderbuffer.format===il,"invalid depth attachment for framebuffer object"),Z(Oe,Ae,De),s(!Oe||Oe.renderbuffer&&Oe.renderbuffer._renderbuffer.format===al,"invalid stencil attachment for framebuffer object"),Z(Pe,Ae,De),s(!Pe||Pe.texture&&Pe.texture._texture.format===qa||Pe.renderbuffer&&Pe.renderbuffer._renderbuffer.format===qa,"invalid depth-stencil attachment for framebuffer object"),ie(te),te.width=Ae,te.height=De,te.colorAttachments=Ie,te.depthAttachment=ye,te.stencilAttachment=Oe,te.depthStencilAttachment=Pe,Te.color=Ie.map(D),Te.depth=D(ye),Te.stencil=D(Oe),Te.depthStencil=D(Pe),Te.width=te.width,Te.height=te.height,F(te),Te}function ge(ae,se){s(O.next!==te,"can not resize a framebuffer which is currently in use");var be=Math.max(ae|0,1),Ae=Math.max(se|0||be,1);if(be===te.width&&Ae===te.height)return Te;for(var De=te.colorAttachments,Ve=0;Ve<De.length;++Ve)$(De[Ve],be,Ae);return $(te.depthAttachment,be,Ae),$(te.stencilAttachment,be,Ae),$(te.depthStencilAttachment,be,Ae),te.width=Te.width=be,te.height=Te.height=Ae,F(te),Te}return Te(z,ee),o(Te,{resize:ge,_reglType:"framebuffer",_framebuffer:te,destroy:function(){ve(te),ie(te)},use:function(ae){O.setFBO({framebuffer:Te},ae)}})}function he(z){var ee=Array(6);function te(ge){var ae;s(ee.indexOf(O.next)<0,"can not update framebuffer which is currently in use");var se={color:null},be=0,Ae=null,De="rgba",Ve="uint8",We=1;if(typeof ge=="number")be=ge|0;else if(!ge)be=1;else{s.type(ge,"object","invalid arguments for framebuffer");var Ge=ge;if("shape"in Ge){var Xe=Ge.shape;s(Array.isArray(Xe)&&Xe.length>=2,"invalid shape for framebuffer"),s(Xe[0]===Xe[1],"cube framebuffer must be square"),be=Xe[0]}else"radius"in Ge&&(be=Ge.radius|0),"width"in Ge?(be=Ge.width|0,"height"in Ge&&s(Ge.height===be,"must be square")):"height"in Ge&&(be=Ge.height|0);("color"in Ge||"colors"in Ge)&&(Ae=Ge.color||Ge.colors,Array.isArray(Ae)&&s(Ae.length===1||a.webgl_draw_buffers,"multiple render targets not supported")),Ae||("colorCount"in Ge&&(We=Ge.colorCount|0,s(We>0,"invalid color buffer count")),"colorType"in Ge&&(s.oneOf(Ge.colorType,q,"invalid color type"),Ve=Ge.colorType),"colorFormat"in Ge&&(De=Ge.colorFormat,s.oneOf(Ge.colorFormat,U,"invalid color format for texture"))),"depth"in Ge&&(se.depth=Ge.depth),"stencil"in Ge&&(se.stencil=Ge.stencil),"depthStencil"in Ge&&(se.depthStencil=Ge.depthStencil)}var ke;if(Ae)if(Array.isArray(Ae))for(ke=[],ae=0;ae<Ae.length;++ae)ke[ae]=Ae[ae];else ke=[Ae];else{ke=Array(We);var $e={radius:be,format:De,type:Ve};for(ae=0;ae<We;++ae)ke[ae]=L.createCube($e)}for(se.color=Array(ke.length),ae=0;ae<ke.length;++ae){var qe=ke[ae];s(typeof qe=="function"&&qe._reglType==="textureCube","invalid cube map"),be=be||qe.width,s(qe.width===be&&qe.height===be,"invalid cube map shape"),se.color[ae]={target:an,data:ke[ae]}}for(ae=0;ae<6;++ae){for(var Ye=0;Ye<ke.length;++Ye)se.color[Ye].target=an+ae;ae>0&&(se.depth=ee[0].depth,se.stencil=ee[0].stencil,se.depthStencil=ee[0].depthStencil),ee[ae]?ee[ae](se):ee[ae]=I(se)}return o(te,{width:be,height:be,color:ke})}function Te(ge){var ae,se=ge|0;if(s(se>0&&se<=m.maxCubeMapSize,"invalid radius for cube fbo"),se===te.width)return te;var be=te.color;for(ae=0;ae<be.length;++ae)be[ae].resize(se);for(ae=0;ae<6;++ae)ee[ae].resize(se);return te.width=te.height=se,te}return te(z),o(te,{faces:ee,resize:Te,_reglType:"framebufferCube",destroy:function(){ee.forEach(function(ge){ge.destroy()})}})}function J(){O.cur=null,O.next=null,O.dirty=!0,dt(M).forEach(function(z){z.framebuffer=e.createFramebuffer(),F(z)})}return o(O,{getFramebuffer:function(z){if(typeof z=="function"&&z._reglType==="framebuffer"){var ee=z._framebuffer;if(ee instanceof oe)return ee}return null},create:I,createCube:he,clear:function(){dt(M).forEach(ve)},restore:J})}var hl=5126,Ya=34962,sn=34963,Qa=["attributes","elements","offset","count","primitive","instances"];function ri(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=hl,this.offset=0,this.stride=0,this.divisor=0}function dl(e,a,m,L,N,w,O){for(var U=m.maxAttributes,W=new Array(U),q=0;q<U;++q)W[q]=new ri;var Q=0,Y={},Z={Record:ri,scope:{},state:W,currentVAO:null,targetVAO:null,restore:X()?ie:function(){},createVAO:ve,getVAO:D,destroyBuffer:H,setVAO:X()?$:fe,clear:X()?M:function(){}};function H(F){for(var I=0;I<W.length;++I){var he=W[I];he.buffer===F&&(e.disableVertexAttribArray(I),he.buffer=null)}}function X(){return a.oes_vertex_array_object}function x(){return a.angle_instanced_arrays}function D(F){return typeof F=="function"&&F._vao?F._vao:null}function $(F){if(F!==Z.currentVAO){var I=X();F?I.bindVertexArrayOES(F.vao):I.bindVertexArrayOES(null),Z.currentVAO=F}}function fe(F){if(F!==Z.currentVAO){if(F)F.bindAttrs();else{for(var I=x(),he=0;he<W.length;++he){var J=W[he];J.buffer?(e.enableVertexAttribArray(he),J.buffer.bind(),e.vertexAttribPointer(he,J.size,J.type,J.normalized,J.stride,J.offfset),I&&J.divisor&&I.vertexAttribDivisorANGLE(he,J.divisor)):(e.disableVertexAttribArray(he),e.vertexAttrib4f(he,J.x,J.y,J.z,J.w))}O.elements?e.bindBuffer(sn,O.elements.buffer.buffer):e.bindBuffer(sn,null)}Z.currentVAO=F}}function M(){dt(Y).forEach(function(F){F.destroy()})}function oe(){this.id=++Q,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var F=X();F?this.vao=F.createVertexArrayOES():this.vao=null,Y[this.id]=this,this.buffers=[]}oe.prototype.bindAttrs=function(){for(var F=x(),I=this.attributes,he=0;he<I.length;++he){var J=I[he];J.buffer?(e.enableVertexAttribArray(he),e.bindBuffer(Ya,J.buffer.buffer),e.vertexAttribPointer(he,J.size,J.type,J.normalized,J.stride,J.offset),F&&J.divisor&&F.vertexAttribDivisorANGLE(he,J.divisor)):(e.disableVertexAttribArray(he),e.vertexAttrib4f(he,J.x,J.y,J.z,J.w))}for(var z=I.length;z<U;++z)e.disableVertexAttribArray(z);var ee=w.getElements(this.elements);ee?e.bindBuffer(sn,ee.buffer.buffer):e.bindBuffer(sn,null)},oe.prototype.refresh=function(){var F=X();F&&(F.bindVertexArrayOES(this.vao),this.bindAttrs(),Z.currentVAO=null,F.bindVertexArrayOES(null))},oe.prototype.destroy=function(){if(this.vao){var F=X();this===Z.currentVAO&&(Z.currentVAO=null,F.bindVertexArrayOES(null)),F.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Y[this.id]&&(delete Y[this.id],L.vaoCount-=1)};function ie(){var F=X();F&&dt(Y).forEach(function(I){I.refresh()})}function ve(F){var I=new oe;L.vaoCount+=1;function he(J){var z;if(Array.isArray(J))z=J,I.elements&&I.ownsElements&&I.elements.destroy(),I.elements=null,I.ownsElements=!1,I.offset=0,I.count=0,I.instances=-1,I.primitive=4;else{if(s(typeof J=="object","invalid arguments for create vao"),s("attributes"in J,"must specify attributes for vao"),J.elements){var ee=J.elements;I.ownsElements?typeof ee=="function"&&ee._reglType==="elements"?(I.elements.destroy(),I.ownsElements=!1):(I.elements(ee),I.ownsElements=!1):w.getElements(J.elements)?(I.elements=J.elements,I.ownsElements=!1):(I.elements=w.create(J.elements),I.ownsElements=!0)}else I.elements=null,I.ownsElements=!1;z=J.attributes,I.offset=0,I.count=-1,I.instances=-1,I.primitive=4,I.elements&&(I.count=I.elements._elements.vertCount,I.primitive=I.elements._elements.primType),"offset"in J&&(I.offset=J.offset|0),"count"in J&&(I.count=J.count|0),"instances"in J&&(I.instances=J.instances|0),"primitive"in J&&(s(J.primitive in Ot,"bad primitive type: "+J.primitive),I.primitive=Ot[J.primitive]),s.optional(()=>{for(var Ve=Object.keys(J),We=0;We<Ve.length;++We)s(Qa.indexOf(Ve[We])>=0,'invalid option for vao: "'+Ve[We]+'" valid options are '+Qa)}),s(Array.isArray(z),"attributes must be an array")}s(z.length<U,"too many attributes"),s(z.length>0,"must specify at least one attribute");var te={},Te=I.attributes;Te.length=z.length;for(var ge=0;ge<z.length;++ge){var ae=z[ge],se=Te[ge]=new ri,be=ae.data||ae;if(Array.isArray(be)||h(be)||_t(be)){var Ae;I.buffers[ge]&&(Ae=I.buffers[ge],h(be)&&Ae._buffer.byteLength>=be.byteLength?Ae.subdata(be):(Ae.destroy(),I.buffers[ge]=null)),I.buffers[ge]||(Ae=I.buffers[ge]=N.create(ae,Ya,!1,!0)),se.buffer=N.getBuffer(Ae),se.size=se.buffer.dimension|0,se.normalized=!1,se.type=se.buffer.dtype,se.offset=0,se.stride=0,se.divisor=0,se.state=1,te[ge]=1}else N.getBuffer(ae)?(se.buffer=N.getBuffer(ae),se.size=se.buffer.dimension|0,se.normalized=!1,se.type=se.buffer.dtype,se.offset=0,se.stride=0,se.divisor=0,se.state=1):N.getBuffer(ae.buffer)?(se.buffer=N.getBuffer(ae.buffer),se.size=(+ae.size||se.buffer.dimension)|0,se.normalized=!!ae.normalized||!1,"type"in ae?(s.parameter(ae.type,Ut,"invalid buffer type"),se.type=Ut[ae.type]):se.type=se.buffer.dtype,se.offset=(ae.offset||0)|0,se.stride=(ae.stride||0)|0,se.divisor=(ae.divisor||0)|0,se.state=1,s(se.size>=1&&se.size<=4,"size must be between 1 and 4"),s(se.offset>=0,"invalid offset"),s(se.stride>=0&&se.stride<=255,"stride must be between 0 and 255"),s(se.divisor>=0,"divisor must be positive"),s(!se.divisor||!!a.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ae?(s(ge>0,"first attribute must not be a constant"),se.x=+ae.x||0,se.y=+ae.y||0,se.z=+ae.z||0,se.w=+ae.w||0,se.state=2):s(!1,"invalid attribute spec for location "+ge)}for(var De=0;De<I.buffers.length;++De)!te[De]&&I.buffers[De]&&(I.buffers[De].destroy(),I.buffers[De]=null);return I.refresh(),he}return he.destroy=function(){for(var J=0;J<I.buffers.length;++J)I.buffers[J]&&I.buffers[J].destroy();I.buffers.length=0,I.ownsElements&&(I.elements.destroy(),I.elements=null,I.ownsElements=!1),I.destroy()},he._vao=I,he._reglType="vao",he(F)}return Z}var Ka=35632,pl=35633,ml=35718,vl=35721;function yl(e,a,m,L){var N={},w={};function O(x,D,$,fe){this.name=x,this.id=D,this.location=$,this.info=fe}function U(x,D){for(var $=0;$<x.length;++$)if(x[$].id===D.id){x[$].location=D.location;return}x.push(D)}function W(x,D,$){var fe=x===Ka?N:w,M=fe[D];if(!M){var oe=a.str(D);M=e.createShader(x),e.shaderSource(M,oe),e.compileShader(M),s.shaderError(e,M,oe,x,$),fe[D]=M}return M}var q={},Q=[],Y=0;function Z(x,D){this.id=Y++,this.fragId=x,this.vertId=D,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,L.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function H(x,D,$){var fe,M,oe=W(Ka,x.fragId),ie=W(pl,x.vertId),ve=x.program=e.createProgram();if(e.attachShader(ve,oe),e.attachShader(ve,ie),$)for(fe=0;fe<$.length;++fe){var F=$[fe];e.bindAttribLocation(ve,F[0],F[1])}e.linkProgram(ve),s.linkError(e,ve,a.str(x.fragId),a.str(x.vertId),D);var I=e.getProgramParameter(ve,ml);L.profile&&(x.stats.uniformsCount=I);var he=x.uniforms;for(fe=0;fe<I;++fe)if(M=e.getActiveUniform(ve,fe),M){if(M.size>1)for(var J=0;J<M.size;++J){var z=M.name.replace("[0]","["+J+"]");U(he,new O(z,a.id(z),e.getUniformLocation(ve,z),M))}var ee=M.name;M.size>1&&(ee=ee.replace("[0]","")),U(he,new O(ee,a.id(ee),e.getUniformLocation(ve,ee),M))}var te=e.getProgramParameter(ve,vl);L.profile&&(x.stats.attributesCount=te);var Te=x.attributes;for(fe=0;fe<te;++fe)M=e.getActiveAttrib(ve,fe),M&&U(Te,new O(M.name,a.id(M.name),e.getAttribLocation(ve,M.name),M))}L.profile&&(m.getMaxUniformsCount=function(){var x=0;return Q.forEach(function(D){D.stats.uniformsCount>x&&(x=D.stats.uniformsCount)}),x},m.getMaxAttributesCount=function(){var x=0;return Q.forEach(function(D){D.stats.attributesCount>x&&(x=D.stats.attributesCount)}),x});function X(){N={},w={};for(var x=0;x<Q.length;++x)H(Q[x],null,Q[x].attributes.map(function(D){return[D.location,D.name]}))}return{clear:function(){var x=e.deleteShader.bind(e);dt(N).forEach(x),N={},dt(w).forEach(x),w={},Q.forEach(function(D){e.deleteProgram(D.program)}),Q.length=0,q={},m.shaderCount=0},program:function(x,D,$,fe){s.command(x>=0,"missing vertex shader",$),s.command(D>=0,"missing fragment shader",$);var M=q[D];M||(M=q[D]={});var oe=M[x];if(oe&&(oe.refCount++,!fe))return oe;var ie=new Z(D,x);return m.shaderCount++,H(ie,$,fe),oe||(M[x]=ie),Q.push(ie),o(ie,{destroy:function(){if(ie.refCount--,ie.refCount<=0){e.deleteProgram(ie.program);var ve=Q.indexOf(ie);Q.splice(ve,1),m.shaderCount--}M[ie.vertId].refCount<=0&&(e.deleteShader(w[ie.vertId]),delete w[ie.vertId],delete q[ie.fragId][ie.vertId]),Object.keys(q[ie.fragId]).length||(e.deleteShader(N[ie.fragId]),delete N[ie.fragId],delete q[ie.fragId])}})},restore:X,shader:W,frag:-1,vert:-1}}var _l=6408,Lr=5121,bl=3333,fn=5126;function El(e,a,m,L,N,w,O){function U(Q){var Y;a.next===null?(s(N.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Y=Lr):(s(a.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Y=a.next.colorAttachments[0].texture._texture.type,s.optional(function(){w.oes_texture_float?(s(Y===Lr||Y===fn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Y===fn&&s(O.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):s(Y===Lr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Z=0,H=0,X=L.framebufferWidth,x=L.framebufferHeight,D=null;h(Q)?D=Q:Q&&(s.type(Q,"object","invalid arguments to regl.read()"),Z=Q.x|0,H=Q.y|0,s(Z>=0&&Z<L.framebufferWidth,"invalid x offset for regl.read"),s(H>=0&&H<L.framebufferHeight,"invalid y offset for regl.read"),X=(Q.width||L.framebufferWidth-Z)|0,x=(Q.height||L.framebufferHeight-H)|0,D=Q.data||null),D&&(Y===Lr?s(D instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Y===fn&&s(D instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),s(X>0&&X+Z<=L.framebufferWidth,"invalid width for read pixels"),s(x>0&&x+H<=L.framebufferHeight,"invalid height for read pixels"),m();var $=X*x*4;return D||(Y===Lr?D=new Uint8Array($):Y===fn&&(D=D||new Float32Array($))),s.isTypedArray(D,"data buffer for regl.read() must be a typedarray"),s(D.byteLength>=$,"data buffer for regl.read() too small"),e.pixelStorei(bl,4),e.readPixels(Z,H,X,x,_l,Y,D),D}function W(Q){var Y;return a.setFBO({framebuffer:Q.framebuffer},function(){Y=U(Q)}),Y}function q(Q){return!Q||!("framebuffer"in Q)?U(Q):W(Q)}return q}function cr(e){return Array.prototype.slice.call(e)}function hr(e){return cr(e).join("")}function xl(){var e=0,a=[],m=[];function L(Y){for(var Z=0;Z<m.length;++Z)if(m[Z]===Y)return a[Z];var H="g"+e++;return a.push(H),m.push(Y),H}function N(){var Y=[];function Z(){Y.push.apply(Y,cr(arguments))}var H=[];function X(){var x="v"+e++;return H.push(x),arguments.length>0&&(Y.push(x,"="),Y.push.apply(Y,cr(arguments)),Y.push(";")),x}return o(Z,{def:X,toString:function(){return hr([H.length>0?"var "+H.join(",")+";":"",hr(Y)])}})}function w(){var Y=N(),Z=N(),H=Y.toString,X=Z.toString;function x(D,$){Z(D,$,"=",Y.def(D,$),";")}return o(function(){Y.apply(Y,cr(arguments))},{def:Y.def,entry:Y,exit:Z,save:x,set:function(D,$,fe){x(D,$),Y(D,$,"=",fe,";")},toString:function(){return H()+X()}})}function O(){var Y=hr(arguments),Z=w(),H=w(),X=Z.toString,x=H.toString;return o(Z,{then:function(){return Z.apply(Z,cr(arguments)),this},else:function(){return H.apply(H,cr(arguments)),this},toString:function(){var D=x();return D&&(D="else{"+D+"}"),hr(["if(",Y,"){",X(),"}",D])}})}var U=N(),W={};function q(Y,Z){var H=[];function X(){var M="a"+H.length;return H.push(M),M}Z=Z||0;for(var x=0;x<Z;++x)X();var D=w(),$=D.toString,fe=W[Y]=o(D,{arg:X,toString:function(){return hr(["function(",H.join(),"){",$(),"}"])}});return fe}function Q(){var Y=['"use strict";',U,"return {"];Object.keys(W).forEach(function(X){Y.push('"',X,'":',W[X].toString(),",")}),Y.push("}");var Z=hr(Y).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),H=Function.apply(null,a.concat(Z));return H.apply(null,m)}return{global:U,link:L,block:N,proc:q,scope:w,cond:O,compile:Q}}var dr="xyzw".split(""),Za=5121,pr=1,ni=2,ii=0,ai=1,oi=2,si=3,un=4,Ja=5,eo=6,to="dither",ro="blend.enable",no="blend.color",fi="blend.equation",ui="blend.func",io="depth.enable",ao="depth.func",oo="depth.range",so="depth.mask",li="colorMask",fo="cull.enable",uo="cull.face",ci="frontFace",hi="lineWidth",lo="polygonOffset.enable",di="polygonOffset.offset",co="sample.alpha",ho="sample.enable",pi="sample.coverage",po="stencil.enable",mo="stencil.mask",mi="stencil.func",vi="stencil.opFront",Rr="stencil.opBack",vo="scissor.enable",ln="scissor.box",wt="viewport",Dr="profile",Xt="framebuffer",Or="vert",Gr="frag",qt="elements",Yt="primitive",Qt="count",cn="offset",hn="instances",Pr="vao",yi="Width",_i="Height",mr=Xt+yi,vr=Xt+_i,gl=wt+yi,Tl=wt+_i,yo="drawingBuffer",_o=yo+yi,bo=yo+_i,Al=[ui,fi,mi,vi,Rr,pi,wt,ln,di],yr=34962,bi=34963,Sl=35632,Cl=35633,Eo=3553,wl=34067,Ll=2884,Rl=3042,Dl=3024,Ol=2960,Gl=2929,Pl=3089,Il=32823,Nl=32926,Fl=32928,Ei=5126,dn=35664,pn=35665,mn=35666,xi=5124,vn=35667,yn=35668,_n=35669,gi=35670,bn=35671,En=35672,xn=35673,Ir=35674,Nr=35675,Fr=35676,Br=35678,kr=35680,Ti=4,Mr=1028,Kt=1029,xo=2304,Ai=2305,Bl=32775,kl=32776,Ml=519,Pt=7680,go=0,To=1,Ao=32774,Vl=513,So=36160,Wl=36064,gt={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Co=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],_r={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},It={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},wo={frag:Sl,vert:Cl},Si={cw:xo,ccw:Ai};function gn(e){return Array.isArray(e)||h(e)||_t(e)}function Lo(e){return e.sort(function(a,m){return a===wt?-1:m===wt?1:a<m?-1:1})}function Qe(e,a,m,L){this.thisDep=e,this.contextDep=a,this.propDep=m,this.append=L}function Nt(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ze(e){return new Qe(!1,!1,!1,e)}function st(e,a){var m=e.type;if(m===ii){var L=e.data.length;return new Qe(!0,L>=1,L>=2,a)}else if(m===un){var N=e.data;return new Qe(N.thisDep,N.contextDep,N.propDep,a)}else{if(m===Ja)return new Qe(!1,!1,!1,a);if(m===eo){for(var w=!1,O=!1,U=!1,W=0;W<e.data.length;++W){var q=e.data[W];if(q.type===ai)U=!0;else if(q.type===oi)O=!0;else if(q.type===si)w=!0;else if(q.type===ii){w=!0;var Q=q.data;Q>=1&&(O=!0),Q>=2&&(U=!0)}else q.type===un&&(w=w||q.data.thisDep,O=O||q.data.contextDep,U=U||q.data.propDep)}return new Qe(w,O,U,a)}else return new Qe(m===si,m===oi,m===ai,a)}}var Ro=new Qe(!1,!1,!1,function(){});function Ul(e,a,m,L,N,w,O,U,W,q,Q,Y,Z,H,X){var x=q.Record,D={add:32774,subtract:32778,"reverse subtract":32779};m.ext_blend_minmax&&(D.min=Bl,D.max=kl);var $=m.angle_instanced_arrays,fe=m.webgl_draw_buffers,M=m.oes_vertex_array_object,oe={dirty:!0,profile:X.profile},ie={},ve=[],F={},I={};function he(u){return u.replace(".","_")}function J(u,i,v){var E=he(u);ve.push(u),ie[E]=oe[E]=!!v,F[E]=i}function z(u,i,v){var E=he(u);ve.push(u),Array.isArray(v)?(oe[E]=v.slice(),ie[E]=v.slice()):oe[E]=ie[E]=v,I[E]=i}J(to,Dl),J(ro,Rl),z(no,"blendColor",[0,0,0,0]),z(fi,"blendEquationSeparate",[Ao,Ao]),z(ui,"blendFuncSeparate",[To,go,To,go]),J(io,Gl,!0),z(ao,"depthFunc",Vl),z(oo,"depthRange",[0,1]),z(so,"depthMask",!0),z(li,li,[!0,!0,!0,!0]),J(fo,Ll),z(uo,"cullFace",Kt),z(ci,ci,Ai),z(hi,hi,1),J(lo,Il),z(di,"polygonOffset",[0,0]),J(co,Nl),J(ho,Fl),z(pi,"sampleCoverage",[1,!1]),J(po,Ol),z(mo,"stencilMask",-1),z(mi,"stencilFunc",[Ml,0,-1]),z(vi,"stencilOpSeparate",[Mr,Pt,Pt,Pt]),z(Rr,"stencilOpSeparate",[Kt,Pt,Pt,Pt]),J(vo,Pl),z(ln,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),z(wt,wt,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var ee={gl:e,context:Z,strings:a,next:ie,current:oe,draw:Y,elements:w,buffer:N,shader:Q,attributes:q.state,vao:q,uniforms:W,framebuffer:U,extensions:m,timer:H,isBufferArgs:gn},te={primTypes:Ot,compareFuncs:_r,blendFuncs:gt,blendEquations:D,stencilOps:It,glTypes:Ut,orientationType:Si};s.optional(function(){ee.isArrayLike=Me}),fe&&(te.backBuffer=[Kt],te.drawBuffer=ht(L.maxDrawbuffers,function(u){return u===0?[0]:ht(u,function(i){return Wl+i})}));var Te=0;function ge(){var u=xl(),i=u.link,v=u.global;u.id=Te++,u.batchId="0";var E=i(ee),g=u.shared={props:"a0"};Object.keys(ee).forEach(function(p){g[p]=v.def(E,".",p)}),s.optional(function(){u.CHECK=i(s),u.commandStr=s.guessCommand(),u.command=i(u.commandStr),u.assert=function(p,c,A){p("if(!(",c,"))",this.CHECK,".commandRaise(",i(A),",",this.command,");")},te.invalidBlendCombinations=Co});var _=u.next={},y=u.current={};Object.keys(I).forEach(function(p){Array.isArray(oe[p])&&(_[p]=v.def(g.next,".",p),y[p]=v.def(g.current,".",p))});var b=u.constants={};Object.keys(te).forEach(function(p){b[p]=v.def(JSON.stringify(te[p]))}),u.invoke=function(p,c){switch(c.type){case ii:var A=["this",g.context,g.props,u.batchId];return p.def(i(c.data),".call(",A.slice(0,Math.max(c.data.length+1,4)),")");case ai:return p.def(g.props,c.data);case oi:return p.def(g.context,c.data);case si:return p.def("this",c.data);case un:return c.data.append(u,p),c.data.ref;case Ja:return c.data.toString();case eo:return c.data.map(function(T){return u.invoke(p,T)})}},u.attribCache={};var l={};return u.scopeAttrib=function(p){var c=a.id(p);if(c in l)return l[c];var A=q.scope[c];A||(A=q.scope[c]=new x);var T=l[c]=i(A);return T},u}function ae(u){var i=u.static,v=u.dynamic,E;if(Dr in i){var g=!!i[Dr];E=ze(function(y,b){return g}),E.enable=g}else if(Dr in v){var _=v[Dr];E=st(_,function(y,b){return y.invoke(b,_)})}return E}function se(u,i){var v=u.static,E=u.dynamic;if(Xt in v){var g=v[Xt];return g?(g=U.getFramebuffer(g),s.command(g,"invalid framebuffer object"),ze(function(y,b){var l=y.link(g),p=y.shared;b.set(p.framebuffer,".next",l);var c=p.context;return b.set(c,"."+mr,l+".width"),b.set(c,"."+vr,l+".height"),l})):ze(function(y,b){var l=y.shared;b.set(l.framebuffer,".next","null");var p=l.context;return b.set(p,"."+mr,p+"."+_o),b.set(p,"."+vr,p+"."+bo),"null"})}else if(Xt in E){var _=E[Xt];return st(_,function(y,b){var l=y.invoke(b,_),p=y.shared,c=p.framebuffer,A=b.def(c,".getFramebuffer(",l,")");s.optional(function(){y.assert(b,"!"+l+"||"+A,"invalid framebuffer object")}),b.set(c,".next",A);var T=p.context;return b.set(T,"."+mr,A+"?"+A+".width:"+T+"."+_o),b.set(T,"."+vr,A+"?"+A+".height:"+T+"."+bo),A})}else return null}function be(u,i,v){var E=u.static,g=u.dynamic;function _(l){if(l in E){var p=E[l];s.commandType(p,"object","invalid "+l,v.commandStr);var c=!0,A=p.x|0,T=p.y|0,P,B;return"width"in p?(P=p.width|0,s.command(P>=0,"invalid "+l,v.commandStr)):c=!1,"height"in p?(B=p.height|0,s.command(B>=0,"invalid "+l,v.commandStr)):c=!1,new Qe(!c&&i&&i.thisDep,!c&&i&&i.contextDep,!c&&i&&i.propDep,function(me,ue){var k=me.shared.context,G=P;"width"in p||(G=ue.def(k,".",mr,"-",A));var pe=B;return"height"in p||(pe=ue.def(k,".",vr,"-",T)),[A,T,G,pe]})}else if(l in g){var K=g[l],xe=st(K,function(me,ue){var k=me.invoke(ue,K);s.optional(function(){me.assert(ue,k+"&&typeof "+k+'==="object"',"invalid "+l)});var G=me.shared.context,pe=ue.def(k,".x|0"),de=ue.def(k,".y|0"),Ee=ue.def('"width" in ',k,"?",k,".width|0:","(",G,".",mr,"-",pe,")"),Ne=ue.def('"height" in ',k,"?",k,".height|0:","(",G,".",vr,"-",de,")");return s.optional(function(){me.assert(ue,Ee+">=0&&"+Ne+">=0","invalid "+l)}),[pe,de,Ee,Ne]});return i&&(xe.thisDep=xe.thisDep||i.thisDep,xe.contextDep=xe.contextDep||i.contextDep,xe.propDep=xe.propDep||i.propDep),xe}else return i?new Qe(i.thisDep,i.contextDep,i.propDep,function(me,ue){var k=me.shared.context;return[0,0,ue.def(k,".",mr),ue.def(k,".",vr)]}):null}var y=_(wt);if(y){var b=y;y=new Qe(y.thisDep,y.contextDep,y.propDep,function(l,p){var c=b.append(l,p),A=l.shared.context;return p.set(A,"."+gl,c[2]),p.set(A,"."+Tl,c[3]),c})}return{viewport:y,scissor_box:_(ln)}}function Ae(u,i){var v=u.static,E=typeof v[Gr]=="string"&&typeof v[Or]=="string";if(E){if(Object.keys(i.dynamic).length>0)return null;var g=i.static,_=Object.keys(g);if(_.length>0&&typeof g[_[0]]=="number"){for(var y=[],b=0;b<_.length;++b)s(typeof g[_[b]]=="number","must specify all vertex attribute locations when using vaos"),y.push([g[_[b]]|0,_[b]]);return y}}return null}function De(u,i,v){var E=u.static,g=u.dynamic;function _(c){if(c in E){var A=a.id(E[c]);s.optional(function(){Q.shader(wo[c],A,s.guessCommand())});var T=ze(function(){return A});return T.id=A,T}else if(c in g){var P=g[c];return st(P,function(B,K){var xe=B.invoke(K,P),me=K.def(B.shared.strings,".id(",xe,")");return s.optional(function(){K(B.shared.shader,".shader(",wo[c],",",me,",",B.command,");")}),me})}return null}var y=_(Gr),b=_(Or),l=null,p;return Nt(y)&&Nt(b)?(l=Q.program(b.id,y.id,null,v),p=ze(function(c,A){return c.link(l)})):p=new Qe(y&&y.thisDep||b&&b.thisDep,y&&y.contextDep||b&&b.contextDep,y&&y.propDep||b&&b.propDep,function(c,A){var T=c.shared.shader,P;y?P=y.append(c,A):P=A.def(T,".",Gr);var B;b?B=b.append(c,A):B=A.def(T,".",Or);var K=T+".program("+B+","+P;return s.optional(function(){K+=","+c.command}),A.def(K+")")}),{frag:y,vert:b,progVar:p,program:l}}function Ve(u,i){var v=u.static,E=u.dynamic,g={},_=!1;function y(){if(Pr in v){var ue=v[Pr];return ue!==null&&q.getVAO(ue)===null&&(ue=q.createVAO(ue)),_=!0,g.vao=ue,ze(function(G){var pe=q.getVAO(ue);return pe?G.link(pe):"null"})}else if(Pr in E){_=!0;var k=E[Pr];return st(k,function(G,pe){var de=G.invoke(pe,k);return pe.def(G.shared.vao+".getVAO("+de+")")})}return null}var b=y(),l=!1;function p(){if(qt in v){var ue=v[qt];if(g.elements=ue,gn(ue)){var k=g.elements=w.create(ue,!0);ue=w.getElements(k),l=!0}else ue&&(ue=w.getElements(ue),l=!0,s.command(ue,"invalid elements",i.commandStr));var G=ze(function(de,Ee){if(ue){var Ne=de.link(ue);return de.ELEMENTS=Ne,Ne}return de.ELEMENTS=null,null});return G.value=ue,G}else if(qt in E){l=!0;var pe=E[qt];return st(pe,function(de,Ee){var Ne=de.shared,at=Ne.isBufferArgs,Jt=Ne.elements,Lt=de.invoke(Ee,pe),At=Ee.def("null"),Ft=Ee.def(at,"(",Lt,")"),er=de.cond(Ft).then(At,"=",Jt,".createStream(",Lt,");").else(At,"=",Jt,".getElements(",Lt,");");return s.optional(function(){de.assert(er.else,"!"+Lt+"||"+At,"invalid elements")}),Ee.entry(er),Ee.exit(de.cond(Ft).then(Jt,".destroyStream(",At,");")),de.ELEMENTS=At,At})}else if(_)return new Qe(b.thisDep,b.contextDep,b.propDep,function(de,Ee){return Ee.def(de.shared.vao+".currentVAO?"+de.shared.elements+".getElements("+de.shared.vao+".currentVAO.elements):null")});return null}var c=p();function A(){if(Yt in v){var ue=v[Yt];return g.primitive=ue,s.commandParameter(ue,Ot,"invalid primitve",i.commandStr),ze(function(G,pe){return Ot[ue]})}else if(Yt in E){var k=E[Yt];return st(k,function(G,pe){var de=G.constants.primTypes,Ee=G.invoke(pe,k);return s.optional(function(){G.assert(pe,Ee+" in "+de,"invalid primitive, must be one of "+Object.keys(Ot))}),pe.def(de,"[",Ee,"]")})}else{if(l)return Nt(c)?c.value?ze(function(G,pe){return pe.def(G.ELEMENTS,".primType")}):ze(function(){return Ti}):new Qe(c.thisDep,c.contextDep,c.propDep,function(G,pe){var de=G.ELEMENTS;return pe.def(de,"?",de,".primType:",Ti)});if(_)return new Qe(b.thisDep,b.contextDep,b.propDep,function(G,pe){return pe.def(G.shared.vao+".currentVAO?"+G.shared.vao+".currentVAO.primitive:"+Ti)})}return null}function T(ue,k){if(ue in v){var G=v[ue]|0;return k?g.offset=G:g.instances=G,s.command(!k||G>=0,"invalid "+ue,i.commandStr),ze(function(de,Ee){return k&&(de.OFFSET=G),G})}else if(ue in E){var pe=E[ue];return st(pe,function(de,Ee){var Ne=de.invoke(Ee,pe);return k&&(de.OFFSET=Ne,s.optional(function(){de.assert(Ee,Ne+">=0","invalid "+ue)})),Ne})}else if(k){if(l)return ze(function(de,Ee){return de.OFFSET=0,0});if(_)return new Qe(b.thisDep,b.contextDep,b.propDep,function(de,Ee){return Ee.def(de.shared.vao+".currentVAO?"+de.shared.vao+".currentVAO.offset:0")})}else if(_)return new Qe(b.thisDep,b.contextDep,b.propDep,function(de,Ee){return Ee.def(de.shared.vao+".currentVAO?"+de.shared.vao+".currentVAO.instances:-1")});return null}var P=T(cn,!0);function B(){if(Qt in v){var ue=v[Qt]|0;return g.count=ue,s.command(typeof ue=="number"&&ue>=0,"invalid vertex count",i.commandStr),ze(function(){return ue})}else if(Qt in E){var k=E[Qt];return st(k,function(Ee,Ne){var at=Ee.invoke(Ne,k);return s.optional(function(){Ee.assert(Ne,"typeof "+at+'==="number"&&'+at+">=0&&"+at+"===("+at+"|0)","invalid vertex count")}),at})}else if(l)if(Nt(c)){if(c)return P?new Qe(P.thisDep,P.contextDep,P.propDep,function(Ee,Ne){var at=Ne.def(Ee.ELEMENTS,".vertCount-",Ee.OFFSET);return s.optional(function(){Ee.assert(Ne,at+">=0","invalid vertex offset/element buffer too small")}),at}):ze(function(Ee,Ne){return Ne.def(Ee.ELEMENTS,".vertCount")});var G=ze(function(){return-1});return s.optional(function(){G.MISSING=!0}),G}else{var pe=new Qe(c.thisDep||P.thisDep,c.contextDep||P.contextDep,c.propDep||P.propDep,function(Ee,Ne){var at=Ee.ELEMENTS;return Ee.OFFSET?Ne.def(at,"?",at,".vertCount-",Ee.OFFSET,":-1"):Ne.def(at,"?",at,".vertCount:-1")});return s.optional(function(){pe.DYNAMIC=!0}),pe}else if(_){var de=new Qe(b.thisDep,b.contextDep,b.propDep,function(Ee,Ne){return Ne.def(Ee.shared.vao,".currentVAO?",Ee.shared.vao,".currentVAO.count:-1")});return de}return null}var K=A(),xe=B(),me=T(hn,!1);return{elements:c,primitive:K,count:xe,instances:me,offset:P,vao:b,vaoActive:_,elementsActive:l,static:g}}function We(u,i){var v=u.static,E=u.dynamic,g={};return ve.forEach(function(_){var y=he(_);function b(l,p){if(_ in v){var c=l(v[_]);g[y]=ze(function(){return c})}else if(_ in E){var A=E[_];g[y]=st(A,function(T,P){return p(T,P,T.invoke(P,A))})}}switch(_){case fo:case ro:case to:case po:case io:case vo:case lo:case co:case ho:case so:return b(function(l){return s.commandType(l,"boolean",_,i.commandStr),l},function(l,p,c){return s.optional(function(){l.assert(p,"typeof "+c+'==="boolean"',"invalid flag "+_,l.commandStr)}),c});case ao:return b(function(l){return s.commandParameter(l,_r,"invalid "+_,i.commandStr),_r[l]},function(l,p,c){var A=l.constants.compareFuncs;return s.optional(function(){l.assert(p,c+" in "+A,"invalid "+_+", must be one of "+Object.keys(_r))}),p.def(A,"[",c,"]")});case oo:return b(function(l){return s.command(Me(l)&&l.length===2&&typeof l[0]=="number"&&typeof l[1]=="number"&&l[0]<=l[1],"depth range is 2d array",i.commandStr),l},function(l,p,c){s.optional(function(){l.assert(p,l.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var A=p.def("+",c,"[0]"),T=p.def("+",c,"[1]");return[A,T]});case ui:return b(function(l){s.commandType(l,"object","blend.func",i.commandStr);var p="srcRGB"in l?l.srcRGB:l.src,c="srcAlpha"in l?l.srcAlpha:l.src,A="dstRGB"in l?l.dstRGB:l.dst,T="dstAlpha"in l?l.dstAlpha:l.dst;return s.commandParameter(p,gt,y+".srcRGB",i.commandStr),s.commandParameter(c,gt,y+".srcAlpha",i.commandStr),s.commandParameter(A,gt,y+".dstRGB",i.commandStr),s.commandParameter(T,gt,y+".dstAlpha",i.commandStr),s.command(Co.indexOf(p+", "+A)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+p+", "+A+")",i.commandStr),[gt[p],gt[A],gt[c],gt[T]]},function(l,p,c){var A=l.constants.blendFuncs;s.optional(function(){l.assert(p,c+"&&typeof "+c+'==="object"',"invalid blend func, must be an object")});function T(k,G){var pe=p.def('"',k,G,'" in ',c,"?",c,".",k,G,":",c,".",k);return s.optional(function(){l.assert(p,pe+" in "+A,"invalid "+_+"."+k+G+", must be one of "+Object.keys(gt))}),pe}var P=T("src","RGB"),B=T("dst","RGB");s.optional(function(){var k=l.constants.invalidBlendCombinations;l.assert(p,k+".indexOf("+P+'+", "+'+B+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var K=p.def(A,"[",P,"]"),xe=p.def(A,"[",T("src","Alpha"),"]"),me=p.def(A,"[",B,"]"),ue=p.def(A,"[",T("dst","Alpha"),"]");return[K,me,xe,ue]});case fi:return b(function(l){if(typeof l=="string")return s.commandParameter(l,D,"invalid "+_,i.commandStr),[D[l],D[l]];if(typeof l=="object")return s.commandParameter(l.rgb,D,_+".rgb",i.commandStr),s.commandParameter(l.alpha,D,_+".alpha",i.commandStr),[D[l.rgb],D[l.alpha]];s.commandRaise("invalid blend.equation",i.commandStr)},function(l,p,c){var A=l.constants.blendEquations,T=p.def(),P=p.def(),B=l.cond("typeof ",c,'==="string"');return s.optional(function(){function K(xe,me,ue){l.assert(xe,ue+" in "+A,"invalid "+me+", must be one of "+Object.keys(D))}K(B.then,_,c),l.assert(B.else,c+"&&typeof "+c+'==="object"',"invalid "+_),K(B.else,_+".rgb",c+".rgb"),K(B.else,_+".alpha",c+".alpha")}),B.then(T,"=",P,"=",A,"[",c,"];"),B.else(T,"=",A,"[",c,".rgb];",P,"=",A,"[",c,".alpha];"),p(B),[T,P]});case no:return b(function(l){return s.command(Me(l)&&l.length===4,"blend.color must be a 4d array",i.commandStr),ht(4,function(p){return+l[p]})},function(l,p,c){return s.optional(function(){l.assert(p,l.shared.isArrayLike+"("+c+")&&"+c+".length===4","blend.color must be a 4d array")}),ht(4,function(A){return p.def("+",c,"[",A,"]")})});case mo:return b(function(l){return s.commandType(l,"number",y,i.commandStr),l|0},function(l,p,c){return s.optional(function(){l.assert(p,"typeof "+c+'==="number"',"invalid stencil.mask")}),p.def(c,"|0")});case mi:return b(function(l){s.commandType(l,"object",y,i.commandStr);var p=l.cmp||"keep",c=l.ref||0,A="mask"in l?l.mask:-1;return s.commandParameter(p,_r,_+".cmp",i.commandStr),s.commandType(c,"number",_+".ref",i.commandStr),s.commandType(A,"number",_+".mask",i.commandStr),[_r[p],c,A]},function(l,p,c){var A=l.constants.compareFuncs;s.optional(function(){function K(){l.assert(p,Array.prototype.join.call(arguments,""),"invalid stencil.func")}K(c+"&&typeof ",c,'==="object"'),K('!("cmp" in ',c,")||(",c,".cmp in ",A,")")});var T=p.def('"cmp" in ',c,"?",A,"[",c,".cmp]",":",Pt),P=p.def(c,".ref|0"),B=p.def('"mask" in ',c,"?",c,".mask|0:-1");return[T,P,B]});case vi:case Rr:return b(function(l){s.commandType(l,"object",y,i.commandStr);var p=l.fail||"keep",c=l.zfail||"keep",A=l.zpass||"keep";return s.commandParameter(p,It,_+".fail",i.commandStr),s.commandParameter(c,It,_+".zfail",i.commandStr),s.commandParameter(A,It,_+".zpass",i.commandStr),[_===Rr?Kt:Mr,It[p],It[c],It[A]]},function(l,p,c){var A=l.constants.stencilOps;s.optional(function(){l.assert(p,c+"&&typeof "+c+'==="object"',"invalid "+_)});function T(P){return s.optional(function(){l.assert(p,'!("'+P+'" in '+c+")||("+c+"."+P+" in "+A+")","invalid "+_+"."+P+", must be one of "+Object.keys(It))}),p.def('"',P,'" in ',c,"?",A,"[",c,".",P,"]:",Pt)}return[_===Rr?Kt:Mr,T("fail"),T("zfail"),T("zpass")]});case di:return b(function(l){s.commandType(l,"object",y,i.commandStr);var p=l.factor|0,c=l.units|0;return s.commandType(p,"number",y+".factor",i.commandStr),s.commandType(c,"number",y+".units",i.commandStr),[p,c]},function(l,p,c){s.optional(function(){l.assert(p,c+"&&typeof "+c+'==="object"',"invalid "+_)});var A=p.def(c,".factor|0"),T=p.def(c,".units|0");return[A,T]});case uo:return b(function(l){var p=0;return l==="front"?p=Mr:l==="back"&&(p=Kt),s.command(!!p,y,i.commandStr),p},function(l,p,c){return s.optional(function(){l.assert(p,c+'==="front"||'+c+'==="back"',"invalid cull.face")}),p.def(c,'==="front"?',Mr,":",Kt)});case hi:return b(function(l){return s.command(typeof l=="number"&&l>=L.lineWidthDims[0]&&l<=L.lineWidthDims[1],"invalid line width, must be a positive number between "+L.lineWidthDims[0]+" and "+L.lineWidthDims[1],i.commandStr),l},function(l,p,c){return s.optional(function(){l.assert(p,"typeof "+c+'==="number"&&'+c+">="+L.lineWidthDims[0]+"&&"+c+"<="+L.lineWidthDims[1],"invalid line width")}),c});case ci:return b(function(l){return s.commandParameter(l,Si,y,i.commandStr),Si[l]},function(l,p,c){return s.optional(function(){l.assert(p,c+'==="cw"||'+c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),p.def(c+'==="cw"?'+xo+":"+Ai)});case li:return b(function(l){return s.command(Me(l)&&l.length===4,"color.mask must be length 4 array",i.commandStr),l.map(function(p){return!!p})},function(l,p,c){return s.optional(function(){l.assert(p,l.shared.isArrayLike+"("+c+")&&"+c+".length===4","invalid color.mask")}),ht(4,function(A){return"!!"+c+"["+A+"]"})});case pi:return b(function(l){s.command(typeof l=="object"&&l,y,i.commandStr);var p="value"in l?l.value:1,c=!!l.invert;return s.command(typeof p=="number"&&p>=0&&p<=1,"sample.coverage.value must be a number between 0 and 1",i.commandStr),[p,c]},function(l,p,c){s.optional(function(){l.assert(p,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var A=p.def('"value" in ',c,"?+",c,".value:1"),T=p.def("!!",c,".invert");return[A,T]})}}),g}function Ge(u,i){var v=u.static,E=u.dynamic,g={};return Object.keys(v).forEach(function(_){var y=v[_],b;if(typeof y=="number"||typeof y=="boolean")b=ze(function(){return y});else if(typeof y=="function"){var l=y._reglType;l==="texture2d"||l==="textureCube"?b=ze(function(p){return p.link(y)}):l==="framebuffer"||l==="framebufferCube"?(s.command(y.color.length>0,'missing color attachment for framebuffer sent to uniform "'+_+'"',i.commandStr),b=ze(function(p){return p.link(y.color[0])})):s.commandRaise('invalid data for uniform "'+_+'"',i.commandStr)}else Me(y)?b=ze(function(p){var c=p.global.def("[",ht(y.length,function(A){return s.command(typeof y[A]=="number"||typeof y[A]=="boolean","invalid uniform "+_,p.commandStr),y[A]}),"]");return c}):s.commandRaise('invalid or missing data for uniform "'+_+'"',i.commandStr);b.value=y,g[_]=b}),Object.keys(E).forEach(function(_){var y=E[_];g[_]=st(y,function(b,l){return b.invoke(l,y)})}),g}function Xe(u,i){var v=u.static,E=u.dynamic,g={};return Object.keys(v).forEach(function(_){var y=v[_],b=a.id(_),l=new x;if(gn(y))l.state=pr,l.buffer=N.getBuffer(N.create(y,yr,!1,!0)),l.type=0;else{var p=N.getBuffer(y);if(p)l.state=pr,l.buffer=p,l.type=0;else if(s.command(typeof y=="object"&&y,"invalid data for attribute "+_,i.commandStr),"constant"in y){var c=y.constant;l.buffer="null",l.state=ni,typeof c=="number"?l.x=c:(s.command(Me(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+_,i.commandStr),dr.forEach(function(me,ue){ue<c.length&&(l[me]=c[ue])}))}else{gn(y.buffer)?p=N.getBuffer(N.create(y.buffer,yr,!1,!0)):p=N.getBuffer(y.buffer),s.command(!!p,'missing buffer for attribute "'+_+'"',i.commandStr);var A=y.offset|0;s.command(A>=0,'invalid offset for attribute "'+_+'"',i.commandStr);var T=y.stride|0;s.command(T>=0&&T<256,'invalid stride for attribute "'+_+'", must be integer betweeen [0, 255]',i.commandStr);var P=y.size|0;s.command(!("size"in y)||P>0&&P<=4,'invalid size for attribute "'+_+'", must be 1,2,3,4',i.commandStr);var B=!!y.normalized,K=0;"type"in y&&(s.commandParameter(y.type,Ut,"invalid type for attribute "+_,i.commandStr),K=Ut[y.type]);var xe=y.divisor|0;s.optional(function(){"divisor"in y&&(s.command(xe===0||$,'cannot specify divisor for attribute "'+_+'", instancing not supported',i.commandStr),s.command(xe>=0,'invalid divisor for attribute "'+_+'"',i.commandStr));var me=i.commandStr,ue=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(y).forEach(function(k){s.command(ue.indexOf(k)>=0,'unknown parameter "'+k+'" for attribute pointer "'+_+'" (valid parameters are '+ue+")",me)})}),l.buffer=p,l.state=pr,l.size=P,l.normalized=B,l.type=K||p.dtype,l.offset=A,l.stride=T,l.divisor=xe}}g[_]=ze(function(me,ue){var k=me.attribCache;if(b in k)return k[b];var G={isStream:!1};return Object.keys(l).forEach(function(pe){G[pe]=l[pe]}),l.buffer&&(G.buffer=me.link(l.buffer),G.type=G.type||G.buffer+".dtype"),k[b]=G,G})}),Object.keys(E).forEach(function(_){var y=E[_];function b(l,p){var c=l.invoke(p,y),A=l.shared,T=l.constants,P=A.isBufferArgs,B=A.buffer;s.optional(function(){l.assert(p,c+"&&(typeof "+c+'==="object"||typeof '+c+'==="function")&&('+P+"("+c+")||"+B+".getBuffer("+c+")||"+B+".getBuffer("+c+".buffer)||"+P+"("+c+'.buffer)||("constant" in '+c+"&&(typeof "+c+'.constant==="number"||'+A.isArrayLike+"("+c+".constant))))",'invalid dynamic attribute "'+_+'"')});var K={isStream:p.def(!1)},xe=new x;xe.state=pr,Object.keys(xe).forEach(function(G){K[G]=p.def(""+xe[G])});var me=K.buffer,ue=K.type;p("if(",P,"(",c,")){",K.isStream,"=true;",me,"=",B,".createStream(",yr,",",c,");",ue,"=",me,".dtype;","}else{",me,"=",B,".getBuffer(",c,");","if(",me,"){",ue,"=",me,".dtype;",'}else if("constant" in ',c,"){",K.state,"=",ni,";","if(typeof "+c+'.constant === "number"){',K[dr[0]],"=",c,".constant;",dr.slice(1).map(function(G){return K[G]}).join("="),"=0;","}else{",dr.map(function(G,pe){return K[G]+"="+c+".constant.length>"+pe+"?"+c+".constant["+pe+"]:0;"}).join(""),"}}else{","if(",P,"(",c,".buffer)){",me,"=",B,".createStream(",yr,",",c,".buffer);","}else{",me,"=",B,".getBuffer(",c,".buffer);","}",ue,'="type" in ',c,"?",T.glTypes,"[",c,".type]:",me,".dtype;",K.normalized,"=!!",c,".normalized;");function k(G){p(K[G],"=",c,".",G,"|0;")}return k("size"),k("offset"),k("stride"),k("divisor"),p("}}"),p.exit("if(",K.isStream,"){",B,".destroyStream(",me,");","}"),K}g[_]=st(y,b)}),g}function ke(u){var i=u.static,v=u.dynamic,E={};return Object.keys(i).forEach(function(g){var _=i[g];E[g]=ze(function(y,b){return typeof _=="number"||typeof _=="boolean"?""+_:y.link(_)})}),Object.keys(v).forEach(function(g){var _=v[g];E[g]=st(_,function(y,b){return y.invoke(b,_)})}),E}function $e(u,i,v,E,g){var _=u.static,y=u.dynamic;s.optional(function(){var k=[Xt,Or,Gr,qt,Yt,cn,Qt,hn,Dr,Pr].concat(ve);function G(pe){Object.keys(pe).forEach(function(de){s.command(k.indexOf(de)>=0,'unknown parameter "'+de+'"',g.commandStr)})}G(_),G(y)});var b=Ae(u,i),l=se(u),p=be(u,l,g),c=Ve(u,g),A=We(u,g),T=De(u,g,b);function P(k){var G=p[k];G&&(A[k]=G)}P(wt),P(he(ln));var B=Object.keys(A).length>0,K={framebuffer:l,draw:c,shader:T,state:A,dirty:B,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(K.profile=ae(u),K.uniforms=Ge(v,g),K.drawVAO=K.scopeVAO=c.vao,!K.drawVAO&&T.program&&!b&&m.angle_instanced_arrays&&c.static.elements){var xe=!0,me=T.program.attributes.map(function(k){var G=i.static[k];return xe=xe&&!!G,G});if(xe&&me.length>0){var ue=q.getVAO(q.createVAO({attributes:me,elements:c.static.elements}));K.drawVAO=new Qe(null,null,null,function(k,G){return k.link(ue)}),K.useVAO=!0}}return b?K.useVAO=!0:K.attributes=Xe(i,g),K.context=ke(E),K}function qe(u,i,v){var E=u.shared,g=E.context,_=u.scope();Object.keys(v).forEach(function(y){i.save(g,"."+y);var b=v[y],l=b.append(u,i);Array.isArray(l)?_(g,".",y,"=[",l.join(),"];"):_(g,".",y,"=",l,";")}),i(_)}function Ye(u,i,v,E){var g=u.shared,_=g.gl,y=g.framebuffer,b;fe&&(b=i.def(g.extensions,".webgl_draw_buffers"));var l=u.constants,p=l.drawBuffer,c=l.backBuffer,A;v?A=v.append(u,i):A=i.def(y,".next"),E||i("if(",A,"!==",y,".cur){"),i("if(",A,"){",_,".bindFramebuffer(",So,",",A,".framebuffer);"),fe&&i(b,".drawBuffersWEBGL(",p,"[",A,".colorAttachments.length]);"),i("}else{",_,".bindFramebuffer(",So,",null);"),fe&&i(b,".drawBuffersWEBGL(",c,");"),i("}",y,".cur=",A,";"),E||i("}")}function et(u,i,v){var E=u.shared,g=E.gl,_=u.current,y=u.next,b=E.current,l=E.next,p=u.cond(b,".dirty");ve.forEach(function(c){var A=he(c);if(!(A in v.state)){var T,P;if(A in y){T=y[A],P=_[A];var B=ht(oe[A].length,function(xe){return p.def(T,"[",xe,"]")});p(u.cond(B.map(function(xe,me){return xe+"!=="+P+"["+me+"]"}).join("||")).then(g,".",I[A],"(",B,");",B.map(function(xe,me){return P+"["+me+"]="+xe}).join(";"),";"))}else{T=p.def(l,".",A);var K=u.cond(T,"!==",b,".",A);p(K),A in F?K(u.cond(T).then(g,".enable(",F[A],");").else(g,".disable(",F[A],");"),b,".",A,"=",T,";"):K(g,".",I[A],"(",T,");",b,".",A,"=",T,";")}}}),Object.keys(v.state).length===0&&p(b,".dirty=false;"),i(p)}function nt(u,i,v,E){var g=u.shared,_=u.current,y=g.current,b=g.gl;Lo(Object.keys(v)).forEach(function(l){var p=v[l];if(!(E&&!E(p))){var c=p.append(u,i);if(F[l]){var A=F[l];Nt(p)?c?i(b,".enable(",A,");"):i(b,".disable(",A,");"):i(u.cond(c).then(b,".enable(",A,");").else(b,".disable(",A,");")),i(y,".",l,"=",c,";")}else if(Me(c)){var T=_[l];i(b,".",I[l],"(",c,");",c.map(function(P,B){return T+"["+B+"]="+P}).join(";"),";")}else i(b,".",I[l],"(",c,");",y,".",l,"=",c,";")}})}function Ue(u,i){$&&(u.instancing=i.def(u.shared.extensions,".angle_instanced_arrays"))}function Se(u,i,v,E,g){var _=u.shared,y=u.stats,b=_.current,l=_.timer,p=v.profile;function c(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var A,T;function P(k){A=i.def(),k(A,"=",c(),";"),typeof g=="string"?k(y,".count+=",g,";"):k(y,".count++;"),H&&(E?(T=i.def(),k(T,"=",l,".getNumPendingQueries();")):k(l,".beginQuery(",y,");"))}function B(k){k(y,".cpuTime+=",c(),"-",A,";"),H&&(E?k(l,".pushScopeStats(",T,",",l,".getNumPendingQueries(),",y,");"):k(l,".endQuery();"))}function K(k){var G=i.def(b,".profile");i(b,".profile=",k,";"),i.exit(b,".profile=",G,";")}var xe;if(p){if(Nt(p)){p.enable?(P(i),B(i.exit),K("true")):K("false");return}xe=p.append(u,i),K(xe)}else xe=i.def(b,".profile");var me=u.block();P(me),i("if(",xe,"){",me,"}");var ue=u.block();B(ue),i.exit("if(",xe,"){",ue,"}")}function it(u,i,v,E,g){var _=u.shared;function y(l){switch(l){case dn:case vn:case bn:return 2;case pn:case yn:case En:return 3;case mn:case _n:case xn:return 4;default:return 1}}function b(l,p,c){var A=_.gl,T=i.def(l,".location"),P=i.def(_.attributes,"[",T,"]"),B=c.state,K=c.buffer,xe=[c.x,c.y,c.z,c.w],me=["buffer","normalized","offset","stride"];function ue(){i("if(!",P,".buffer){",A,".enableVertexAttribArray(",T,");}");var G=c.type,pe;if(c.size?pe=i.def(c.size,"||",p):pe=p,i("if(",P,".type!==",G,"||",P,".size!==",pe,"||",me.map(function(Ee){return P+"."+Ee+"!=="+c[Ee]}).join("||"),"){",A,".bindBuffer(",yr,",",K,".buffer);",A,".vertexAttribPointer(",[T,pe,G,c.normalized,c.stride,c.offset],");",P,".type=",G,";",P,".size=",pe,";",me.map(function(Ee){return P+"."+Ee+"="+c[Ee]+";"}).join(""),"}"),$){var de=c.divisor;i("if(",P,".divisor!==",de,"){",u.instancing,".vertexAttribDivisorANGLE(",[T,de],");",P,".divisor=",de,";}")}}function k(){i("if(",P,".buffer){",A,".disableVertexAttribArray(",T,");",P,".buffer=null;","}if(",dr.map(function(G,pe){return P+"."+G+"!=="+xe[pe]}).join("||"),"){",A,".vertexAttrib4f(",T,",",xe,");",dr.map(function(G,pe){return P+"."+G+"="+xe[pe]+";"}).join(""),"}")}B===pr?ue():B===ni?k():(i("if(",B,"===",pr,"){"),ue(),i("}else{"),k(),i("}"))}E.forEach(function(l){var p=l.name,c=v.attributes[p],A;if(c){if(!g(c))return;A=c.append(u,i)}else{if(!g(Ro))return;var T=u.scopeAttrib(p);s.optional(function(){u.assert(i,T+".state","missing attribute "+p)}),A={},Object.keys(new x).forEach(function(P){A[P]=i.def(T,".",P)})}b(u.link(l),y(l.info.type),A)})}function Ie(u,i,v,E,g,_){for(var y=u.shared,b=y.gl,l={},p,c=0;c<E.length;++c){var A=E[c],T=A.name,P=A.info.type,B=A.info.size,K=v.uniforms[T];if(B>1){if(!K)continue;var xe=T.replace("[0]","");if(l[xe])continue;l[xe]=1}var me=u.link(A),ue=me+".location",k;if(K){if(!g(K))continue;if(Nt(K)){var G=K.value;if(s.command(G!==null&&typeof G!="undefined",'missing uniform "'+T+'"',u.commandStr),P===Br||P===kr){s.command(typeof G=="function"&&(P===Br&&(G._reglType==="texture2d"||G._reglType==="framebuffer")||P===kr&&(G._reglType==="textureCube"||G._reglType==="framebufferCube")),"invalid texture for uniform "+T,u.commandStr);var pe=u.link(G._texture||G.color[0]._texture);i(b,".uniform1i(",ue,",",pe+".bind());"),i.exit(pe,".unbind();")}else if(P===Ir||P===Nr||P===Fr){s.optional(function(){s.command(Me(G),"invalid matrix for uniform "+T,u.commandStr),s.command(P===Ir&&G.length===4||P===Nr&&G.length===9||P===Fr&&G.length===16,"invalid length for matrix uniform "+T,u.commandStr)});var de=u.global.def("new Float32Array(["+Array.prototype.slice.call(G)+"])"),Ee=2;P===Nr?Ee=3:P===Fr&&(Ee=4),i(b,".uniformMatrix",Ee,"fv(",ue,",false,",de,");")}else{switch(P){case Ei:B===1?s.commandType(G,"number","uniform "+T,u.commandStr):s.command(Me(G)&&G.length===B,"uniform "+T,u.commandStr),p="1f";break;case dn:s.command(Me(G)&&G.length&&G.length%2==0&&G.length<=B*2,"uniform "+T,u.commandStr),p="2f";break;case pn:s.command(Me(G)&&G.length&&G.length%3==0&&G.length<=B*3,"uniform "+T,u.commandStr),p="3f";break;case mn:s.command(Me(G)&&G.length&&G.length%4==0&&G.length<=B*4,"uniform "+T,u.commandStr),p="4f";break;case gi:B===1?s.commandType(G,"boolean","uniform "+T,u.commandStr):s.command(Me(G)&&G.length===B,"uniform "+T,u.commandStr),p="1i";break;case xi:B===1?s.commandType(G,"number","uniform "+T,u.commandStr):s.command(Me(G)&&G.length===B,"uniform "+T,u.commandStr),p="1i";break;case bn:s.command(Me(G)&&G.length&&G.length%2==0&&G.length<=B*2,"uniform "+T,u.commandStr),p="2i";break;case vn:s.command(Me(G)&&G.length&&G.length%2==0&&G.length<=B*2,"uniform "+T,u.commandStr),p="2i";break;case En:s.command(Me(G)&&G.length&&G.length%3==0&&G.length<=B*3,"uniform "+T,u.commandStr),p="3i";break;case yn:s.command(Me(G)&&G.length&&G.length%3==0&&G.length<=B*3,"uniform "+T,u.commandStr),p="3i";break;case xn:s.command(Me(G)&&G.length&&G.length%4==0&&G.length<=B*4,"uniform "+T,u.commandStr),p="4i";break;case _n:s.command(Me(G)&&G.length&&G.length%4==0&&G.length<=B*4,"uniform "+T,u.commandStr),p="4i";break}B>1?(p+="v",G=u.global.def("["+Array.prototype.slice.call(G)+"]")):G=Me(G)?Array.prototype.slice.call(G):G,i(b,".uniform",p,"(",ue,",",G,");")}continue}else k=K.append(u,i)}else{if(!g(Ro))continue;k=i.def(y.uniforms,"[",a.id(T),"]")}P===Br?(s(!Array.isArray(k),"must specify a scalar prop for textures"),i("if(",k,"&&",k,'._reglType==="framebuffer"){',k,"=",k,".color[0];","}")):P===kr&&(s(!Array.isArray(k),"must specify a scalar prop for cube maps"),i("if(",k,"&&",k,'._reglType==="framebufferCube"){',k,"=",k,".color[0];","}")),s.optional(function(){function pt(ft,Tn){u.assert(i,ft,'bad data or missing for uniform "'+T+'".  '+Tn)}function tr(ft,Tn){Tn===1&&s(!Array.isArray(k),"must not specify an array type for uniform"),pt("Array.isArray("+k+") && typeof "+k+'[0]===" '+ft+'" || typeof '+k+'==="'+ft+'"',"invalid type, expected "+ft)}function yt(ft,Tn,An){Array.isArray(k)?s(k.length&&k.length%ft==0&&k.length<=ft*An,"must have length of "+(An===1?"":"n * ")+ft):pt(y.isArrayLike+"("+k+")&&"+k+".length && "+k+".length % "+ft+" === 0 && "+k+".length<="+ft*An,"invalid vector, should have length of "+(An===1?"":"n * ")+ft,u.commandStr)}function Fo(ft){s(!Array.isArray(k),"must not specify a value type"),pt("typeof "+k+'==="function"&&'+k+'._reglType==="texture'+(ft===Eo?"2d":"Cube")+'"',"invalid texture type",u.commandStr)}switch(P){case xi:tr("number",B);break;case vn:yt(2,"number",B);break;case yn:yt(3,"number",B);break;case _n:yt(4,"number",B);break;case Ei:tr("number",B);break;case dn:yt(2,"number",B);break;case pn:yt(3,"number",B);break;case mn:yt(4,"number",B);break;case gi:tr("boolean",B);break;case bn:yt(2,"boolean",B);break;case En:yt(3,"boolean",B);break;case xn:yt(4,"boolean",B);break;case Ir:yt(4,"number",B);break;case Nr:yt(9,"number",B);break;case Fr:yt(16,"number",B);break;case Br:Fo(Eo);break;case kr:Fo(wl);break}});var Ne=1;switch(P){case Br:case kr:var at=i.def(k,"._texture");i(b,".uniform1i(",ue,",",at,".bind());"),i.exit(at,".unbind();");continue;case xi:case gi:p="1i";break;case vn:case bn:p="2i",Ne=2;break;case yn:case En:p="3i",Ne=3;break;case _n:case xn:p="4i",Ne=4;break;case Ei:p="1f";break;case dn:p="2f",Ne=2;break;case pn:p="3f",Ne=3;break;case mn:p="4f",Ne=4;break;case Ir:p="Matrix2fv";break;case Nr:p="Matrix3fv";break;case Fr:p="Matrix4fv";break}if(p.indexOf("Matrix")===-1&&B>1&&(p+="v",Ne=1),p.charAt(0)==="M"){i(b,".uniform",p,"(",ue,",");var Jt=Math.pow(P-Ir+2,2),Lt=u.global.def("new Float32Array(",Jt,")");Array.isArray(k)?i("false,(",ht(Jt,function(pt){return Lt+"["+pt+"]="+k[pt]}),",",Lt,")"):i("false,(Array.isArray(",k,")||",k," instanceof Float32Array)?",k,":(",ht(Jt,function(pt){return Lt+"["+pt+"]="+k+"["+pt+"]"}),",",Lt,")"),i(");")}else if(Ne>1){for(var At=[],Ft=[],er=0;er<Ne;++er)Array.isArray(k)?Ft.push(k[er]):Ft.push(i.def(k+"["+er+"]")),_&&At.push(i.def());_&&i("if(!",u.batchId,"||",At.map(function(pt,tr){return pt+"!=="+Ft[tr]}).join("||"),"){",At.map(function(pt,tr){return pt+"="+Ft[tr]+";"}).join("")),i(b,".uniform",p,"(",ue,",",Ft.join(","),");"),_&&i("}")}else{if(s(!Array.isArray(k),"uniform value must not be an array"),_){var No=i.def();i("if(!",u.batchId,"||",No,"!==",k,"){",No,"=",k,";")}i(b,".uniform",p,"(",ue,",",k,");"),_&&i("}")}}}function ye(u,i,v,E){var g=u.shared,_=g.gl,y=g.draw,b=E.draw;function l(){var pe=b.elements,de,Ee=i;return pe?((pe.contextDep&&E.contextDynamic||pe.propDep)&&(Ee=v),de=pe.append(u,Ee),b.elementsActive&&Ee("if("+de+")"+_+".bindBuffer("+bi+","+de+".buffer.buffer);")):(de=Ee.def(),Ee(de,"=",y,".",qt,";","if(",de,"){",_,".bindBuffer(",bi,",",de,".buffer.buffer);}","else if(",g.vao,".currentVAO){",de,"=",u.shared.elements+".getElements("+g.vao,".currentVAO.elements);",M?"":"if("+de+")"+_+".bindBuffer("+bi+","+de+".buffer.buffer);","}")),de}function p(){var pe=b.count,de,Ee=i;return pe?((pe.contextDep&&E.contextDynamic||pe.propDep)&&(Ee=v),de=pe.append(u,Ee),s.optional(function(){pe.MISSING&&u.assert(i,"false","missing vertex count"),pe.DYNAMIC&&u.assert(Ee,de+">=0","missing vertex count")})):(de=Ee.def(y,".",Qt),s.optional(function(){u.assert(Ee,de+">=0","missing vertex count")})),de}var c=l();function A(pe){var de=b[pe];return de?de.contextDep&&E.contextDynamic||de.propDep?de.append(u,v):de.append(u,i):i.def(y,".",pe)}var T=A(Yt),P=A(cn),B=p();if(typeof B=="number"){if(B===0)return}else v("if(",B,"){"),v.exit("}");var K,xe;$&&(K=A(hn),xe=u.instancing);var me=c+".type",ue=b.elements&&Nt(b.elements)&&!b.vaoActive;function k(){function pe(){v(xe,".drawElementsInstancedANGLE(",[T,B,me,P+"<<(("+me+"-"+Za+")>>1)",K],");")}function de(){v(xe,".drawArraysInstancedANGLE(",[T,P,B,K],");")}c&&c!=="null"?ue?pe():(v("if(",c,"){"),pe(),v("}else{"),de(),v("}")):de()}function G(){function pe(){v(_+".drawElements("+[T,B,me,P+"<<(("+me+"-"+Za+")>>1)"]+");")}function de(){v(_+".drawArrays("+[T,P,B]+");")}c&&c!=="null"?ue?pe():(v("if(",c,"){"),pe(),v("}else{"),de(),v("}")):de()}$&&(typeof K!="number"||K>=0)?typeof K=="string"?(v("if(",K,">0){"),k(),v("}else if(",K,"<0){"),G(),v("}")):k():G()}function Oe(u,i,v,E,g){var _=ge(),y=_.proc("body",g);return s.optional(function(){_.commandStr=i.commandStr,_.command=_.link(i.commandStr)}),$&&(_.instancing=y.def(_.shared.extensions,".angle_instanced_arrays")),u(_,y,v,E),_.compile().body}function Pe(u,i,v,E){Ue(u,i),v.useVAO?v.drawVAO?i(u.shared.vao,".setVAO(",v.drawVAO.append(u,i),");"):i(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(i(u.shared.vao,".setVAO(null);"),it(u,i,v,E.attributes,function(){return!0})),Ie(u,i,v,E.uniforms,function(){return!0},!1),ye(u,i,i,v)}function je(u,i){var v=u.proc("draw",1);Ue(u,v),qe(u,v,i.context),Ye(u,v,i.framebuffer),et(u,v,i),nt(u,v,i.state),Se(u,v,i,!1,!0);var E=i.shader.progVar.append(u,v);if(v(u.shared.gl,".useProgram(",E,".program);"),i.shader.program)Pe(u,v,i,i.shader.program);else{v(u.shared.vao,".setVAO(null);");var g=u.global.def("{}"),_=v.def(E,".id"),y=v.def(g,"[",_,"]");v(u.cond(y).then(y,".call(this,a0);").else(y,"=",g,"[",_,"]=",u.link(function(b){return Oe(Pe,u,i,b,1)}),"(",E,");",y,".call(this,a0);"))}Object.keys(i.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function Tt(u,i,v,E){u.batchId="a1",Ue(u,i);function g(){return!0}it(u,i,v,E.attributes,g),Ie(u,i,v,E.uniforms,g,!1),ye(u,i,i,v)}function Zt(u,i,v,E){Ue(u,i);var g=v.contextDep,_=i.def(),y="a0",b="a1",l=i.def();u.shared.props=l,u.batchId=_;var p=u.scope(),c=u.scope();i(p.entry,"for(",_,"=0;",_,"<",b,";++",_,"){",l,"=",y,"[",_,"];",c,"}",p.exit);function A(me){return me.contextDep&&g||me.propDep}function T(me){return!A(me)}if(v.needsContext&&qe(u,c,v.context),v.needsFramebuffer&&Ye(u,c,v.framebuffer),nt(u,c,v.state,A),v.profile&&A(v.profile)&&Se(u,c,v,!1,!0),E)v.useVAO?v.drawVAO?A(v.drawVAO)?c(u.shared.vao,".setVAO(",v.drawVAO.append(u,c),");"):p(u.shared.vao,".setVAO(",v.drawVAO.append(u,p),");"):p(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(p(u.shared.vao,".setVAO(null);"),it(u,p,v,E.attributes,T),it(u,c,v,E.attributes,A)),Ie(u,p,v,E.uniforms,T,!1),Ie(u,c,v,E.uniforms,A,!0),ye(u,p,c,v);else{var P=u.global.def("{}"),B=v.shader.progVar.append(u,c),K=c.def(B,".id"),xe=c.def(P,"[",K,"]");c(u.shared.gl,".useProgram(",B,".program);","if(!",xe,"){",xe,"=",P,"[",K,"]=",u.link(function(me){return Oe(Tt,u,v,me,2)}),"(",B,");}",xe,".call(this,a0[",_,"],",_,");")}}function d(u,i){var v=u.proc("batch",2);u.batchId="0",Ue(u,v);var E=!1,g=!0;Object.keys(i.context).forEach(function(P){E=E||i.context[P].propDep}),E||(qe(u,v,i.context),g=!1);var _=i.framebuffer,y=!1;_?(_.propDep?E=y=!0:_.contextDep&&E&&(y=!0),y||Ye(u,v,_)):Ye(u,v,null),i.state.viewport&&i.state.viewport.propDep&&(E=!0);function b(P){return P.contextDep&&E||P.propDep}et(u,v,i),nt(u,v,i.state,function(P){return!b(P)}),(!i.profile||!b(i.profile))&&Se(u,v,i,!1,"a1"),i.contextDep=E,i.needsContext=g,i.needsFramebuffer=y;var l=i.shader.progVar;if(l.contextDep&&E||l.propDep)Zt(u,v,i,null);else{var p=l.append(u,v);if(v(u.shared.gl,".useProgram(",p,".program);"),i.shader.program)Zt(u,v,i,i.shader.program);else{v(u.shared.vao,".setVAO(null);");var c=u.global.def("{}"),A=v.def(p,".id"),T=v.def(c,"[",A,"]");v(u.cond(T).then(T,".call(this,a0,a1);").else(T,"=",c,"[",A,"]=",u.link(function(P){return Oe(Zt,u,i,P,2)}),"(",p,");",T,".call(this,a0,a1);"))}}Object.keys(i.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function R(u,i){var v=u.proc("scope",3);u.batchId="a2";var E=u.shared,g=E.current;qe(u,v,i.context),i.framebuffer&&i.framebuffer.append(u,v),Lo(Object.keys(i.state)).forEach(function(y){var b=i.state[y],l=b.append(u,v);Me(l)?l.forEach(function(p,c){v.set(u.next[y],"["+c+"]",p)}):v.set(E.next,"."+y,l)}),Se(u,v,i,!0,!0),[qt,cn,Qt,hn,Yt].forEach(function(y){var b=i.draw[y];!b||v.set(E.draw,"."+y,""+b.append(u,v))}),Object.keys(i.uniforms).forEach(function(y){var b=i.uniforms[y].append(u,v);Array.isArray(b)&&(b="["+b.join()+"]"),v.set(E.uniforms,"["+a.id(y)+"]",b)}),Object.keys(i.attributes).forEach(function(y){var b=i.attributes[y].append(u,v),l=u.scopeAttrib(y);Object.keys(new x).forEach(function(p){v.set(l,"."+p,b[p])})}),i.scopeVAO&&v.set(E.vao,".targetVAO",i.scopeVAO.append(u,v));function _(y){var b=i.shader[y];b&&v.set(E.shader,"."+y,b.append(u,v))}_(Or),_(Gr),Object.keys(i.state).length>0&&(v(g,".dirty=true;"),v.exit(g,".dirty=true;")),v("a1(",u.shared.context,",a0,",u.batchId,");")}function C(u){if(!(typeof u!="object"||Me(u))){for(var i=Object.keys(u),v=0;v<i.length;++v)if(ct.isDynamic(u[i[v]]))return!0;return!1}}function ce(u,i,v){var E=i.static[v];if(!E||!C(E))return;var g=u.global,_=Object.keys(E),y=!1,b=!1,l=!1,p=u.global.def("{}");_.forEach(function(A){var T=E[A];if(ct.isDynamic(T)){typeof T=="function"&&(T=E[A]=ct.unbox(T));var P=st(T,null);y=y||P.thisDep,l=l||P.propDep,b=b||P.contextDep}else{switch(g(p,".",A,"="),typeof T){case"number":g(T);break;case"string":g('"',T,'"');break;case"object":Array.isArray(T)&&g("[",T.join(),"]");break;default:g(u.link(T));break}g(";")}});function c(A,T){_.forEach(function(P){var B=E[P];if(!!ct.isDynamic(B)){var K=A.invoke(T,B);T(p,".",P,"=",K,";")}})}i.dynamic[v]=new ct.DynamicVariable(un,{thisDep:y,contextDep:b,propDep:l,ref:p,append:c}),delete i.static[v]}function Re(u,i,v,E,g){var _=ge();_.stats=_.link(g),Object.keys(i.static).forEach(function(b){ce(_,i,b)}),Al.forEach(function(b){ce(_,u,b)});var y=$e(u,i,v,E,_);return je(_,y),R(_,y),d(_,y),o(_.compile(),{destroy:function(){y.shader.program.destroy()}})}return{next:ie,current:oe,procs:function(){var u=ge(),i=u.proc("poll"),v=u.proc("refresh"),E=u.block();i(E),v(E);var g=u.shared,_=g.gl,y=g.next,b=g.current;E(b,".dirty=false;"),Ye(u,i),Ye(u,v,null,!0);var l;$&&(l=u.link($)),m.oes_vertex_array_object&&v(u.link(m.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<L.maxAttributes;++p){var c=v.def(g.attributes,"[",p,"]"),A=u.cond(c,".buffer");A.then(_,".enableVertexAttribArray(",p,");",_,".bindBuffer(",yr,",",c,".buffer.buffer);",_,".vertexAttribPointer(",p,",",c,".size,",c,".type,",c,".normalized,",c,".stride,",c,".offset);").else(_,".disableVertexAttribArray(",p,");",_,".vertexAttrib4f(",p,",",c,".x,",c,".y,",c,".z,",c,".w);",c,".buffer=null;"),v(A),$&&v(l,".vertexAttribDivisorANGLE(",p,",",c,".divisor);")}return v(u.shared.vao,".currentVAO=null;",u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"),Object.keys(F).forEach(function(T){var P=F[T],B=E.def(y,".",T),K=u.block();K("if(",B,"){",_,".enable(",P,")}else{",_,".disable(",P,")}",b,".",T,"=",B,";"),v(K),i("if(",B,"!==",b,".",T,"){",K,"}")}),Object.keys(I).forEach(function(T){var P=I[T],B=oe[T],K,xe,me=u.block();if(me(_,".",P,"("),Me(B)){var ue=B.length;K=u.global.def(y,".",T),xe=u.global.def(b,".",T),me(ht(ue,function(k){return K+"["+k+"]"}),");",ht(ue,function(k){return xe+"["+k+"]="+K+"["+k+"];"}).join("")),i("if(",ht(ue,function(k){return K+"["+k+"]!=="+xe+"["+k+"]"}).join("||"),"){",me,"}")}else K=E.def(y,".",T),xe=E.def(b,".",T),me(K,");",b,".",T,"=",K,";"),i("if(",K,"!==",xe,"){",me,"}");v(me)}),u.compile()}(),compile:Re}}function jl(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hl=34918,zl=34919,Do=35007,$l=function(e,a){if(!a.ext_disjoint_timer_query)return null;var m=[];function L(){return m.pop()||a.ext_disjoint_timer_query.createQueryEXT()}function N($){m.push($)}var w=[];function O($){var fe=L();a.ext_disjoint_timer_query.beginQueryEXT(Do,fe),w.push(fe),H(w.length-1,w.length,$)}function U(){a.ext_disjoint_timer_query.endQueryEXT(Do)}function W(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var q=[];function Q(){return q.pop()||new W}function Y($){q.push($)}var Z=[];function H($,fe,M){var oe=Q();oe.startQueryIndex=$,oe.endQueryIndex=fe,oe.sum=0,oe.stats=M,Z.push(oe)}var X=[],x=[];function D(){var $,fe,M=w.length;if(M!==0){x.length=Math.max(x.length,M+1),X.length=Math.max(X.length,M+1),X[0]=0,x[0]=0;var oe=0;for($=0,fe=0;fe<w.length;++fe){var ie=w[fe];a.ext_disjoint_timer_query.getQueryObjectEXT(ie,zl)?(oe+=a.ext_disjoint_timer_query.getQueryObjectEXT(ie,Hl),N(ie)):w[$++]=ie,X[fe+1]=oe,x[fe+1]=$}for(w.length=$,$=0,fe=0;fe<Z.length;++fe){var ve=Z[fe],F=ve.startQueryIndex,I=ve.endQueryIndex;ve.sum+=X[I]-X[F];var he=x[F],J=x[I];J===he?(ve.stats.gpuTime+=ve.sum/1e6,Y(ve)):(ve.startQueryIndex=he,ve.endQueryIndex=J,Z[$++]=ve)}Z.length=$}}return{beginQuery:O,endQuery:U,pushScopeStats:H,update:D,getNumPendingQueries:function(){return w.length},clear:function(){m.push.apply(m,w);for(var $=0;$<m.length;$++)a.ext_disjoint_timer_query.deleteQueryEXT(m[$]);w.length=0,m.length=0},restore:function(){w.length=0,m.length=0}}},Xl=16384,ql=256,Yl=1024,Ql=34962,Oo="webglcontextlost",Go="webglcontextrestored",Po=1,Kl=2,Zl=3;function Io(e,a){for(var m=0;m<e.length;++m)if(e[m]===a)return m;return-1}function Jl(e){var a=Qs(e);if(!a)return null;var m=a.gl,L=m.getContextAttributes(),N=m.isContextLost(),w=Ks(m,a);if(!w)return null;var O=zs(),U=jl(),W=w.extensions,q=$l(m,W),Q=Wi(),Y=m.drawingBufferWidth,Z=m.drawingBufferHeight,H={tick:0,time:0,viewportWidth:Y,viewportHeight:Z,framebufferWidth:Y,framebufferHeight:Z,drawingBufferWidth:Y,drawingBufferHeight:Z,pixelRatio:a.pixelRatio},X={},x={elements:null,primitive:4,count:-1,offset:0,instances:-1},D=Mf(m,W),$=tu(m,U,a,oe),fe=du(m,W,$,U),M=dl(m,W,D,U,$,fe,x);function oe(ye){return M.destroyBuffer(ye)}var ie=yl(m,O,U,a),ve=Hu(m,W,D,function(){he.procs.poll()},H,U,a),F=zu(m,W,D,U,a),I=cl(m,W,D,ve,F,U),he=Ul(m,O,W,D,$,fe,ve,I,X,M,ie,x,H,q,a),J=El(m,I,he.procs.poll,H,L,W,D),z=he.next,ee=m.canvas,te=[],Te=[],ge=[],ae=[a.onDestroy],se=null;function be(){if(te.length===0){q&&q.update(),se=null;return}se=Rn.next(be),nt();for(var ye=te.length-1;ye>=0;--ye){var Oe=te[ye];Oe&&Oe(H,null,0)}m.flush(),q&&q.update()}function Ae(){!se&&te.length>0&&(se=Rn.next(be))}function De(){se&&(Rn.cancel(be),se=null)}function Ve(ye){ye.preventDefault(),N=!0,De(),Te.forEach(function(Oe){Oe()})}function We(ye){m.getError(),N=!1,w.restore(),ie.restore(),$.restore(),ve.restore(),F.restore(),I.restore(),M.restore(),q&&q.restore(),he.procs.refresh(),Ae(),ge.forEach(function(Oe){Oe()})}ee&&(ee.addEventListener(Oo,Ve,!1),ee.addEventListener(Go,We,!1));function Ge(){te.length=0,De(),ee&&(ee.removeEventListener(Oo,Ve),ee.removeEventListener(Go,We)),ie.clear(),I.clear(),F.clear(),M.clear(),ve.clear(),fe.clear(),$.clear(),q&&q.clear(),ae.forEach(function(ye){ye()})}function Xe(ye){s(!!ye,"invalid args to regl({...})"),s.type(ye,"object","invalid args to regl({...})");function Oe(g){var _=o({},g);delete _.uniforms,delete _.attributes,delete _.context,delete _.vao,"stencil"in _&&_.stencil.op&&(_.stencil.opBack=_.stencil.opFront=_.stencil.op,delete _.stencil.op);function y(b){if(b in _){var l=_[b];delete _[b],Object.keys(l).forEach(function(p){_[b+"."+p]=l[p]})}}return y("blend"),y("depth"),y("cull"),y("stencil"),y("polygonOffset"),y("scissor"),y("sample"),"vao"in g&&(_.vao=g.vao),_}function Pe(g,_){var y={},b={};return Object.keys(g).forEach(function(l){var p=g[l];if(ct.isDynamic(p)){b[l]=ct.unbox(p,l);return}else if(_&&Array.isArray(p)){for(var c=0;c<p.length;++c)if(ct.isDynamic(p[c])){b[l]=ct.unbox(p,l);return}}y[l]=p}),{dynamic:b,static:y}}var je=Pe(ye.context||{},!0),Tt=Pe(ye.uniforms||{},!0),Zt=Pe(ye.attributes||{},!1),d=Pe(Oe(ye),!1),R={gpuTime:0,cpuTime:0,count:0},C=he.compile(d,Zt,Tt,je,R),ce=C.draw,Re=C.batch,u=C.scope,i=[];function v(g){for(;i.length<g;)i.push(null);return i}function E(g,_){var y;if(N&&s.raise("context lost"),typeof g=="function")return u.call(this,null,g,0);if(typeof _=="function")if(typeof g=="number")for(y=0;y<g;++y)u.call(this,null,_,y);else if(Array.isArray(g))for(y=0;y<g.length;++y)u.call(this,g[y],_,y);else return u.call(this,g,_,0);else if(typeof g=="number"){if(g>0)return Re.call(this,v(g|0),g|0)}else if(Array.isArray(g)){if(g.length)return Re.call(this,g,g.length)}else return ce.call(this,g)}return o(E,{stats:R,destroy:function(){C.destroy()}})}var ke=I.setFBO=Xe({framebuffer:ct.define.call(null,Po,"framebuffer")});function $e(ye,Oe){var Pe=0;he.procs.poll();var je=Oe.color;je&&(m.clearColor(+je[0]||0,+je[1]||0,+je[2]||0,+je[3]||0),Pe|=Xl),"depth"in Oe&&(m.clearDepth(+Oe.depth),Pe|=ql),"stencil"in Oe&&(m.clearStencil(Oe.stencil|0),Pe|=Yl),s(!!Pe,"called regl.clear with no buffer specified"),m.clear(Pe)}function qe(ye){if(s(typeof ye=="object"&&ye,"regl.clear() takes an object as input"),"framebuffer"in ye)if(ye.framebuffer&&ye.framebuffer_reglType==="framebufferCube")for(var Oe=0;Oe<6;++Oe)ke(o({framebuffer:ye.framebuffer.faces[Oe]},ye),$e);else ke(ye,$e);else $e(null,ye)}function Ye(ye){s.type(ye,"function","regl.frame() callback must be a function"),te.push(ye);function Oe(){var Pe=Io(te,ye);s(Pe>=0,"cannot cancel a frame twice");function je(){var Tt=Io(te,je);te[Tt]=te[te.length-1],te.length-=1,te.length<=0&&De()}te[Pe]=je}return Ae(),{cancel:Oe}}function et(){var ye=z.viewport,Oe=z.scissor_box;ye[0]=ye[1]=Oe[0]=Oe[1]=0,H.viewportWidth=H.framebufferWidth=H.drawingBufferWidth=ye[2]=Oe[2]=m.drawingBufferWidth,H.viewportHeight=H.framebufferHeight=H.drawingBufferHeight=ye[3]=Oe[3]=m.drawingBufferHeight}function nt(){H.tick+=1,H.time=Se(),et(),he.procs.poll()}function Ue(){ve.refresh(),et(),he.procs.refresh(),q&&q.update()}function Se(){return(Wi()-Q)/1e3}Ue();function it(ye,Oe){s.type(Oe,"function","listener callback must be a function");var Pe;switch(ye){case"frame":return Ye(Oe);case"lost":Pe=Te;break;case"restore":Pe=ge;break;case"destroy":Pe=ae;break;default:s.raise("invalid event, must be one of frame,lost,restore,destroy")}return Pe.push(Oe),{cancel:function(){for(var je=0;je<Pe.length;++je)if(Pe[je]===Oe){Pe[je]=Pe[Pe.length-1],Pe.pop();return}}}}var Ie=o(Xe,{clear:qe,prop:ct.define.bind(null,Po),context:ct.define.bind(null,Kl),this:ct.define.bind(null,Zl),draw:Xe({}),buffer:function(ye){return $.create(ye,Ql,!1,!1)},elements:function(ye){return fe.create(ye,!1)},texture:ve.create2D,cube:ve.createCube,renderbuffer:F.create,framebuffer:I.create,framebufferCube:I.createCube,vao:M.createVAO,attributes:L,frame:Ye,on:it,limits:D,hasExtension:function(ye){return D.extensions.indexOf(ye.toLowerCase())>=0},read:J,destroy:Ge,_gl:m,_refresh:Ue,poll:function(){nt(),q&&q.update()},now:Se,stats:U});return a.onDone(null,Ie),Ie}return Jl})}),oc=ac});var Rt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Ke(j,r,h){return h={path:r,exports:{},require:function(o,t){return nc(o,t==null?h.path:t)}},j(h,h.exports),h.exports}function nc(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var sc=Promise.resolve().then(()=>ko()),Mo=class{constructor(r,h,o){this.IsProgramValid=!1,this._webglDom=document.querySelector(r),this.IsProgramValid=this._webglDom!=null,this.IsProgramValid&&(this.RegisterDomEvent(),this.SetCanvasSize(h,o))}RegisterDomEvent(){window.addEventListener("resize",()=>{})}async CreatREGLCanvas(r){return(await sc).default({canvas:r})}SetCanvasSize(r,h){this.screenHeight=h,this.screenWidth=r,this._webglDom.width=r,this._webglDom.height=h}ScreenPositionToClipSpace(r,h){let o=r/this.screenWidth*2-1,t=h/this.screenHeight*2-1;return{x:o,y:t}}ClipSpaceToScreenPosition(r,h){let o=(r+1*.5)*this.screenWidth,t=(h+1*.5)*this.screenWidth;return{x:o,y:t}}ReadPixel(r,h){return Array.from(this._reglContext.read({x:r,y:h,width:1,height:1,data:new Uint8Array(4)})).map(o=>o/255)}},Vo=Mo;var we=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=Object.prototype.hasOwnProperty;r.has=function(le,_e){return h.call(le,_e)};function o(le,_e){return le<_e?-1:le===_e?0:1}r.defaultCompare=o;function t(le,_e){return le===_e}r.defaultEquals=t;function n(le){return le===null?"COLLECTION_NULL":V(le)?"COLLECTION_UNDEFINED":ne(le)?"$s"+le:"$o"+le.toString()}r.defaultToString=n;function f(le,_e){if(_e===void 0&&(_e=","),le===null)return"COLLECTION_NULL";if(V(le))return"COLLECTION_UNDEFINED";if(ne(le))return le.toString();var Ce="{",Be=!0;for(var Je in le)r.has(le,Je)&&(Be?Be=!1:Ce=Ce+_e,Ce=Ce+Je+":"+le[Je]);return Ce+"}"}r.makeString=f;function S(le){return typeof le=="function"}r.isFunction=S;function V(le){return typeof le=="undefined"}r.isUndefined=V;function ne(le){return Object.prototype.toString.call(le)==="[object String]"}r.isString=ne;function re(le){return V(le)||!S(le)?function(_e,Ce){return _e<Ce?1:_e===Ce?0:-1}:function(_e,Ce){return le(_e,Ce)*-1}}r.reverseCompareFunction=re;function Le(le){return function(_e,Ce){return le(_e,Ce)===0}}r.compareToEquals=Le}),St=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});function h(le,_e,Ce){for(var Be=Ce||we.defaultEquals,Je=le.length,Fe=0;Fe<Je;Fe++)if(Be(le[Fe],_e))return Fe;return-1}r.indexOf=h;function o(le,_e,Ce){for(var Be=Ce||we.defaultEquals,Je=le.length,Fe=Je-1;Fe>=0;Fe--)if(Be(le[Fe],_e))return Fe;return-1}r.lastIndexOf=o;function t(le,_e,Ce){return h(le,_e,Ce)>=0}r.contains=t;function n(le,_e,Ce){var Be=h(le,_e,Ce);return Be<0?!1:(le.splice(Be,1),!0)}r.remove=n;function f(le,_e,Ce){for(var Be=Ce||we.defaultEquals,Je=le.length,Fe=0,Et=0;Et<Je;Et++)Be(le[Et],_e)&&Fe++;return Fe}r.frequency=f;function S(le,_e,Ce){var Be=Ce||we.defaultEquals;if(le.length!==_e.length)return!1;for(var Je=le.length,Fe=0;Fe<Je;Fe++)if(!Be(le[Fe],_e[Fe]))return!1;return!0}r.equals=S;function V(le){return le.concat()}r.copy=V;function ne(le,_e,Ce){if(_e<0||_e>=le.length||Ce<0||Ce>=le.length)return!1;var Be=le[_e];return le[_e]=le[Ce],le[Ce]=Be,!0}r.swap=ne;function re(le){return"["+le.toString()+"]"}r.toString=re;function Le(le,_e){for(var Ce=0,Be=le;Ce<Be.length;Ce++){var Je=Be[Ce];if(_e(Je)===!1)return}}r.forEach=Le}),br=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t){this.table={},this.nElements=0,this.toStr=t||we.defaultToString}return o.prototype.getValue=function(t){var n=this.table["$"+this.toStr(t)];if(!we.isUndefined(n))return n.value},o.prototype.setValue=function(t,n){if(!(we.isUndefined(t)||we.isUndefined(n))){var f,S="$"+this.toStr(t),V=this.table[S];return we.isUndefined(V)?(this.nElements++,f=void 0):f=V.value,this.table[S]={key:t,value:n},f}},o.prototype.remove=function(t){var n="$"+this.toStr(t),f=this.table[n];if(!we.isUndefined(f))return delete this.table[n],this.nElements--,f.value},o.prototype.keys=function(){var t=[];for(var n in this.table)if(we.has(this.table,n)){var f=this.table[n];t.push(f.key)}return t},o.prototype.values=function(){var t=[];for(var n in this.table)if(we.has(this.table,n)){var f=this.table[n];t.push(f.value)}return t},o.prototype.forEach=function(t){for(var n in this.table)if(we.has(this.table,n)){var f=this.table[n],S=t(f.key,f.value);if(S===!1)return}},o.prototype.containsKey=function(t){return!we.isUndefined(this.getValue(t))},o.prototype.clear=function(){this.table={},this.nElements=0},o.prototype.size=function(){return this.nElements},o.prototype.isEmpty=function(){return this.nElements<=0},o.prototype.toString=function(){var t="{";return this.forEach(function(n,f){t+=`
	`+n+" : "+f}),t+`
}`},o}();r.default=h}),Wo=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t){this.dictionary=new br.default(t)}return o.prototype.contains=function(t){return this.dictionary.containsKey(t)},o.prototype.add=function(t){return this.contains(t)||we.isUndefined(t)?!1:(this.dictionary.setValue(t,t),!0)},o.prototype.intersection=function(t){var n=this;this.forEach(function(f){return t.contains(f)||n.remove(f),!0})},o.prototype.union=function(t){var n=this;t.forEach(function(f){return n.add(f),!0})},o.prototype.difference=function(t){var n=this;t.forEach(function(f){return n.remove(f),!0})},o.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var n=!0;return this.forEach(function(f){return t.contains(f)?!0:(n=!1,!1)}),n},o.prototype.remove=function(t){return this.contains(t)?(this.dictionary.remove(t),!0):!1},o.prototype.forEach=function(t){this.dictionary.forEach(function(n,f){return t(f)})},o.prototype.toArray=function(){return this.dictionary.values()},o.prototype.isEmpty=function(){return this.dictionary.isEmpty()},o.prototype.size=function(){return this.dictionary.size()},o.prototype.clear=function(){this.dictionary.clear()},o.prototype.toString=function(){return St.toString(this.toArray())},o}();r.default=h}),fc=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t){this.toStrF=t||we.defaultToString,this.dictionary=new br.default(this.toStrF),this.nElements=0}return o.prototype.add=function(t,n){if(n===void 0&&(n=1),we.isUndefined(t)||n<=0)return!1;if(this.contains(t))this.dictionary.getValue(t).copies+=n;else{var f={value:t,copies:n};this.dictionary.setValue(t,f)}return this.nElements+=n,!0},o.prototype.count=function(t){return this.contains(t)?this.dictionary.getValue(t).copies:0},o.prototype.contains=function(t){return this.dictionary.containsKey(t)},o.prototype.remove=function(t,n){if(n===void 0&&(n=1),we.isUndefined(t)||n<=0)return!1;if(this.contains(t)){var f=this.dictionary.getValue(t);return n>f.copies?this.nElements-=f.copies:this.nElements-=n,f.copies-=n,f.copies<=0&&this.dictionary.remove(t),!0}else return!1},o.prototype.toArray=function(){for(var t=[],n=this.dictionary.values(),f=0,S=n;f<S.length;f++)for(var V=S[f],ne=V.value,re=V.copies,Le=0;Le<re;Le++)t.push(ne);return t},o.prototype.toSet=function(){for(var t=new Wo.default(this.toStrF),n=this.dictionary.values(),f=0,S=n;f<S.length;f++){var V=S[f],ne=V.value;t.add(ne)}return t},o.prototype.forEach=function(t){this.dictionary.forEach(function(n,f){for(var S=f.value,V=f.copies,ne=0;ne<V;ne++)if(t(S)===!1)return!1;return!0})},o.prototype.size=function(){return this.nElements},o.prototype.isEmpty=function(){return this.nElements===0},o.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},o}();r.default=h}),Ci=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(){this.firstNode=null,this.lastNode=null,this.nElements=0}return o.prototype.add=function(t,n){if(we.isUndefined(n)&&(n=this.nElements),n<0||n>this.nElements||we.isUndefined(t))return!1;var f=this.createNode(t);if(this.nElements===0||this.lastNode===null)this.firstNode=f,this.lastNode=f;else if(n===this.nElements)this.lastNode.next=f,this.lastNode=f;else if(n===0)f.next=this.firstNode,this.firstNode=f;else{var S=this.nodeAtIndex(n-1);if(S===null)return!1;f.next=S.next,S.next=f}return this.nElements++,!0},o.prototype.first=function(){if(this.firstNode!==null)return this.firstNode.element},o.prototype.last=function(){if(this.lastNode!==null)return this.lastNode.element},o.prototype.elementAtIndex=function(t){var n=this.nodeAtIndex(t);if(n!==null)return n.element},o.prototype.indexOf=function(t,n){var f=n||we.defaultEquals;if(we.isUndefined(t))return-1;for(var S=this.firstNode,V=0;S!==null;){if(f(S.element,t))return V;V++,S=S.next}return-1},o.prototype.contains=function(t,n){return this.indexOf(t,n)>=0},o.prototype.remove=function(t,n){var f=n||we.defaultEquals;if(this.nElements<1||we.isUndefined(t))return!1;for(var S=null,V=this.firstNode;V!==null;){if(f(V.element,t))return S===null?(this.firstNode=V.next,V===this.lastNode&&(this.lastNode=null)):V===this.lastNode?(this.lastNode=S,S.next=V.next,V.next=null):(S.next=V.next,V.next=null),this.nElements--,!0;S=V,V=V.next}return!1},o.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},o.prototype.equals=function(t,n){var f=n||we.defaultEquals;return!(t instanceof o)||this.size()!==t.size()?!1:this.equalsAux(this.firstNode,t.firstNode,f)},o.prototype.equalsAux=function(t,n,f){for(;t!==null&&n!==null;){if(!f(t.element,n.element))return!1;t=t.next,n=n.next}return!0},o.prototype.removeElementAtIndex=function(t){if(!(t<0||t>=this.nElements||this.firstNode===null||this.lastNode===null)){var n;if(this.nElements===1)n=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var f=this.nodeAtIndex(t-1);f===null?(n=this.firstNode.element,this.firstNode=this.firstNode.next):f.next===this.lastNode&&(n=this.lastNode.element,this.lastNode=f),f!==null&&f.next!==null&&(n=f.next.element,f.next=f.next.next)}return this.nElements--,n}},o.prototype.forEach=function(t){for(var n=this.firstNode;n!==null&&t(n.element)!==!1;)n=n.next},o.prototype.reverse=function(){for(var t=null,n=this.firstNode,f=null;n!==null;)f=n.next,n.next=t,t=n,n=f;f=this.firstNode,this.firstNode=this.lastNode,this.lastNode=f},o.prototype.toArray=function(){for(var t=[],n=this.firstNode;n!==null;)t.push(n.element),n=n.next;return t},o.prototype.size=function(){return this.nElements},o.prototype.isEmpty=function(){return this.nElements<=0},o.prototype.toString=function(){return St.toString(this.toArray())},o.prototype.nodeAtIndex=function(t){if(t<0||t>=this.nElements)return null;if(t===this.nElements-1)return this.lastNode;for(var n=this.firstNode,f=0;f<t&&n!==null;f++)n=n.next;return n},o.prototype.createNode=function(t){return{element:t,next:null}},o}();r.default=h}),Uo=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(){this.list=new Ci.default}return o.prototype.enqueue=function(t){return this.list.add(t)},o.prototype.add=function(t){return this.list.add(t)},o.prototype.dequeue=function(){if(this.list.size()!==0){var t=this.list.first();return this.list.removeElementAtIndex(0),t}},o.prototype.peek=function(){if(this.list.size()!==0)return this.list.first()},o.prototype.size=function(){return this.list.size()},o.prototype.contains=function(t,n){return this.list.contains(t,n)},o.prototype.isEmpty=function(){return this.list.size()<=0},o.prototype.clear=function(){this.list.clear()},o.prototype.forEach=function(t){this.list.forEach(t)},o}();r.default=h}),jo=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t){this.root=null,this.compare=t||we.defaultCompare,this.nElements=0}return o.prototype.add=function(t){return we.isUndefined(t)?!1:this.insertNode(this.createNode(t))!==null?(this.nElements++,!0):!1},o.prototype.clear=function(){this.root=null,this.nElements=0},o.prototype.isEmpty=function(){return this.nElements===0},o.prototype.size=function(){return this.nElements},o.prototype.contains=function(t){return we.isUndefined(t)?!1:this.searchNode(this.root,t)!==null},o.prototype.search=function(t){var n=this.searchNode(this.root,t);if(n!==null)return n.element},o.prototype.remove=function(t){var n=this.searchNode(this.root,t);return n===null?!1:(this.removeNode(n),this.nElements--,!0)},o.prototype.inorderTraversal=function(t){this.inorderTraversalAux(this.root,t,{stop:!1})},o.prototype.preorderTraversal=function(t){this.preorderTraversalAux(this.root,t,{stop:!1})},o.prototype.postorderTraversal=function(t){this.postorderTraversalAux(this.root,t,{stop:!1})},o.prototype.levelTraversal=function(t){this.levelTraversalAux(this.root,t)},o.prototype.minimum=function(){if(!(this.isEmpty()||this.root===null))return this.minimumAux(this.root).element},o.prototype.maximum=function(){if(!(this.isEmpty()||this.root===null))return this.maximumAux(this.root).element},o.prototype.forEach=function(t){this.inorderTraversal(t)},o.prototype.toArray=function(){var t=[];return this.inorderTraversal(function(n){return t.push(n),!0}),t},o.prototype.height=function(){return this.heightAux(this.root)},o.prototype.searchNode=function(t,n){for(var f=1;t!==null&&f!==0;)f=this.compare(n,t.element),f<0?t=t.leftCh:f>0&&(t=t.rightCh);return t},o.prototype.transplant=function(t,n){t.parent===null?this.root=n:t===t.parent.leftCh?t.parent.leftCh=n:t.parent.rightCh=n,n!==null&&(n.parent=t.parent)},o.prototype.removeNode=function(t){if(t.leftCh===null)this.transplant(t,t.rightCh);else if(t.rightCh===null)this.transplant(t,t.leftCh);else{var n=this.minimumAux(t.rightCh);n.parent!==t&&(this.transplant(n,n.rightCh),n.rightCh=t.rightCh,n.rightCh.parent=n),this.transplant(t,n),n.leftCh=t.leftCh,n.leftCh.parent=n}},o.prototype.inorderTraversalAux=function(t,n,f){t===null||f.stop||(this.inorderTraversalAux(t.leftCh,n,f),!f.stop&&(f.stop=n(t.element)===!1,!f.stop&&this.inorderTraversalAux(t.rightCh,n,f)))},o.prototype.levelTraversalAux=function(t,n){var f=new Uo.default;for(t!==null&&f.enqueue(t),t=f.dequeue()||null;t!=null;){if(n(t.element)===!1)return;t.leftCh!==null&&f.enqueue(t.leftCh),t.rightCh!==null&&f.enqueue(t.rightCh),t=f.dequeue()||null}},o.prototype.preorderTraversalAux=function(t,n,f){t===null||f.stop||(f.stop=n(t.element)===!1,!f.stop&&(this.preorderTraversalAux(t.leftCh,n,f),!f.stop&&this.preorderTraversalAux(t.rightCh,n,f)))},o.prototype.postorderTraversalAux=function(t,n,f){t===null||f.stop||(this.postorderTraversalAux(t.leftCh,n,f),!f.stop&&(this.postorderTraversalAux(t.rightCh,n,f),!f.stop&&(f.stop=n(t.element)===!1)))},o.prototype.minimumAux=function(t){for(;t!=null&&t.leftCh!==null;)t=t.leftCh;return t},o.prototype.maximumAux=function(t){for(;t!=null&&t.rightCh!==null;)t=t.rightCh;return t},o.prototype.heightAux=function(t){return t===null?-1:Math.max(this.heightAux(t.leftCh),this.heightAux(t.rightCh))+1},o.prototype.insertNode=function(t){for(var n=null,f=this.root;f!==null;){var S=this.compare(t.element,f.element);if(S===0)return null;S<0?(n=f,f=f.leftCh):(n=f,f=f.rightCh)}return t.parent=n,n===null?this.root=t:this.compare(t.element,n.element)<0?n.leftCh=t:n.rightCh=t,t},o.prototype.createNode=function(t){return{element:t,leftCh:null,rightCh:null,parent:null}},o}();r.default=h}),uc=Ke(function(j,r){var h=Rt&&Rt.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,f){n.__proto__=f}||function(n,f){for(var S in f)f.hasOwnProperty(S)&&(n[S]=f[S])};return function(n,f){t(n,f);function S(){this.constructor=n}n.prototype=f===null?Object.create(f):(S.prototype=f.prototype,new S)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){h(n,t);function n(){return t!==null&&t.apply(this,arguments)||this}return n}(jo.default);r.default=o}),Ho=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t){this.data=[],this.compare=t||we.defaultCompare}return o.prototype.leftChildIndex=function(t){return 2*t+1},o.prototype.rightChildIndex=function(t){return 2*t+2},o.prototype.parentIndex=function(t){return Math.floor((t-1)/2)},o.prototype.minIndex=function(t,n){return n>=this.data.length?t>=this.data.length?-1:t:this.compare(this.data[t],this.data[n])<=0?t:n},o.prototype.siftUp=function(t){for(var n=this.parentIndex(t);t>0&&this.compare(this.data[n],this.data[t])>0;)St.swap(this.data,n,t),t=n,n=this.parentIndex(t)},o.prototype.siftDown=function(t){for(var n=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));n>=0&&this.compare(this.data[t],this.data[n])>0;)St.swap(this.data,n,t),t=n,n=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))},o.prototype.peek=function(){if(this.data.length>0)return this.data[0]},o.prototype.add=function(t){return we.isUndefined(t)?!1:(this.data.push(t),this.siftUp(this.data.length-1),!0)},o.prototype.removeRoot=function(){if(this.data.length>0){var t=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),t}},o.prototype.contains=function(t){var n=we.compareToEquals(this.compare);return St.contains(this.data,t,n)},o.prototype.size=function(){return this.data.length},o.prototype.isEmpty=function(){return this.data.length<=0},o.prototype.clear=function(){this.data.length=0},o.prototype.forEach=function(t){St.forEach(this.data,t)},o}();r.default=h}),lc=Ke(function(j,r){var h=Rt&&Rt.__extends||function(){var S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,ne){V.__proto__=ne}||function(V,ne){for(var re in ne)ne.hasOwnProperty(re)&&(V[re]=ne[re])};return function(V,ne){S(V,ne);function re(){this.constructor=V}V.prototype=ne===null?Object.create(ne):(re.prototype=ne.prototype,new re)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function S(V,ne){this.key=V,this.value=ne}return S.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},S}(),t=function(){function S(){this.key=null,this.value=null}return S.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},S}();function n(S){return!S.next}var f=function(S){h(V,S);function V(ne){var re=S.call(this,ne)||this;return re.head=new t,re.tail=new t,re.head.next=re.tail,re.tail.prev=re.head,re}return V.prototype.appendToTail=function(ne){var re=this.tail.prev;re.next=ne,ne.prev=re,ne.next=this.tail,this.tail.prev=ne},V.prototype.getLinkedDictionaryPair=function(ne){if(!we.isUndefined(ne)){var re="$"+this.toStr(ne),Le=this.table[re];return Le}},V.prototype.getValue=function(ne){var re=this.getLinkedDictionaryPair(ne);if(!we.isUndefined(re))return re.value},V.prototype.remove=function(ne){var re=this.getLinkedDictionaryPair(ne);if(!we.isUndefined(re))return S.prototype.remove.call(this,ne),re.unlink(),re.value},V.prototype.clear=function(){S.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},V.prototype.replace=function(ne,re){var Le="$"+this.toStr(re.key);re.next=ne.next,re.prev=ne.prev,this.remove(ne.key),re.prev.next=re,re.next.prev=re,this.table[Le]=re,++this.nElements},V.prototype.setValue=function(ne,re){if(!(we.isUndefined(ne)||we.isUndefined(re))){var Le=this.getLinkedDictionaryPair(ne),le=new o(ne,re),_e="$"+this.toStr(ne);if(we.isUndefined(Le)){this.appendToTail(le),this.table[_e]=le,++this.nElements;return}else return this.replace(Le,le),Le.value}},V.prototype.keys=function(){var ne=[];return this.forEach(function(re,Le){ne.push(re)}),ne},V.prototype.values=function(){var ne=[];return this.forEach(function(re,Le){ne.push(Le)}),ne},V.prototype.forEach=function(ne){for(var re=this.head.next;!n(re);){var Le=ne(re.key,re.value);if(Le===!1)return;re=re.next}},V}(br.default);r.default=f}),cc=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t,n,f){f===void 0&&(f=!1),this.dict=new br.default(t),this.equalsF=n||we.defaultEquals,this.allowDuplicate=f}return o.prototype.getValue=function(t){var n=this.dict.getValue(t);return we.isUndefined(n)?[]:St.copy(n)},o.prototype.setValue=function(t,n){if(we.isUndefined(t)||we.isUndefined(n))return!1;var f=this.dict.getValue(t);return we.isUndefined(f)?(this.dict.setValue(t,[n]),!0):!this.allowDuplicate&&St.contains(f,n,this.equalsF)?!1:(f.push(n),!0)},o.prototype.remove=function(t,n){if(we.isUndefined(n)){var f=this.dict.remove(t);return!we.isUndefined(f)}var S=this.dict.getValue(t);return!we.isUndefined(S)&&St.remove(S,n,this.equalsF)?(S.length===0&&this.dict.remove(t),!0):!1},o.prototype.keys=function(){return this.dict.keys()},o.prototype.values=function(){for(var t=this.dict.values(),n=[],f=0,S=t;f<S.length;f++)for(var V=S[f],ne=0,re=V;ne<re.length;ne++){var Le=re[ne];n.push(Le)}return n},o.prototype.containsKey=function(t){return this.dict.containsKey(t)},o.prototype.clear=function(){this.dict.clear()},o.prototype.size=function(){return this.dict.size()},o.prototype.isEmpty=function(){return this.dict.isEmpty()},o}();r.default=h}),zo=Ke(function(j,r){var h=Rt&&Rt.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,f){n.__proto__=f}||function(n,f){for(var S in f)f.hasOwnProperty(S)&&(n[S]=f[S])};return function(n,f){t(n,f);function S(){this.constructor=n}n.prototype=f===null?Object.create(f):(S.prototype=f.prototype,new S)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=function(t){h(n,t);function n(f,S){var V=t.call(this,S)||this;return V.defaultFactoryFunction=f,V}return n.prototype.setDefault=function(f,S){var V=t.prototype.getValue.call(this,f);return we.isUndefined(V)?(this.setValue(f,S),S):V},n.prototype.getValue=function(f){return this.setDefault(f,this.defaultFactoryFunction())},n}(br.default);r.default=o}),hc=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(t){this.heap=new Ho.default(we.reverseCompareFunction(t))}return o.prototype.enqueue=function(t){return this.heap.add(t)},o.prototype.add=function(t){return this.heap.add(t)},o.prototype.dequeue=function(){if(this.heap.size()!==0){var t=this.heap.peek();return this.heap.removeRoot(),t}},o.prototype.peek=function(){return this.heap.peek()},o.prototype.contains=function(t){return this.heap.contains(t)},o.prototype.isEmpty=function(){return this.heap.isEmpty()},o.prototype.size=function(){return this.heap.size()},o.prototype.clear=function(){this.heap.clear()},o.prototype.forEach=function(t){this.heap.forEach(t)},o}();r.default=h}),dc=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h=function(){function o(){this.list=new Ci.default}return o.prototype.push=function(t){return this.list.add(t,0)},o.prototype.add=function(t){return this.list.add(t,0)},o.prototype.pop=function(){return this.list.removeElementAtIndex(0)},o.prototype.peek=function(){return this.list.first()},o.prototype.size=function(){return this.list.size()},o.prototype.contains=function(t,n){return this.list.contains(t,n)},o.prototype.isEmpty=function(){return this.list.isEmpty()},o.prototype.clear=function(){this.list.clear()},o.prototype.forEach=function(t){this.list.forEach(t)},o}();r.default=h}),pc=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0});var h;(function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER",t[t.INSIDE_AT_END=2]="INSIDE_AT_END",t[t.INSIDE_AT_START=3]="INSIDE_AT_START"})(h||(h={}));var o=function(){function t(n,f){n===void 0&&(n=[]),f===void 0&&(f={}),this.rootIds=n,this.nodes=f,this.initRootIds(),this.initNodes()}return t.prototype.initRootIds=function(){for(var n=0,f=this.rootIds;n<f.length;n++){var S=f[n];this.createEmptyNodeIfNotExist(S)}},t.prototype.initNodes=function(){for(var n in this.nodes)if(this.nodes.hasOwnProperty(n))for(var f=0,S=this.nodes[n];f<S.length;f++){var V=S[f];this.createEmptyNodeIfNotExist(V)}},t.prototype.createEmptyNodeIfNotExist=function(n){this.nodes[n]||(this.nodes[n]=[])},t.prototype.getRootIds=function(){var n=this.rootIds.slice();return n},t.prototype.getNodes=function(){var n={};for(var f in this.nodes)this.nodes.hasOwnProperty(f)&&(n[f]=this.nodes[f].slice());return n},t.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},t.prototype.toObject=function(){return this.getObject()},t.prototype.flatten=function(){for(var n=this,f=[],S=0;S<this.rootIds.length;S++){var V=this.rootIds[S];f.push({id:V,level:0,hasParent:!1,childrenCount:0}),_e(V,this.nodes,f,0)}for(var ne=0,re=f;ne<re.length;ne++){var Le=re[ne];Le.childrenCount=le(Le.id)}return f;function le(Ce){if(n.nodes[Ce]){var Be=n.nodes[Ce].length;return Be}else return 0}function _e(Ce,Be,Je,Fe){if(Fe===void 0&&(Fe=0),!(!Ce||!Be||!Je||!Be[Ce])){Fe++;for(var Et=Be[Ce],nr=0;nr<Et.length;nr++){var xr=Et[nr];Je.push({id:xr,level:Fe,hasParent:!0}),_e(xr,Be,Je,Fe)}Fe--}}},t.prototype.moveIdBeforeId=function(n,f){return this.moveId(n,f,h.BEFORE)},t.prototype.moveIdAfterId=function(n,f){return this.moveId(n,f,h.AFTER)},t.prototype.moveIdIntoId=function(n,f,S){return S===void 0&&(S=!0),S?this.moveId(n,f,h.INSIDE_AT_START):this.moveId(n,f,h.INSIDE_AT_END)},t.prototype.swapRootIdWithRootId=function(n,f){var S=this.findRootId(n),V=this.findRootId(f);this.swapRootPositionWithRootPosition(S,V)},t.prototype.swapRootPositionWithRootPosition=function(n,f){var S=this.rootIds[f];this.rootIds[f]=this.rootIds[n],this.rootIds[n]=S},t.prototype.deleteId=function(n){this.rootDeleteId(n),this.nodeAndSubNodesDelete(n),this.nodeRefrencesDelete(n)},t.prototype.insertIdBeforeId=function(n,f){var S=this.findRootId(n);S>-1&&this.insertIdIntoRoot(f,S);for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)){var ne=this.findNodeId(V,n);ne>-1&&this.insertIdIntoNode(V,f,ne)}},t.prototype.insertIdAfterId=function(n,f){var S=this.findRootId(n);S>-1&&this.insertIdIntoRoot(f,S+1);for(var V in this.nodes)if(this.nodes.hasOwnProperty(V)){var ne=this.findNodeId(V,n);ne>-1&&this.insertIdIntoNode(V,f,ne+1)}},t.prototype.insertIdIntoId=function(n,f){this.nodeInsertAtEnd(n,f),this.nodes[f]=[]},t.prototype.insertIdIntoRoot=function(n,f){if(f===void 0)this.rootInsertAtEnd(n);else if(f<0){var S=this.rootIds.length;this.rootIds.splice(f+S+1,0,n)}else this.rootIds.splice(f,0,n);this.nodes[n]=this.nodes[n]||[]},t.prototype.insertIdIntoNode=function(n,f,S){if(this.nodes[n]=this.nodes[n]||[],this.nodes[f]=this.nodes[f]||[],S===void 0)this.nodeInsertAtEnd(n,f);else if(S<0){var V=this.nodes[n].length;this.nodes[n].splice(S+V+1,0,f)}else this.nodes[n].splice(S,0,f)},t.prototype.moveId=function(n,f,S){var V=n,ne=this.findRootId(V);this.nodes[f];for(var re in this.nodes)if(this.nodes.hasOwnProperty(re)){this.findNodeId(re,f);break}var Le=f,le=this.findRootId(Le);this.nodes[f];for(var re in this.nodes)if(this.nodes.hasOwnProperty(re)){this.findNodeId(re,f);break}if(ne>-1)if(le>-1)switch(this.rootDelete(ne),le>ne&&le--,S){case h.BEFORE:this.insertIdIntoRoot(V,le);break;case h.AFTER:this.insertIdIntoRoot(V,le+1);break;case h.INSIDE_AT_START:this.nodeInsertAtStart(Le,V);break;case h.INSIDE_AT_END:this.nodeInsertAtEnd(Le,V);break}else{this.rootDelete(ne);for(var re in this.nodes)if(this.nodes.hasOwnProperty(re)){var _e=this.findNodeId(re,Le);if(_e>-1){switch(S){case h.BEFORE:this.insertIdIntoNode(re,V,_e);break;case h.AFTER:this.insertIdIntoNode(re,V,_e+1);break;case h.INSIDE_AT_START:this.nodeInsertAtStart(Le,V);break;case h.INSIDE_AT_END:this.nodeInsertAtEnd(Le,V);break}break}}}else if(le>-1){for(var re in this.nodes)if(this.nodes.hasOwnProperty(re)){var _e=this.findNodeId(re,V);if(_e>-1){this.nodeDeleteAtIndex(re,_e);break}}switch(S){case h.BEFORE:this.insertIdIntoRoot(V,le);break;case h.AFTER:this.insertIdIntoRoot(V,le+1);break;case h.INSIDE_AT_START:this.nodeInsertAtStart(Le,V);break;case h.INSIDE_AT_END:this.nodeInsertAtEnd(Le,V);break}}else{for(var re in this.nodes)if(this.nodes.hasOwnProperty(re)){var _e=this.findNodeId(re,V);if(_e>-1){this.nodeDeleteAtIndex(re,_e);break}}for(var re in this.nodes)if(this.nodes.hasOwnProperty(re)){var _e=this.findNodeId(re,Le);if(_e>-1){switch(S){case h.BEFORE:this.insertIdIntoNode(re,V,_e);break;case h.AFTER:this.insertIdIntoNode(re,V,_e+1);break;case h.INSIDE_AT_START:this.nodeInsertAtStart(Le,V);break;case h.INSIDE_AT_END:this.nodeInsertAtEnd(Le,V);break}break}}}},t.prototype.swapArrayElements=function(n,f,S){var V=n[f];return n[f]=n[S],n[S]=V,n},t.prototype.rootDeleteId=function(n){var f=this.findRootId(n);f>-1&&this.rootDelete(f)},t.prototype.nodeAndSubNodesDelete=function(n){for(var f=[],S=0;S<this.nodes[n].length;S++){var V=this.nodes[n][S];this.nodeAndSubNodesDelete(V),f.push(n)}this.nodeDelete(n);for(var S=0;S<f.length;S++)this.nodeDelete(f[S])},t.prototype.nodeRefrencesDelete=function(n){for(var f in this.nodes)if(this.nodes.hasOwnProperty(f))for(var S=0;S<this.nodes[f].length;S++){var V=this.nodes[f][S];V===n&&this.nodeDeleteAtIndex(f,S)}},t.prototype.nodeDelete=function(n){delete this.nodes[n]},t.prototype.findRootId=function(n){return this.rootIds.indexOf(n)},t.prototype.findNodeId=function(n,f){return this.nodes[n].indexOf(f)},t.prototype.findNode=function(n){return this.nodes[n]},t.prototype.nodeInsertAtStart=function(n,f){this.nodes[n].unshift(f)},t.prototype.nodeInsertAtEnd=function(n,f){this.nodes[n].push(f)},t.prototype.rootDelete=function(n){this.rootIds.splice(n,1)},t.prototype.nodeDeleteAtIndex=function(n,f){this.nodes[n].splice(f,1)},t.prototype.rootInsertAtStart=function(n){this.rootIds.unshift(n)},t.prototype.rootInsertAtEnd=function(n){this.rootIds.push(n)},t}();r.default=o}),mc=Ke(function(j,r){Object.defineProperty(r,"__esModule",{value:!0}),r.arrays=St,r.Bag=fc.default,r.BSTree=uc.default,r.BSTreeKV=jo.default,r.Dictionary=br.default,r.Heap=Ho.default,r.LinkedDictionary=lc.default,r.LinkedList=Ci.default,r.MultiDictionary=cc.default,r.FactoryDictionary=zo.default;var h=zo;r.DefaultDictionary=h.default,r.Queue=Uo.default,r.PriorityQueue=hc.default,r.Set=Wo.default,r.Stack=dc.default,r.MultiRootTree=pc.default,r.util=we}),Sn=mc.Dictionary;function $o(j,r,h){return j+h*(r-j)}function Xo(j,r,h){return(j-r)/(h-r)}function qo(j,r){return{x:j.x*r,y:j.y*r}}function Yo(j){return Math.sqrt(Math.pow(j.x,2)+Math.pow(j.y,2))}function Cn(j,r){return{x:j.x-r.x,y:j.y-r.y}}function mt(j){return[j.x,j.y]}function Qo(j){return new Promise(r=>{let h=new Image;return h.crossOrigin="anonymous",h.src=j,h.onload=()=>r(Object.assign(h)),h})}function Vr(j,r){let h=Math.pow(10,r);return Math.round(j*h)/h}var Ko=class{constructor(){this.textureCache=new Sn}async PrepareREGLShader(r,h){let o=fetch(r,{method:"GET",credentials:"include"}),t=fetch(h,{method:"GET",credentials:"include"});return Promise.all([o,t]).then(n=>Promise.all([n[0].text(),n[1].text()])).then(n=>({vertex_shader:n[0],fragment_shader:n[1]}))}async GetImage(r){if(this.textureCache.containsKey(r))return this.textureCache.getValue(r);let h=await Qo(r);return this.textureCache.setValue(r,h),h}},Zo=Ko;function Wr(j,r,h){r({vertex:h.position,color:h.vertexColor,uv:h.uv,enableBorder:h.enableBorder?1:0,enableRadialGradient:h.enableRadialGradient?1:0,enableLinearGradient:h.enableLinearGradient?1:0,shapeType:h.type,mainColor:h.mainColor,subColor:h.subColor,positionOffset:h.positionOffset,vertexCount:h.count})}function Jo(j,r,h){return j({frag:h,vert:r,attributes:{a_position:j.prop("vertex"),a_color:j.prop("color"),a_uv:j.prop("uv")},uniforms:{time:j.prop("time"),u_offset:j.prop("positionOffset"),u_enableBorder:j.prop("enableBorder"),u_enableRadialGradient:j.prop("enableRadialGradient"),u_enableLinearGradient:j.prop("enableLinearGradient"),u_shapeType:j.prop("shapeType"),u_mainColor:j.prop("mainColor"),u_subColor:j.prop("subColor")},count:j.prop("vertexCount")})}var ut={MouseDownEvent:"event@mousedown",MouseDragEvent:"event@mouseDrag",MouseUpEvent:"event@mouseUp",MouseCtrlClick:"event@clickclick",DeselectPolygonEvent:"event@polygonDeselect",OnColorEvent:"event@onColorChange"},Ze={DominateDot:"id@dot_dominate",GradientDot:"id@dot_gradient",ColorValueBarDot:"id@dot_valuebar",DominateColorTitle:"Dominate Color Info",GraidentColorTitle:"Gradient Color Info"},tt={DotControlColor:[.9,.9,.9,1],SubDotControlColor:[.6,.6,.6,1],WhiteColor:[1,1,1,1],BlackColor:[0,0,0,1]},Bt={Sphere:0,Polygon:1},ot;(function(j){j[j.Normal=0]="Normal",j[j.Gradient=1]="Gradient"})(ot||(ot={}));function kt(j,r,h){j=vc(j);let o=(t,n=(t+j/60)%6)=>h-h*r*Math.max(Math.min(n,4-n,1),0);return[o(5),o(3),o(1),1]}function Er(j,r,h){let o=Math.max(j,r,h),t=o-Math.min(j,r,h),n=t&&(o==j?(r-h)/t:o==r?2+(h-j)/t:4+(j-r)/t);return[yc(60*(n<0?n+6:n)),o&&t/o,o]}function vc(j){return j*(180/Math.PI)}function yc(j){return j*(Math.PI/180)}function wi(j){var r=j.toString(16);return r.length==1?"0"+r:r}function es(j,r,h){return"#"+wi(j)+wi(r)+wi(h)}function wn(j,r,h,o,t){return Math.sqrt(Math.pow(j-o,2)+Math.pow(r-t,2))<=h}function _c(j,r,h){return .5*(-r.y*h.x+j.y*(-r.x+h.x)+j.x*(r.y-h.y)+r.x*h.y)}function Ur(j,r,h,o){let t=_c(r,h,o),n=1/(2*t)*(r.y*o.x-r.x*o.y+(o.y-r.y)*j.x+(r.x-o.x)*j.y),f=1/(2*t)*(r.x*h.y-r.y*h.x+(r.y-h.y)*j.x+(h.x-r.x)*j.y);return n>0&&f>0&&1-n-f>0}var ts=class{constructor(r){this.colorWheel=r}GetSphereVertext(r,h,o,t,n,f){let V=Math.PI*2/n,ne={radian:0,x:0,y:0,scaleX:h,scaleY:o};r.position.length=0,r.vertexColor.length=0,r.uv.length=0,r.count=0;for(let re=0;re<n;re++){let Le=V*re,le=ne,_e=this.GetPiePieceTypeByRadian(Le,h,o,t),Ce=this.GetPiePieceTypeByRadian(0,h,o,t);re<n-1&&(Ce=this.GetPiePieceTypeByRadian(V*(re+1),h,o,t)),r.position=r.position.concat(this.GetVertexArray(le,Ce,_e)),r.uv=r.uv.concat(this.GetUVArray(le,Ce,_e)),r.vertexColor=r.vertexColor.concat(f(le,Ce,_e))}return r.count=r.position.length,r}GetPiePieceTypeByRadian(r,h,o,t){let n=Math.cos(r),f=Math.sin(r);return{radian:r,x:n,y:f,scaleX:h+n*t,scaleY:o+f*t}}GetVertexArray(r,h,o){return[mt(this.colorWheel.ScreenPositionToClipSpace(r.scaleX,r.scaleY)),mt(this.colorWheel.ScreenPositionToClipSpace(h.scaleX,h.scaleY)),mt(this.colorWheel.ScreenPositionToClipSpace(o.scaleX,o.scaleY))]}GetUVArray(r,h,o){return[[r.x,r.y],[h.x,h.y],[o.x,o.y]]}GetValueBarVertex(r){let h=this.colorWheel.ScreenPositionToClipSpace(r.topLeft.x,r.topLeft.y),o=this.colorWheel.ScreenPositionToClipSpace(r.topRight.x,r.topRight.y),t=this.colorWheel.ScreenPositionToClipSpace(r.botLeft.x,r.botLeft.y),n=this.colorWheel.ScreenPositionToClipSpace(r.botRight.x,r.botRight.y),f=rr(Bt.Sphere,!1);return f.position=[mt(t),mt(h),mt(n),mt(n),mt(h),mt(o)],f.vertexColor=[tt.BlackColor,tt.WhiteColor,tt.BlackColor,tt.BlackColor,tt.WhiteColor,tt.WhiteColor],f.count=6,f.uv=f.position,f}};function rr(j,r){return{position:[],vertexColor:[],uv:[],enableBorder:r,enableRadialGradient:!1,enableLinearGradient:!1,type:j,mainColor:[1,1,1,1],subColor:[1,1,1,1],positionOffset:[0,0],count:0}}var rs=ts;var ns=class{constructor(r,h){this.index=0,this.count=0,this.colorWheel=r,this.rawPolygons=h,this.count=this.rawPolygons.length,this.cachePolygonLookupTable=new Sn}get selectPolygon(){return this._selectedPolygon}FindPolygonVertexByID(r){return this.cachePolygonLookupTable.getValue(r)}Process(){let r=this.rawPolygons[this.index];this.index++;let h=this.cachePolygonLookupTable.getValue(r.id),o=this.selectPolygon!=null&&this.selectPolygon.id==r.id;if(h!=null)return h.mainColor=r.color,r.gradientColor!=null&&(h.enableLinearGradient||h.enableRadialGradient)&&(h.subColor=r.gradientColor),h.enableBorder=o,h;let t=rr(Bt.Polygon,o),n=r.points.length;for(let f=0;f<n;f++){let S={x:r.points[f][0],y:r.points[f][1]},V={x:(S.x+1)*.5,y:(S.y+1)*.5},ne=qo(S,r.scale);ne.x+=r.x,ne.y+=r.y,ne=this.colorWheel.ScreenPositionToClipSpace(ne.x,ne.y),t.position.push(mt(ne)),t.vertexColor.push(tt.WhiteColor),t.uv.push(mt(V))}return t.mainColor=r.color,t.subColor=r.color,t.count=n,this.cachePolygonLookupTable.setValue(r.id,t),t}IsNextProcessValid(){return this.index<this.count}Reset(){this.index=0}LocalVertexPosToWorld(r,h,o,t){let n=r[0]*t+h,f=r[1]*t+o;return{x:n,y:f}}DeselectPolygon(){let r=this._selectedPolygon.id;this._selectedPolygon=null,this.colorWheel.eventSystem.Notify(ut.DeselectPolygonEvent,r)}SelectPolygon(r){this._selectedPolygon=r}ChangePolygonColor(r,h,o){let t=this.rawPolygons.findIndex(f=>f.id==r);if(t<0)return;let n=this.FindPolygonVertexByID(r);this.rawPolygons[t].color=h,(n.enableLinearGradient||n.enableRadialGradient)&&(this.rawPolygons[t].gradientColor=o)}CheckAndExecutePolygonCollision(r){let h=this.FindCollidePolygon(r);return h!=null?(this.selectPolygon==null||this.selectPolygon!=null&&h.id!=this.selectPolygon.id)&&this.SelectPolygon(h):this.selectPolygon!=null&&this.DeselectPolygon(),h!=null}FindCollidePolygon(r){let h=this.rawPolygons.length;for(let o=0;o<h;o++){if(this.rawPolygons[o].ignoreRaycast)continue;if(this.CheckCollision(this.rawPolygons[o],r))return this.rawPolygons[o]}return null}CheckCollision(r,h){for(let o=0;o<r.points.length;o+=3){let t=this.LocalVertexPosToWorld(r.points[o],r.x,r.y,r.scale),n=this.LocalVertexPosToWorld(r.points[o+1],r.x,r.y,r.scale),f=this.LocalVertexPosToWorld(r.points[o+2],r.x,r.y,r.scale);if(Ur(h,t,n,f))return!0}return!1}},is=ns;var as=class{constructor(r,h){this._sphereSteps=6,this._mainApp=r,this._dotArray=[],this._vertexCache=[],this._wheelProcessorHelper=h}AddDot(r,h,o,t,n,f,S){if(this._dotArray.findIndex(ne=>ne._id==r)>=0)this.UpdateDot(r,h,o,f);else{let ne=rr(Bt.Sphere,!0),re=this.GetOffset(h,o,t,n),Le={x:h,y:o,radius:S,center_x:t,center_y:n,_id:r,vertex:this._wheelProcessorHelper.GetSphereVertext(ne,t,n,S,this._sphereSteps,this.GetDotColors.bind(this))};Le.vertex.mainColor=f,Le.vertex.positionOffset=[re.x,re.y],this._dotArray.push(Le),this._vertexCache.push(Le.vertex)}}RemoveDot(r){let h=this._dotArray.findIndex(o=>o._id==r);h>=0&&(this._dotArray.splice(h,1),this._vertexCache.splice(h,1))}UpdateDot(r,h,o,t){let n=this._dotArray.findIndex(f=>f._id==r);if(n>=0){let f=this._dotArray[n],S=this.GetOffset(h,o,f.center_x,f.center_y);f.x=h,f.y=o,f.vertex.positionOffset[0]=S.x,f.vertex.positionOffset[1]=S.y,f.vertex.mainColor=t,this._dotArray[n]=f,this._vertexCache[n]=f.vertex}}Process(){return this._vertexCache}GetDotColors(r,h,o){return[tt.WhiteColor,tt.WhiteColor,tt.WhiteColor]}GetOffset(r,h,o,t){let n=this._mainApp.ScreenPositionToClipSpace(r,h),f=this._mainApp.ScreenPositionToClipSpace(o,t);return Cn(n,f)}CheckDotCollision(r,h,o){let t=this._dotArray.findIndex(n=>n._id==r);return t>=0?wn(this._dotArray[t].x,this._dotArray[t].y,this._dotArray[t].radius,h,o):!1}},os=as;var ss=class{constructor(r,h,o){this._supportColor=[1,1,1,1],this._mode=ot.Normal,this.cWheelHelper=new rs(r),this._dotProcessor=new os(r,this.cWheelHelper),this.colorWheelType=h,this.colorWheel=r,this.radian_offset=o,this.wheelDisplayColor=[1,1,1,1],this.hsv={radian:1,saturation:0,value:1},this.SetColorWheelByHSV(this.ActiveDotID,this.hsv)}get dominateColor(){return this._dominateColor}get supportColor(){return this._supportColor}set wheelDisplayColor(r){this._mode==ot.Normal?(this._dominateColor=r,this.colorWheel.eventSystem.Notify(ut.OnColorEvent,{title:Ze.DominateColorTitle,color:this._dominateColor})):this._mode==ot.Gradient&&(this._supportColor=r,this.colorWheel.eventSystem.Notify(ut.OnColorEvent,{title:Ze.GraidentColorTitle,color:this._supportColor}))}get wheelDisplayColor(){return this._mode==ot.Normal?this._dominateColor:this._supportColor}get dotProcessor(){return this._dotProcessor}get ActiveDotID(){return this._mode==ot.Normal?Ze.DominateDot:Ze.GradientDot}get mode(){return this._mode}ProcessWheel(r){return this.cacheWheelVertex!=null?(this.cacheWheelVertex.mainColor=[this.hsv.value,this.hsv.value,this.hsv.value,1],this.cacheWheelVertex):(this.cacheWheelVertex=rr(Bt.Sphere,!1),this.cacheWheelVertex=this.cWheelHelper.GetSphereVertext(this.cacheWheelVertex,this.colorWheelType.x,this.colorWheelType.y,this.colorWheelType.radius,r,this.GetColorArray.bind(this)),this.cacheWheelVertex)}GetColorArray(r,h,o){return[kt(this.GetNormalizedRadian(r.radian),0,this.hsv.value),kt(this.GetNormalizedRadian(h.radian),1,this.hsv.value),kt(this.GetNormalizedRadian(o.radian),1,this.hsv.value)]}GetNormalizedRadian(r){let h=Math.PI*2;return h-(r+this.radian_offset)%h}GetValueBarRect(){let r=15*.5,h=10,o=this.colorWheelType.x-this.colorWheelType.radius-h-r,t=this.colorWheelType.y+this.colorWheelType.radius,n=this.colorWheelType.y-this.colorWheelType.radius;return{center:{x:o,y:this.colorWheelType.y},topLeft:{x:o-r,y:t},topRight:{x:o+r,y:t},botLeft:{x:o-r,y:n},botRight:{x:o+r,y:n}}}ProcessValueBar(){let r=kt(this.hsv.radian,this.hsv.saturation,1);if(this.cacheColorBarVertex!=null)return this.cacheColorBarVertex.mainColor=r,this.cacheColorBarVertex;this.cacheColorBarPoints=this.GetValueBarRect();let h=this.cWheelHelper.GetValueBarVertex(this.cacheColorBarPoints);return this.cacheColorBarVertex=h,this.cacheColorBarVertex}SetValueBarNumber(r){this.hsv.value=r;let h=this.GetValueBarRect(),o=$o(h.botLeft.y,h.topLeft.y,r);this.dotProcessor.AddDot(Ze.ColorValueBarDot,h.center.x,o,h.center.x,h.center.y,tt.DotControlColor,this.colorWheelType.dominateDotSize)}CheckAndExecuteColorWheelCollision(r){return wn(this.colorWheelType.x,this.colorWheelType.y,this.colorWheelType.radius,r.x,r.y)}CheckAndExecuteValueBarCollision(r){if(this.cacheColorBarPoints!=null){let h=Ur(r,this.cacheColorBarPoints.botLeft,this.cacheColorBarPoints.topLeft,this.cacheColorBarPoints.botRight),o=Ur(r,this.cacheColorBarPoints.botRight,this.cacheColorBarPoints.topLeft,this.cacheColorBarPoints.topRight);if(h||o)return this.SetValueBarNumber(Xo(r.y,this.cacheColorBarPoints.botLeft.y,this.cacheColorBarPoints.topLeft.y)),this.wheelDisplayColor=kt(this.hsv.radian,this.hsv.saturation,this.hsv.value),!0}return!1}SetColorWheelByMousePos(r,h,o){let t=Er(this.wheelDisplayColor[0],this.wheelDisplayColor[1],this.wheelDisplayColor[2]);this.hsv.value=t[2],this.hsv=this.GetHSVByMousePos(h,o);let n=r==Ze.DominateDot?tt.DotControlColor:tt.SubDotControlColor,f=r==Ze.DominateDot?this.colorWheelType.dominateDotSize:this.colorWheelType.gradientDotSize;this.dotProcessor.AddDot(r,h,o,this.colorWheelType.x,this.colorWheelType.y,n,f),this.wheelDisplayColor=kt(this.hsv.radian,this.hsv.saturation,this.hsv.value),this.SetValueBarNumber(this.hsv.value)}SetMode(r){this._mode=r}SetColorWheelByHSV(r,h){this.hsv=h,this.SetValueBarNumber(this.hsv.value);let o=r==Ze.DominateDot?tt.DotControlColor:tt.SubDotControlColor,t=r==Ze.DominateDot?this.colorWheelType.dominateDotSize:this.colorWheelType.gradientDotSize,n=Math.cos(this.GetNormalizedRadian(this.hsv.radian))*this.colorWheelType.radius*this.hsv.saturation+this.colorWheelType.x,f=Math.sin(this.GetNormalizedRadian(this.hsv.radian))*this.colorWheelType.radius*this.hsv.saturation+this.colorWheelType.y;this._dotProcessor.AddDot(r,n,f,this.colorWheelType.x,this.colorWheelType.y,o,t),this.wheelDisplayColor=kt(this.hsv.radian,this.hsv.saturation,this.hsv.value)}SetColorWheelByRGB(r,h){let o=Er(h[0],h[1],h[2]);this.SetColorWheelByHSV(r,{radian:o[0],saturation:o[1],value:o[2]})}GetHSVByMousePos(r,h){let o={x:r,y:h},t={x:this.colorWheelType.x,y:this.colorWheelType.y},n=Cn(o,t);n.x/=this.colorWheelType.radius,n.y/=this.colorWheelType.radius;let f=Yo(n),S=Math.atan2(n.y,n.x);return{saturation:f,radian:this.GetNormalizedRadian(S),value:this.hsv.value}}},fs=ss;var Mt;(function(j){j[j.MouseDown=0]="MouseDown",j[j.MouseDrag=1]="MouseDrag",j[j.MouseUp=2]="MouseUp"})(Mt||(Mt={}));var us=class{constructor(r,h){this._delayEvent=10,this._lastEventTime=0,this._webglCanvas=r,this.eventSystem=h,this._webglCanvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this._webglCanvas.addEventListener("mouseup",this.OnMouseUp.bind(this)),this._webglCanvas.addEventListener("mousemove",this.OnMouseMove.bind(this))}OnMouseDown(r){this._startMousePosition=this.GetMousePosVector(r),this._isMouseDown=!0,this.eventSystem.Notify(ut.MouseDownEvent,{mousePosition:this._startMousePosition})}OnMouseMove(r){if(!this._isMouseDown||r.timeStamp<this._lastEventTime)return;let h=this.GetMousePosVector(r);this.eventSystem.Notify(ut.MouseDragEvent,{mousePosition:h}),this._lastEventTime=r.timeStamp+this._delayEvent}OnMouseUp(r){this._isMouseDown=!1,this.eventSystem.Notify(ut.MouseUpEvent,{mousePosition:this.GetMousePosVector(r)})}GetMousePosVector(r){let h=this._webglCanvas.height-r.y;return{x:r.x,y:h}}},ls=us;var cs=class{constructor(r,h,o,t){this._mainApp=r,this._webglCanvas=h,this._polygonProcessor=o,this._colorWheelProcessor=t,this._mainApp.eventSystem.ListenToEvent(ut.MouseDownEvent,this.OnMouseClick.bind(this)),this._mainApp.eventSystem.ListenToEvent(ut.MouseDragEvent,this.OnMouseDrag.bind(this)),this._mainApp.eventSystem.ListenToEvent(ut.DeselectPolygonEvent,this.OnPolygonDeselect.bind(this)),this._mainApp.eventSystem.ListenToEvent(ut.OnColorEvent,this.OnWheelColorChange.bind(this)),this.SetWheelColorHTMLInfo(Ze.DominateColorTitle,this._colorWheelProcessor.dominateColor),this.RegisterGradientCheckboxEvent()}RegisterGradientCheckboxEvent(){let r=document.querySelector(".control_panel .linear_gradient");document.querySelector(".control_panel .radial_gradient").addEventListener("change",this.OnGradientCheckboxEvent.bind(this)),r.addEventListener("change",this.OnGradientCheckboxEvent.bind(this))}OnGradientCheckboxEvent(r){let h=this._polygonProcessor.FindPolygonVertexByID(this._polygonProcessor.selectPolygon.id),o=!1;r.target.name=="radial_gradient"&&h.enableRadialGradient!=r.target.checked&&(h.enableRadialGradient=r.target.checked,o=!0),r.target.name=="linear_gradient"&&h.enableLinearGradient!=r.target.checked&&(h.enableLinearGradient=r.target.checked,o=!0),!h.enableRadialGradient&&!h.enableLinearGradient&&this._colorWheelProcessor.dotProcessor.RemoveDot(Ze.GradientDot),this.SetPolygonDataToColorWheel(h),o&&this._mainApp.DrawREGLCavnas()}OnWheelColorChange(r){this.SetWheelColorHTMLInfo(r.title,r.color)}OnMouseClick(r){let h=r.mousePosition;this.OnMouseEvent(h,Mt.MouseDown)}OnMouseDrag(r){let h=r.mousePosition;this.OnMouseEvent(h,Mt.MouseDrag)}OnPolygonDeselect(r){this.ShowGradientHTMLTable(!1),this._colorWheelProcessor.SetColorWheelByRGB(Ze.DominateDot,this._colorWheelProcessor.dominateColor),this._colorWheelProcessor.SetMode(ot.Normal),this._colorWheelProcessor.dotProcessor.RemoveDot(Ze.GradientDot),this._mainApp.DrawREGLCavnas()}OnMouseEvent(r,h){if(this._colorWheelProcessor.CheckAndExecuteValueBarCollision(r)){this.SynchorizeColors(this._colorWheelProcessor.dominateColor,this._colorWheelProcessor.supportColor),this._mainApp.DrawREGLCavnas();return}if(this._colorWheelProcessor.dotProcessor.CheckDotCollision(Ze.GradientDot,r.x,r.y)&&h==Mt.MouseDown){this._colorWheelProcessor.SetMode(ot.Gradient),this._colorWheelProcessor.SetColorWheelByMousePos(Ze.GradientDot,r.x,r.y),this._mainApp.DrawREGLCavnas();return}if(this._colorWheelProcessor.CheckAndExecuteColorWheelCollision(r)){let S=this._colorWheelProcessor.mode==ot.Gradient&&h==Mt.MouseDrag?ot.Gradient:ot.Normal;this._colorWheelProcessor.SetMode(S),this._colorWheelProcessor.SetColorWheelByMousePos(this._colorWheelProcessor.ActiveDotID,r.x,r.y),this.SynchorizeColors(this._colorWheelProcessor.dominateColor,this._colorWheelProcessor.supportColor),this._mainApp.DrawREGLCavnas();return}if(h==Mt.MouseDrag)return;if(this._polygonProcessor.CheckAndExecutePolygonCollision(r)){let S=this._polygonProcessor.FindPolygonVertexByID(this._polygonProcessor.selectPolygon.id);this.SetPolygonDataToColorWheel(S),this.ShowGradientHTMLTable(!0,S.enableLinearGradient,S.enableRadialGradient),this._mainApp.DrawREGLCavnas();return}}SetPolygonDataToColorWheel(r){if(r.enableLinearGradient||r.enableRadialGradient){this._colorWheelProcessor.SetMode(ot.Gradient);let t=Er(r.subColor[0],r.subColor[1],r.subColor[2]);this._colorWheelProcessor.SetColorWheelByHSV(Ze.GradientDot,{radian:t[0],saturation:t[1],value:t[2]})}else this._colorWheelProcessor.dotProcessor.RemoveDot(Ze.GradientDot);let o=Er(this._polygonProcessor.selectPolygon.color[0],this._polygonProcessor.selectPolygon.color[1],this._polygonProcessor.selectPolygon.color[2]);this._colorWheelProcessor.SetMode(ot.Normal),this._colorWheelProcessor.SetColorWheelByHSV(Ze.DominateDot,{radian:o[0],saturation:o[1],value:o[2]})}SetWheelColorHTMLInfo(r,h){let o=".control_panel .color_panel",t=document.querySelector(o),n=Math.ceil(h[0]*255),f=Math.ceil(h[1]*255),S=Math.ceil(h[3]*255),V=Math.ceil(h[3]*255),ne=`
        <h4>${r}</h4>
        <p>
        RGBA: rgba(${Vr(h[0],2)}, ${Vr(h[1],2)},${Vr(h[2],2)},${Vr(h[3],2)})</br>
        RGBA: rgba(${n}, ${f},${S}, ${V})</br>
        HEX: ${es(n,f,S)}</p>`;t.innerHTML=ne}ShowGradientHTMLTable(r,h=!1,o=!1){let t=document.querySelector(".control_panel .gradient_panel"),n=document.querySelector(".control_panel .linear_gradient"),f=document.querySelector(".control_panel .radial_gradient");t.style.display=r?"inline":"none",r&&(n.checked=h,f.checked=o)}SynchorizeColors(r,h){this._polygonProcessor.selectPolygon!=null&&this._polygonProcessor.ChangePolygonColor(this._polygonProcessor.selectPolygon.id,r,h)}},hs=cs;var ds=class{constructor(){this._events={}}ListenToEvent(r,h){if(this._events.hasOwnProperty(r)){this._events[r].push(h);return}this._events[r]=[h]}Notify(r,h){if(this._events.hasOwnProperty(r)){let o=this._events[r].length;for(let t=0;t<o;t++)this._events[r][t](h)}}},ps=ds;var ms=class extends Vo{constructor(r){super(r.canvas_query,r.canvas_width,r.canvas_height);this.webglUtility=new Zo,this.eventSystem=new ps,this.polygonProcessor=new is(this,r.polygons),this.colorWheelProcessor=new fs(this,r.colorWheel,4),this.inputProcessor=new hs(this,this._webglDom,this.polygonProcessor,this.colorWheelProcessor),this.inputHandler=new ls(this._webglDom,this.eventSystem),this.InitProcess(r.vertex_path,r.frag_path)}async InitProcess(r,h){await this.SetupWebglPipeline(r,h),this.DrawREGLCavnas()}async SetupWebglPipeline(r,h){this._reglContext=await this.CreatREGLCanvas(this._webglDom);let o=await this.webglUtility.PrepareREGLShader(r,h);this.reglDrawCommand=await Jo(this._reglContext,o.vertex_shader,o.fragment_shader)}DrawREGLCavnas(){this._reglContext.clear({color:[0,0,0,1],depth:1});let r=this.colorWheelProcessor.dotProcessor.Process(),h=r.length;for(let n=0;n<h;n++)Wr(this._reglContext,this.reglDrawCommand,r[n]);let o=this.colorWheelProcessor.ProcessWheel(48);Wr(this._reglContext,this.reglDrawCommand,o);let t=this.colorWheelProcessor.ProcessValueBar();for(Wr(this._reglContext,this.reglDrawCommand,t),this.polygonProcessor.Reset();this.polygonProcessor.IsNextProcessValid();){let n=this.polygonProcessor.Process();Wr(this._reglContext,this.reglDrawCommand,n)}}},vs=ms;window.onload=()=>{fetch("./Dataset/color_wheel_config.json").then(function(j){return j.json()}).then(function(j){let r=new vs(j)})};
//# sourceMappingURL=/dist//index.js.map
